!function e(t,n,i){function r(s,a){if(!n[s]){if(!t[s]){var c="function"==typeof require&&require;if(!a&&c)return c(s,!0);if(o)return o(s,!0);var l=new Error("Cannot find module '"+s+"'");throw l.code="MODULE_NOT_FOUND",l}var u=n[s]={exports:{}};t[s][0].call(u.exports,function(e){var n=t[s][1][e];return r(n?n:e)},u,u.exports,e,t,n,i)}return n[s].exports}for(var o="function"==typeof require&&require,s=0;s<i.length;s++)r(i[s]);return r}({1:[function(e,t,n){function i(){if(!s()){A&&$("html").addClass("mobile");var t=e("./core/user");Promise.all([d(),t.fetch()])["finally"](function(){o()||(t.signedIn()&&(e("./core/user_storage").setPrefix(t.get().id),trackJs&&trackJs.configure({userId:t.get().id})),t.onSignIn(function(){UserVoice&&UserVoice.push(["identify",t.get().id])}),$("head").attr("metadata",""),angular.bootstrap(document,["reader"],{strictDi:!0}))}),r()}}function r(){var t=e("./core/update"),n=e("./core/command");$(n).on("reload",t.reload),$(n).on("force_update",function(){t.available().then(t.reload)})}function o(){var t=e("./core/compatible");return u()||t().result?!1:(p(c()),!0)}function s(){var t=l();if(t&&A){var n=e("./core/utils/util"),i=e("./core/endpoint"),r=e("./core/tracking/track_id"),o={doi:f(),referrer_url:location.href,tracking_id:r.get()};return o.referrer=n.referrerHost(),o[t.key]=t.val,$.get(i.services+"/reader/mobile_url?"+$.param(o),function(e){p(e.url||a(o.doi))}),!0}return!1}function a(t){return sprintf("%s/%s",e("./core/endpoint").dx_doi,t)}function c(){var t=e("./core/endpoint"),n=l()?t.authors_springernature:t.web,i=sprintf("%s/unsupported/%s",n,f()),r=location.href.split("?")[1];return r&&(i=[i,r].join("?")),i}function l(){for(var e=parseUri(location.href),t=0;t<S.length;t++){var n=S[t],i=e.queryKey[n];if(i)return{key:n,val:decodeURIComponent(i)}}return null}function u(){return $("html").hasClass("browser-bot")}function d(){return new Promise(function(e){$(e)})}function p(t){e("./core/utils/util").redirectOrPost(t)}function f(){var e=decodeURIComponent(location.href.split("?")[0]),t=e.match(T);return t?t[0]:"unknown"}function h(){return sprintf("10.(?:%s).+",_.reduce(j,function(e,t){return[e,t].join("|")}))}function g(t,n,i){function r(e){return t(function(t){n.loadScript(e,t)})}return r(i.scripts.easeljs).then(function(){return t.all([r(i.scripts.tweenjs),r(i.scripts.movieclip)])}).then(function(){return e("./error/animation.js")})}function m(t,n,i){return e("./core/includes/mixpanel"),mixpanel.init(i.mixpanel,{track_pageview:!1}),t.signedIn()?mixpanel.identify(t.get().id):mixpanel.identify(n.get()),mixpanel.track("Loaded",{Client:"Web Reader"}),mixpanel}function v(t,n,i){return e("./core/includes/ga"),t.signedIn()?(ga("create",i.ga,{userId:t.get().id}),ga("set","dimension1",t.get().id)):(ga("create",i.ga,"auto"),ga("set","dimension1","Anonymous")),ga("require","displayfeatures"),ga("send","pageview"),ga}function w(e,t,n,i,r,o,s){var a=n.defer();return r.fetch().then(function(){a.resolve(r)})["catch"](function(n){a.reject(n),401==n.status?p(sprintf("%s/session/new?redirect=%s",o.web,encodeURIComponent(location.href))):(s(n,t),e.go("error.500",null,{location:!1}))}),a.promise}function y(e,t,n,i){return t.init({doi:e.doi,preview:"1"})["catch"](function(t){"content_missing"==t.error&&p(a(e.doi))}),i.init(),t}function b(e,t,n,i,r,o,s){return i.init({doi:t.doi},n.pickDefined(t,P))["catch"](function(n){"content_not_allowed"==n.error?p(a(t.doi)):/(?:content_missing|doi_invalid)/.test(n.error)?(s(n,t),e.go("error.404",null,{location:!1})):(s(n,t),e.go("error.500",null,{location:!1}))}),r.init(),o.init(),i}function k(e,t,n,i,r,o,s){return i.init({resource_id:t.resource_id},n.pickDefined(t,["sponsored"]))["catch"](function(n){"processing"==n.error?e.go("processing",{resource_id:t.resource_id},{location:!1}):/(?:resource_not_found|no_access)/.test(n.error)?p(o.app):(s(n,t),e.go("error.500",null,{location:!1}))}),r.init(),i}function x(e,t,n,i,r,o){return i.initSupplement(n.pickDefined(t,N))["catch"](function(n){"no_access"==n.error?p(r.app):"resource_not_found"==n.error?(o(n,t),e.go("error.404",null,{location:!1})):(o(n,t),e.go("error.500",null,{location:!1}))}),i}function C(e,t){return function(n,i){t(n),e(n,i)}}function E(e,t){e.endpoint=t,e.$on("$stateChangeError",function(e,t,n,i,r,o){throw o})}function F(t,n,i,r){var o=A?"MobileReaderCtrl":"ReaderCtrl",s=A?"mobile_reader.html":"reader.html",a=A?"mobile_reader.html":"library.html";t.decorator("$exceptionHandler",C),r.html5Mode(!0).hashPrefix("!"),i.otherwise(function(){p(e("./core/endpoint").web)}),n.state("error",{"abstract":!0,url:"^/error",controller:"ErrorCtrl",templateUrl:"error/error.html",resolve:{errorAnimation:g}}).state("error.404",{url:"/404",templateUrl:"error/404.html"}).state("error.500",{url:"/500",templateUrl:"error/500.html"}).state("processing",{url:"^/processing?resource_id",controller:"ProcessingCtrl",templateUrl:"error/processing.html"}).state("supplement",{url:sprintf("^/supplement?%s",N.join("&")),controller:"SupplementCtrl",templateUrl:"supplement.html",resolve:{supplement:x}}).state("resolve",{url:"^/resolve/:resource_id?types",controller:"ResolveCtrl",templateUrl:"resolve.html",resolve:{article:k,user:w},params:{types:"DOI,PMID,Journal,Year,Title,Author"}}).state("sponsored",{url:sprintf("^/s/{resource_id:%s}",X.source),controller:o,templateUrl:a,resolve:{article:k,mixpanel:m,ga:v},params:{sponsored:"1"}}).state("discover",{url:sprintf("^/{doi:%s}",h()),controller:"DiscoverCtrl",templateUrl:"discover.html",resolve:{article:y}}).state("reader",{url:sprintf("^/{doi:%s}?%s",T.source,O.join("&")),controller:o,templateUrl:s,resolve:{article:b,ga:v}}).state("library",{url:sprintf("^/{resource_id:%s}",X.source),controller:o,templateUrl:a,resolve:{user:w,article:k,mixpanel:m,ga:v}})}READER_VERSION={version:"1.0.10",assets:"1.0.5",build:"2016-06-21T09:00:36.155Z"},g.$inject=["$q","util","endpoint"],m.$inject=["user","trackId","API_KEYS"],v.$inject=["user","trackId","API_KEYS"],w.$inject=["$state","$stateParams","$q","util","user","endpoint","trackError"],y.$inject=["$stateParams","article","endpoint","renderingFixes"],b.$inject=["$state","$stateParams","util","article","access","renderingFixes","trackError"],k.$inject=["$state","$stateParams","util","article","access","endpoint","trackError"],x.$inject=["$state","$stateParams","util","article","endpoint","trackError"],C.$inject=["$delegate","trackError"],E.$inject=["$rootScope","endpoint"],F.$inject=["$provide","$stateProvider","$urlRouterProvider","$locationProvider"],e("./core/includes/trackjs"),e("./core/includes/uservoice"),angular.module("reader",["ui.router","ngMaterial"]),e("../../tmp/scripts/templates"),{controllers:{ArticleCtrl:e("./controllers/ArticleCtrl.js"),ArticleToolsCtrl:e("./controllers/ArticleToolsCtrl.js"),DiscoverCtrl:e("./controllers/DiscoverCtrl.js"),ErrorCtrl:e("./controllers/ErrorCtrl.js"),FigureViewerCtrl:e("./controllers/FigureViewerCtrl.js"),MenuBarCtrl:e("./controllers/MenuBarCtrl.js"),MobileReaderCtrl:e("./controllers/MobileReaderCtrl.js"),MobileToolbarCtrl:e("./controllers/MobileToolbarCtrl.js"),ProcessingCtrl:e("./controllers/ProcessingCtrl.js"),ReaderCtrl:e("./controllers/ReaderCtrl.js"),ResolveCtrl:e("./controllers/ResolveCtrl.js"),SupplementCtrl:e("./controllers/SupplementCtrl.js"),ViewerToolbarCtrl:e("./controllers/ViewerToolbarCtrl.js"),dialogs:{ComplimentaryCtrl:e("./controllers/dialogs/ComplimentaryCtrl.js"),ExportCtrl:e("./controllers/dialogs/ExportCtrl.js"),PrintCtrl:e("./controllers/dialogs/PrintCtrl.js"),ShareCtrl:e("./controllers/dialogs/ShareCtrl.js"),UnavailableCtrl:e("./controllers/dialogs/UnavailableCtrl.js")},sidenav:{SupplementsCtrl:e("./controllers/sidenav/SupplementsCtrl.js")},toast:{AnnotsNotSyncedCtrl:e("./controllers/toast/AnnotsNotSyncedCtrl.js"),AuthFailedCtrl:e("./controllers/toast/AuthFailedCtrl.js"),PromptRegisterCtrl:e("./controllers/toast/PromptRegisterCtrl.js"),ReadPersonalCtrl:e("./controllers/toast/ReadPersonalCtrl.js"),RentalExpiryCtrl:e("./controllers/toast/RentalExpiryCtrl.js"),SharedAccessCtrl:e("./controllers/toast/SharedAccessCtrl.js"),SyncedAdCtrl:e("./controllers/toast/SyncedAdCtrl.js"),UpdateAvailableCtrl:e("./controllers/toast/UpdateAvailableCtrl.js")}}},{directives:{advertLeaderboard:e("./directives/advertLeaderboard.js"),annotations:e("./directives/annotations.js"),appnav:e("./directives/appnav.js"),article:e("./directives/article.js"),articleAnnotations:e("./directives/articleAnnotations.js"),articleCitations:e("./directives/articleCitations.js"),articleTools:e("./directives/articleTools.js"),bgImage:e("./directives/bgImage.js"),cancelEvent:e("./directives/cancelEvent.js"),checkout:e("./directives/checkout.js"),citedBy:e("./directives/citedBy.js"),figure:e("./directives/figure.js"),infiniteScroll:e("./directives/infiniteScroll.js"),login:e("./directives/login.js"),metadata:e("./directives/metadata.js"),metrics:e("./directives/metrics.js"),mobileArticle:e("./directives/mobileArticle.js"),mobileToolbar:e("./directives/mobileToolbar.js"),onLoad:e("./directives/onLoad.js"),pageInfo:e("./directives/pageInfo.js"),postSelection:e("./directives/postSelection.js"),readMode:e("./directives/readMode.js"),references:e("./directives/references.js"),responsive:e("./directives/responsive.js"),targetClick:e("./directives/targetClick.js"),viewer:e("./directives/viewer.js"),viewerToolbar:e("./directives/viewerToolbar.js")}},{services:{articleExport:e("./services/articleExport.js"),articlePrint:e("./services/articlePrint.js"),core:e("./services/core.js"),figureViewer:e("./services/figureViewer.js"),share:e("./services/share.js"),toast:e("./services/toast.js"),userModal:e("./services/userModal.js"),userSidenav:e("./services/userSidenav.js"),videoPlayer:e("./services/videoPlayer.js")}},{filters:{articleKeywords:e("./filters/articleKeywords.js"),authorShortName:e("./filters/authorShortName.js"),breaksToSpaces:e("./filters/breaksToSpaces.js"),figureCaption:e("./filters/figureCaption.js"),formatDate:e("./filters/formatDate.js"),join:e("./filters/join.js"),kilo:e("./filters/kilo.js"),linkify:e("./filters/linkify.js"),refPublishInfo:e("./filters/refPublishInfo.js"),rentalDuration:e("./filters/rentalDuration.js"),trustUrl:e("./filters/trustUrl.js")}};var A=e("./core/utils/mobile_detect")(),T=/10\.\d{3,9}.+/,X=/.+:[0-9a-fA-F]{8}(?:-[0-9a-fA-F]{4}){3}-[0-9a-fA-F]{12}/,j={annual:"1146",gsw:"1130|1346|1306|2138|2113|1785|1180|1127|7185|1190|3749|2110",igi:"4018"},Y=["preview","please","use_s3"],S=["shared_access_token","referrer_access_token","author_access_token","feed_token"],I=["purchase_referrer","purchase_site_license","tracking_referrer","tracking_action"],N=["resource_id","doi","index","lang","sponsored","parent_url"].concat(Y),P=["parent_url","lang","cochrane","publisher"].concat(S).concat(Y),O=P.concat(I);angular.module("reader").constant("MOBILE",A).constant("SUPPL_PARAMS",N).constant("API_KEYS",e("./core/includes/api_keys")).config(F).run(E),i()},{"../../tmp/scripts/templates":151,"./controllers/ArticleCtrl.js":9,"./controllers/ArticleToolsCtrl.js":10,"./controllers/DiscoverCtrl.js":11,"./controllers/ErrorCtrl.js":12,"./controllers/FigureViewerCtrl.js":13,"./controllers/MenuBarCtrl.js":14,"./controllers/MobileReaderCtrl.js":15,"./controllers/MobileToolbarCtrl.js":16,"./controllers/ProcessingCtrl.js":17,"./controllers/ReaderCtrl.js":18,"./controllers/ResolveCtrl.js":19,"./controllers/SupplementCtrl.js":20,"./controllers/ViewerToolbarCtrl.js":21,"./controllers/dialogs/ComplimentaryCtrl.js":22,"./controllers/dialogs/ExportCtrl.js":23,"./controllers/dialogs/PrintCtrl.js":24,"./controllers/dialogs/ShareCtrl.js":25,"./controllers/dialogs/UnavailableCtrl.js":26,"./controllers/sidenav/SupplementsCtrl.js":27,"./controllers/toast/AnnotsNotSyncedCtrl.js":28,"./controllers/toast/AuthFailedCtrl.js":29,"./controllers/toast/PromptRegisterCtrl.js":30,"./controllers/toast/ReadPersonalCtrl.js":31,"./controllers/toast/RentalExpiryCtrl.js":32,"./controllers/toast/SharedAccessCtrl.js":33,"./controllers/toast/SyncedAdCtrl.js":34,"./controllers/toast/UpdateAvailableCtrl.js":35,"./core/command":50,"./core/compatible":51,"./core/endpoint":53,"./core/includes/api_keys":59,"./core/includes/ga":60,"./core/includes/mixpanel":62,"./core/includes/trackjs":63,"./core/includes/uservoice":65,"./core/tracking/track_id":78,"./core/update":80,"./core/user":81,"./core/user_storage":82,"./core/utils/mobile_detect":88,"./core/utils/util":96,"./directives/advertLeaderboard.js":103,"./directives/annotations.js":104,"./directives/appnav.js":105,"./directives/article.js":106,"./directives/articleAnnotations.js":107,"./directives/articleCitations.js":108,"./directives/articleTools.js":109,"./directives/bgImage.js":110,"./directives/cancelEvent.js":111,"./directives/checkout.js":112,"./directives/citedBy.js":113,"./directives/figure.js":114,"./directives/infiniteScroll.js":115,"./directives/login.js":116,"./directives/metadata.js":117,"./directives/metrics.js":118,"./directives/mobileArticle.js":119,"./directives/mobileToolbar.js":120,"./directives/onLoad.js":121,"./directives/pageInfo.js":122,"./directives/postSelection.js":123,"./directives/readMode.js":124,"./directives/references.js":125,"./directives/responsive.js":126,"./directives/targetClick.js":127,"./directives/viewer.js":128,"./directives/viewerToolbar.js":129,"./error/animation.js":130,"./filters/articleKeywords.js":131,"./filters/authorShortName.js":132,"./filters/breaksToSpaces.js":133,"./filters/figureCaption.js":134,"./filters/formatDate.js":135,"./filters/join.js":136,"./filters/kilo.js":137,"./filters/linkify.js":138,"./filters/refPublishInfo.js":139,"./filters/rentalDuration.js":140,"./filters/trustUrl.js":141,"./services/articleExport.js":142,"./services/articlePrint.js":143,"./services/core.js":144,"./services/figureViewer.js":145,"./services/share.js":146,"./services/toast.js":147,"./services/userModal.js":148,"./services/userSidenav.js":149,"./services/videoPlayer.js":150}],2:[function(e,t,n){"use strict";function i(e,t,n){var i,r=e instanceof Error?e:new Error(e);if("object"==typeof t?n=t:null!=t&&(r.code=t),n)for(i in n)r[i]=n[i];return r}t.exports=i},{}],3:[function(require,module,exports){(function(process,global){!function(){"use strict";var Faye={VERSION:"1.1.2",BAYEUX_VERSION:"1.0",ID_LENGTH:160,JSONP_CALLBACK:"jsonpcallback",CONNECTION_TYPES:["long-polling","cross-origin-long-polling","callback-polling","websocket","eventsource","in-process"],MANDATORY_CONNECTION_TYPES:["long-polling","callback-polling","in-process"],ENV:"undefined"!=typeof window?window:global,extend:function(e,t,n){if(!t)return e;for(var i in t)t.hasOwnProperty(i)&&(e.hasOwnProperty(i)&&n===!1||e[i]!==t[i]&&(e[i]=t[i]));return e},random:function(e){e=e||this.ID_LENGTH;for(var t=Math.ceil(e*Math.log(2)/Math.log(36)),n=csprng(e,36);n.length<t;)n="0"+n;return n},validateOptions:function(e,t){for(var n in e)if(this.indexOf(t,n)<0)throw new Error("Unrecognized option: "+n)},clientIdFromMessages:function(e){var t=this.filter([].concat(e),function(e){return"/meta/connect"===e.channel});return t[0]&&t[0].clientId},copyObject:function(e){var t,n,i;if(e instanceof Array){for(t=[],n=e.length;n--;)t[n]=Faye.copyObject(e[n]);return t}if("object"==typeof e){t=null===e?null:{};for(i in e)t[i]=Faye.copyObject(e[i]);return t}return e},commonElement:function(e,t){for(var n=0,i=e.length;i>n;n++)if(-1!==this.indexOf(t,e[n]))return e[n];return null},indexOf:function(e,t){if(e.indexOf)return e.indexOf(t);for(var n=0,i=e.length;i>n;n++)if(e[n]===t)return n;return-1},map:function(e,t,n){if(e.map)return e.map(t,n);var i=[];if(e instanceof Array)for(var r=0,o=e.length;o>r;r++)i.push(t.call(n||null,e[r],r));else for(var s in e)e.hasOwnProperty(s)&&i.push(t.call(n||null,s,e[s]));return i},filter:function(e,t,n){if(e.filter)return e.filter(t,n);for(var i=[],r=0,o=e.length;o>r;r++)t.call(n||null,e[r],r)&&i.push(e[r]);return i},asyncEach:function(e,t,n,i){var r=e.length,o=-1,s=0,a=!1,c=function(){return s-=1,o+=1,o===r?n&&n.call(i):void t(e[o],u)},l=function(){if(!a){for(a=!0;s>0;)c();a=!1}},u=function(){s+=1,l()};u()},toJSON:function(e){return this.stringify?this.stringify(e,function(e,t){return this[e]instanceof Array?this[e]:t}):JSON.stringify(e)}};"undefined"!=typeof module?module.exports=Faye:"undefined"!=typeof window&&(window.Faye=Faye),Faye.Class=function(e,t){"function"!=typeof e&&(t=e,e=Object);var n=function(){return this.initialize?this.initialize.apply(this,arguments)||this:this},i=function(){};return i.prototype=e.prototype,n.prototype=new i,Faye.extend(n.prototype,t),n},function(){function e(e,t){if(e.indexOf)return e.indexOf(t);for(var n=0;n<e.length;n++)if(t===e[n])return n;return-1}var t=Faye.EventEmitter=function(){},n="function"==typeof Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)};t.prototype.emit=function(e){if("error"===e&&(!this._events||!this._events.error||n(this._events.error)&&!this._events.error.length))throw arguments[1]instanceof Error?arguments[1]:new Error("Uncaught, unspecified 'error' event.");if(!this._events)return!1;var t=this._events[e];if(!t)return!1;if("function"==typeof t){switch(arguments.length){case 1:t.call(this);break;case 2:t.call(this,arguments[1]);break;case 3:t.call(this,arguments[1],arguments[2]);break;default:var i=Array.prototype.slice.call(arguments,1);t.apply(this,i)}return!0}if(n(t)){for(var i=Array.prototype.slice.call(arguments,1),r=t.slice(),o=0,s=r.length;s>o;o++)r[o].apply(this,i);return!0}return!1},t.prototype.addListener=function(e,t){if("function"!=typeof t)throw new Error("addListener only takes instances of Function");return this._events||(this._events={}),this.emit("newListener",e,t),this._events[e]?n(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,this},t.prototype.on=t.prototype.addListener,t.prototype.once=function(e,t){var n=this;return n.on(e,function i(){n.removeListener(e,i),t.apply(this,arguments)}),this},t.prototype.removeListener=function(t,i){if("function"!=typeof i)throw new Error("removeListener only takes instances of Function");if(!this._events||!this._events[t])return this;var r=this._events[t];if(n(r)){var o=e(r,i);if(0>o)return this;r.splice(o,1),0==r.length&&delete this._events[t]}else this._events[t]===i&&delete this._events[t];return this},t.prototype.removeAllListeners=function(e){return 0===arguments.length?(this._events={},this):(e&&this._events&&this._events[e]&&(this._events[e]=null),this)},t.prototype.listeners=function(e){return this._events||(this._events={}),this._events[e]||(this._events[e]=[]),n(this._events[e])||(this._events[e]=[this._events[e]]),this._events[e]}}(),Faye.Namespace=Faye.Class({initialize:function(){this._used={}},exists:function(e){return this._used.hasOwnProperty(e)},generate:function(){for(var e=Faye.random();this._used.hasOwnProperty(e);)e=Faye.random();return this._used[e]=e},release:function(e){delete this._used[e]}}),function(){var e,t=setTimeout;e="function"==typeof setImmediate?function(e){setImmediate(e)}:"object"==typeof process&&process.nextTick?function(e){process.nextTick(e)}:function(e){t(e,0)};var n=0,i=1,r=2,o=function(e){return e},s=function(e){throw e},a=function(e){if(this._state=n,this._onFulfilled=[],this._onRejected=[],"function"==typeof e){var t=this;e(function(e){p(t,e)},function(e){h(t,e)})}};a.prototype.then=function(e,t){var n=new a;return c(this,e,n),l(this,t,n),n};var c=function(e,t,r){"function"!=typeof t&&(t=o);var s=function(e){u(t,e,r)};e._state===n?e._onFulfilled.push(s):e._state===i&&s(e._value)},l=function(e,t,i){"function"!=typeof t&&(t=s);var o=function(e){u(t,e,i)};e._state===n?e._onRejected.push(o):e._state===r&&o(e._reason)},u=function(t,n,i){e(function(){d(t,n,i)})},d=function(e,t,n){var i;try{i=e(t)}catch(r){return h(n,r)}i===n?h(n,new TypeError("Recursive promise chain detected")):p(n,i)},p=a.fulfill=a.resolve=function(e,t){var n,i,r=!1;try{if(n=typeof t,i=null!==t&&("function"===n||"object"===n)&&t.then,"function"!=typeof i)return f(e,t);i.call(t,function(t){r^(r=!0)&&p(e,t)},function(t){r^(r=!0)&&h(e,t)})}catch(o){if(!(r^(r=!0)))return;h(e,o)}},f=function(e,t){if(e._state===n){e._state=i,e._value=t,e._onRejected=[];for(var r,o=e._onFulfilled;r=o.shift();)r(t)}},h=a.reject=function(e,t){if(e._state===n){e._state=r,e._reason=t,e._onFulfilled=[];for(var i,o=e._onRejected;i=o.shift();)i(t)}};a.all=function(e){return new a(function(t,n){var i,r=[],o=e.length;if(0===o)return t(r);for(i=0;o>i;i++)(function(e,i){a.fulfilled(e).then(function(e){r[i]=e,0===--o&&t(r)},n)})(e[i],i)})},a.defer=e,a.deferred=a.pending=function(){var e={};return e.promise=new a(function(t,n){e.fulfill=e.resolve=t,e.reject=n}),e},a.fulfilled=a.resolved=function(e){return new a(function(t,n){t(e)})},a.rejected=function(e){return new a(function(t,n){n(e)})},"undefined"==typeof Faye?module.exports=a:Faye.Promise=a}(),Faye.Set=Faye.Class({initialize:function(){this._index={}},add:function(e){var t=void 0!==e.id?e.id:e;return this._index.hasOwnProperty(t)?!1:(this._index[t]=e,!0)},forEach:function(e,t){for(var n in this._index)this._index.hasOwnProperty(n)&&e.call(t,this._index[n])},isEmpty:function(){for(var e in this._index)if(this._index.hasOwnProperty(e))return!1;return!0},member:function(e){for(var t in this._index)if(this._index[t]===e)return!0;return!1},remove:function(e){var t=void 0!==e.id?e.id:e,n=this._index[t];return delete this._index[t],n},toArray:function(){var e=[];return this.forEach(function(t){e.push(t)}),e}}),Faye.URI={isURI:function(e){return e&&e.protocol&&e.host&&e.path},isSameOrigin:function(e){var t=Faye.ENV.location;return e.protocol===t.protocol&&e.hostname===t.hostname&&e.port===t.port},parse:function(e){if("string"!=typeof e)return e;var t,n,i,r,o,s,a={},c=function(t,n){e=e.replace(n,function(e){return a[t]=e,""}),a[t]=a[t]||""};for(c("protocol",/^[a-z]+\:/i),c("host",/^\/\/[^\/\?#]+/),/^\//.test(e)||a.host||(e=Faye.ENV.location.pathname.replace(/[^\/]*$/,"")+e),c("pathname",/^[^\?#]*/),c("search",/^\?[^#]*/),c("hash",/^#.*/),a.protocol=a.protocol||Faye.ENV.location.protocol,a.host?(a.host=a.host.substr(2),t=a.host.split(":"),a.hostname=t[0],a.port=t[1]||""):(a.host=Faye.ENV.location.host,a.hostname=Faye.ENV.location.hostname,a.port=Faye.ENV.location.port),a.pathname=a.pathname||"/",a.path=a.pathname+a.search,n=a.search.replace(/^\?/,""),i=n?n.split("&"):[],s={},r=0,o=i.length;o>r;r++)t=i[r].split("="),s[decodeURIComponent(t[0]||"")]=decodeURIComponent(t[1]||"");return a.query=s,a.href=this.stringify(a),a},stringify:function(e){var t=e.protocol+"//"+e.hostname;return e.port&&(t+=":"+e.port),t+=e.pathname+this.queryString(e.query)+(e.hash||"")},queryString:function(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(encodeURIComponent(n)+"="+encodeURIComponent(e[n]));return 0===t.length?"":"?"+t.join("&")}},Faye.Error=Faye.Class({initialize:function(e,t,n){this.code=e,this.params=Array.prototype.slice.call(t),this.message=n},toString:function(){return this.code+":"+this.params.join(",")+":"+this.message}}),Faye.Error.parse=function(e){if(e=e||"",!Faye.Grammar.ERROR.test(e))return new this(null,[],e);var t=e.split(":"),n=parseInt(t[0]),i=t[1].split(","),e=t[2];return new this(n,i,e)},Faye.Error.versionMismatch=function(){return new this(300,arguments,"Version mismatch").toString()},Faye.Error.conntypeMismatch=function(){return new this(301,arguments,"Connection types not supported").toString()},Faye.Error.extMismatch=function(){return new this(302,arguments,"Extension mismatch").toString()},Faye.Error.badRequest=function(){return new this(400,arguments,"Bad request").toString()},Faye.Error.clientUnknown=function(){return new this(401,arguments,"Unknown client").toString()},Faye.Error.parameterMissing=function(){return new this(402,arguments,"Missing required parameter").toString()},Faye.Error.channelForbidden=function(){return new this(403,arguments,"Forbidden channel").toString()},Faye.Error.channelUnknown=function(){return new this(404,arguments,"Unknown channel").toString()},Faye.Error.channelInvalid=function(){return new this(405,arguments,"Invalid channel").toString()},Faye.Error.extUnknown=function(){return new this(406,arguments,"Unknown extension").toString()},Faye.Error.publishFailed=function(){return new this(407,arguments,"Failed to publish").toString()},Faye.Error.serverError=function(){return new this(500,arguments,"Internal server error").toString()},Faye.Deferrable={then:function(e,t){var n=this;return this._promise||(this._promise=new Faye.Promise(function(e,t){n._fulfill=e,n._reject=t})),0===arguments.length?this._promise:this._promise.then(e,t)},callback:function(e,t){return this.then(function(n){e.call(t,n)})},errback:function(e,t){return this.then(null,function(n){e.call(t,n)})},timeout:function(e,t){this.then();var n=this;this._timer=Faye.ENV.setTimeout(function(){n._reject(t)},1e3*e)},setDeferredStatus:function(e,t){this._timer&&Faye.ENV.clearTimeout(this._timer),this.then(),"succeeded"===e?this._fulfill(t):"failed"===e?this._reject(t):delete this._promise}},Faye.Publisher={countListeners:function(e){return this.listeners(e).length},bind:function(e,t,n){var i=Array.prototype.slice,r=function(){t.apply(n,i.call(arguments))};return this._listeners=this._listeners||[],this._listeners.push([e,t,n,r]),this.on(e,r)},unbind:function(e,t,n){this._listeners=this._listeners||[];for(var i,r=this._listeners.length;r--;)i=this._listeners[r],i[0]===e&&(!t||i[1]===t&&i[2]===n)&&(this._listeners.splice(r,1),this.removeListener(e,i[3]))}},Faye.extend(Faye.Publisher,Faye.EventEmitter.prototype),Faye.Publisher.trigger=Faye.Publisher.emit,Faye.Timeouts={addTimeout:function(e,t,n,i){if(this._timeouts=this._timeouts||{},!this._timeouts.hasOwnProperty(e)){var r=this;this._timeouts[e]=Faye.ENV.setTimeout(function(){delete r._timeouts[e],n.call(i)},1e3*t)}},removeTimeout:function(e){this._timeouts=this._timeouts||{};var t=this._timeouts[e];t&&(Faye.ENV.clearTimeout(t),delete this._timeouts[e])},removeAllTimeouts:function(){this._timeouts=this._timeouts||{};for(var e in this._timeouts)this.removeTimeout(e)}},Faye.Logging={LOG_LEVELS:{fatal:4,error:3,warn:2,info:1,debug:0},writeLog:function(e,t){if(Faye.logger){var n=Array.prototype.slice.apply(e),i="[Faye",r=this.className,o=n.shift().replace(/\?/g,function(){try{return Faye.toJSON(n.shift())}catch(e){return"[Object]"}});for(var s in Faye)r||"function"==typeof Faye[s]&&this instanceof Faye[s]&&(r=s);r&&(i+="."+r),i+="] ","function"==typeof Faye.logger[t]?Faye.logger[t](i+o):"function"==typeof Faye.logger&&Faye.logger(i+o)}}},function(){for(var e in Faye.Logging.LOG_LEVELS)(function(e){Faye.Logging[e]=function(){this.writeLog(arguments,e)}})(e)}(),Faye.Grammar={CHANNEL_NAME:/^\/(((([a-z]|[A-Z])|[0-9])|(\-|\_|\!|\~|\(|\)|\$|\@)))+(\/(((([a-z]|[A-Z])|[0-9])|(\-|\_|\!|\~|\(|\)|\$|\@)))+)*$/,CHANNEL_PATTERN:/^(\/(((([a-z]|[A-Z])|[0-9])|(\-|\_|\!|\~|\(|\)|\$|\@)))+)*\/\*{1,2}$/,ERROR:/^([0-9][0-9][0-9]:(((([a-z]|[A-Z])|[0-9])|(\-|\_|\!|\~|\(|\)|\$|\@)| |\/|\*|\.))*(,(((([a-z]|[A-Z])|[0-9])|(\-|\_|\!|\~|\(|\)|\$|\@)| |\/|\*|\.))*)*:(((([a-z]|[A-Z])|[0-9])|(\-|\_|\!|\~|\(|\)|\$|\@)| |\/|\*|\.))*|[0-9][0-9][0-9]::(((([a-z]|[A-Z])|[0-9])|(\-|\_|\!|\~|\(|\)|\$|\@)| |\/|\*|\.))*)$/,VERSION:/^([0-9])+(\.(([a-z]|[A-Z])|[0-9])(((([a-z]|[A-Z])|[0-9])|\-|\_))*)*$/},Faye.Extensible={addExtension:function(e){this._extensions=this._extensions||[],this._extensions.push(e),e.added&&e.added(this)},removeExtension:function(e){if(this._extensions)for(var t=this._extensions.length;t--;)this._extensions[t]===e&&(this._extensions.splice(t,1),e.removed&&e.removed(this))},pipeThroughExtensions:function(e,t,n,i,r){if(this.debug("Passing through ? extensions: ?",e,t),!this._extensions)return i.call(r,t);var o=this._extensions.slice(),s=function(t){if(!t)return i.call(r,t);var a=o.shift();if(!a)return i.call(r,t);var c=a[e];return c?void(c.length>=3?a[e](t,n,s):a[e](t,s)):s(t)};s(t)}},Faye.extend(Faye.Extensible,Faye.Logging),Faye.Channel=Faye.Class({initialize:function(e){this.id=this.name=e},push:function(e){this.trigger("message",e)},isUnused:function(){return 0===this.countListeners("message")}}),Faye.extend(Faye.Channel.prototype,Faye.Publisher),Faye.extend(Faye.Channel,{HANDSHAKE:"/meta/handshake",CONNECT:"/meta/connect",SUBSCRIBE:"/meta/subscribe",UNSUBSCRIBE:"/meta/unsubscribe",DISCONNECT:"/meta/disconnect",META:"meta",SERVICE:"service",expand:function(e){var t=this.parse(e),n=["/**",e],i=t.slice();i[i.length-1]="*",n.push(this.unparse(i));for(var r=1,o=t.length;o>r;r++)i=t.slice(0,r),i.push("**"),n.push(this.unparse(i));return n},isValid:function(e){return Faye.Grammar.CHANNEL_NAME.test(e)||Faye.Grammar.CHANNEL_PATTERN.test(e)},parse:function(e){return this.isValid(e)?e.split("/").slice(1):null},unparse:function(e){return"/"+e.join("/")},isMeta:function(e){var t=this.parse(e);return t?t[0]===this.META:null},isService:function(e){var t=this.parse(e);return t?t[0]===this.SERVICE:null},isSubscribable:function(e){return this.isValid(e)?!this.isMeta(e)&&!this.isService(e):null},Set:Faye.Class({initialize:function(){this._channels={}},getKeys:function(){var e=[];for(var t in this._channels)e.push(t);return e},remove:function(e){delete this._channels[e]},hasSubscription:function(e){return this._channels.hasOwnProperty(e)},subscribe:function(e,t,n){for(var i,r=0,o=e.length;o>r;r++){i=e[r];var s=this._channels[i]=this._channels[i]||new Faye.Channel(i);t&&s.bind("message",t,n)}},unsubscribe:function(e,t,n){var i=this._channels[e];return i?(i.unbind("message",t,n),i.isUnused()?(this.remove(e),!0):!1):!1},distributeMessage:function(e){for(var t=Faye.Channel.expand(e.channel),n=0,i=t.length;i>n;n++){var r=this._channels[t[n]];r&&r.trigger("message",e.data)}}})}),Faye.Publication=Faye.Class(Faye.Deferrable),Faye.Subscription=Faye.Class({initialize:function(e,t,n,i){this._client=e,this._channels=t,this._callback=n,this._context=i,this._cancelled=!1},cancel:function(){this._cancelled||(this._client.unsubscribe(this._channels,this._callback,this._context),this._cancelled=!0)},unsubscribe:function(){this.cancel()}}),Faye.extend(Faye.Subscription.prototype,Faye.Deferrable),Faye.Client=Faye.Class({UNCONNECTED:1,CONNECTING:2,CONNECTED:3,DISCONNECTED:4,HANDSHAKE:"handshake",RETRY:"retry",NONE:"none",CONNECTION_TIMEOUT:60,DEFAULT_ENDPOINT:"/bayeux",INTERVAL:0,initialize:function(e,t){this.info("New client created for ?",e),t=t||{},Faye.validateOptions(t,["interval","timeout","endpoints","proxy","retry","scheduler","websocketExtensions","tls","ca"]),this._endpoint=e||this.DEFAULT_ENDPOINT,this._channels=new Faye.Channel.Set,this._dispatcher=new Faye.Dispatcher(this,this._endpoint,t),this._messageId=0,this._state=this.UNCONNECTED,this._responseCallbacks={},this._advice={reconnect:this.RETRY,interval:1e3*(t.interval||this.INTERVAL),timeout:1e3*(t.timeout||this.CONNECTION_TIMEOUT)},this._dispatcher.timeout=this._advice.timeout/1e3,this._dispatcher.bind("message",this._receiveMessage,this),Faye.Event&&void 0!==Faye.ENV.onbeforeunload&&Faye.Event.on(Faye.ENV,"beforeunload",function(){Faye.indexOf(this._dispatcher._disabled,"autodisconnect")<0&&this.disconnect()},this)},addWebsocketExtension:function(e){return this._dispatcher.addWebsocketExtension(e)},disable:function(e){return this._dispatcher.disable(e)},setHeader:function(e,t){return this._dispatcher.setHeader(e,t)},handshake:function(e,t){if(this._advice.reconnect!==this.NONE&&this._state===this.UNCONNECTED){this._state=this.CONNECTING;var n=this;this.info("Initiating handshake with ?",Faye.URI.stringify(this._endpoint)),this._dispatcher.selectTransport(Faye.MANDATORY_CONNECTION_TYPES),this._sendMessage({channel:Faye.Channel.HANDSHAKE,version:Faye.BAYEUX_VERSION,supportedConnectionTypes:this._dispatcher.getConnectionTypes()},{},function(i){i.successful?(this._state=this.CONNECTED,this._dispatcher.clientId=i.clientId,this._dispatcher.selectTransport(i.supportedConnectionTypes),this.info("Handshake successful: ?",this._dispatcher.clientId),
this.subscribe(this._channels.getKeys(),!0),e&&Faye.Promise.defer(function(){e.call(t)})):(this.info("Handshake unsuccessful"),Faye.ENV.setTimeout(function(){n.handshake(e,t)},1e3*this._dispatcher.retry),this._state=this.UNCONNECTED)},this)}},connect:function(e,t){if(this._advice.reconnect!==this.NONE&&this._state!==this.DISCONNECTED){if(this._state===this.UNCONNECTED)return this.handshake(function(){this.connect(e,t)},this);this.callback(e,t),this._state===this.CONNECTED&&(this.info("Calling deferred actions for ?",this._dispatcher.clientId),this.setDeferredStatus("succeeded"),this.setDeferredStatus("unknown"),this._connectRequest||(this._connectRequest=!0,this.info("Initiating connection for ?",this._dispatcher.clientId),this._sendMessage({channel:Faye.Channel.CONNECT,clientId:this._dispatcher.clientId,connectionType:this._dispatcher.connectionType},{},this._cycleConnection,this)))}},disconnect:function(){if(this._state===this.CONNECTED){this._state=this.DISCONNECTED,this.info("Disconnecting ?",this._dispatcher.clientId);var e=new Faye.Publication;return this._sendMessage({channel:Faye.Channel.DISCONNECT,clientId:this._dispatcher.clientId},{},function(t){t.successful?(this._dispatcher.close(),e.setDeferredStatus("succeeded")):e.setDeferredStatus("failed",Faye.Error.parse(t.error))},this),this.info("Clearing channel listeners for ?",this._dispatcher.clientId),this._channels=new Faye.Channel.Set,e}},subscribe:function(e,t,n){if(e instanceof Array)return Faye.map(e,function(e){return this.subscribe(e,t,n)},this);var i=new Faye.Subscription(this,e,t,n),r=t===!0,o=this._channels.hasSubscription(e);return o&&!r?(this._channels.subscribe([e],t,n),i.setDeferredStatus("succeeded"),i):(this.connect(function(){this.info("Client ? attempting to subscribe to ?",this._dispatcher.clientId,e),r||this._channels.subscribe([e],t,n),this._sendMessage({channel:Faye.Channel.SUBSCRIBE,clientId:this._dispatcher.clientId,subscription:e},{},function(r){if(!r.successful)return i.setDeferredStatus("failed",Faye.Error.parse(r.error)),this._channels.unsubscribe(e,t,n);var o=[].concat(r.subscription);this.info("Subscription acknowledged for ? to ?",this._dispatcher.clientId,o),i.setDeferredStatus("succeeded")},this)},this),i)},unsubscribe:function(e,t,n){if(e instanceof Array)return Faye.map(e,function(e){return this.unsubscribe(e,t,n)},this);var i=this._channels.unsubscribe(e,t,n);i&&this.connect(function(){this.info("Client ? attempting to unsubscribe from ?",this._dispatcher.clientId,e),this._sendMessage({channel:Faye.Channel.UNSUBSCRIBE,clientId:this._dispatcher.clientId,subscription:e},{},function(e){if(e.successful){var t=[].concat(e.subscription);this.info("Unsubscription acknowledged for ? from ?",this._dispatcher.clientId,t)}},this)},this)},publish:function(e,t,n){Faye.validateOptions(n||{},["attempts","deadline"]);var i=new Faye.Publication;return this.connect(function(){this.info("Client ? queueing published message to ?: ?",this._dispatcher.clientId,e,t),this._sendMessage({channel:e,data:t,clientId:this._dispatcher.clientId},n,function(e){e.successful?i.setDeferredStatus("succeeded"):i.setDeferredStatus("failed",Faye.Error.parse(e.error))},this)},this),i},_sendMessage:function(e,t,n,i){e.id=this._generateMessageId();var r=this._advice.timeout?1.2*this._advice.timeout/1e3:1.2*this._dispatcher.retry;this.pipeThroughExtensions("outgoing",e,null,function(e){e&&(n&&(this._responseCallbacks[e.id]=[n,i]),this._dispatcher.sendMessage(e,r,t||{}))},this)},_generateMessageId:function(){return this._messageId+=1,this._messageId>=Math.pow(2,32)&&(this._messageId=0),this._messageId.toString(36)},_receiveMessage:function(e){var t,n=e.id;void 0!==e.successful&&(t=this._responseCallbacks[n],delete this._responseCallbacks[n]),this.pipeThroughExtensions("incoming",e,null,function(e){e&&(e.advice&&this._handleAdvice(e.advice),this._deliverMessage(e),t&&t[0].call(t[1],e))},this)},_handleAdvice:function(e){Faye.extend(this._advice,e),this._dispatcher.timeout=this._advice.timeout/1e3,this._advice.reconnect===this.HANDSHAKE&&this._state!==this.DISCONNECTED&&(this._state=this.UNCONNECTED,this._dispatcher.clientId=null,this._cycleConnection())},_deliverMessage:function(e){e.channel&&void 0!==e.data&&(this.info("Client ? calling listeners for ? with ?",this._dispatcher.clientId,e.channel,e.data),this._channels.distributeMessage(e))},_cycleConnection:function(){this._connectRequest&&(this._connectRequest=null,this.info("Closed connection for ?",this._dispatcher.clientId));var e=this;Faye.ENV.setTimeout(function(){e.connect()},this._advice.interval)}}),Faye.extend(Faye.Client.prototype,Faye.Deferrable),Faye.extend(Faye.Client.prototype,Faye.Publisher),Faye.extend(Faye.Client.prototype,Faye.Logging),Faye.extend(Faye.Client.prototype,Faye.Extensible),Faye.Dispatcher=Faye.Class({MAX_REQUEST_SIZE:2048,DEFAULT_RETRY:5,UP:1,DOWN:2,initialize:function(e,t,n){this._client=e,this.endpoint=Faye.URI.parse(t),this._alternates=n.endpoints||{},this.cookies=Faye.Cookies&&new Faye.Cookies.CookieJar,this._disabled=[],this._envelopes={},this.headers={},this.retry=n.retry||this.DEFAULT_RETRY,this._scheduler=n.scheduler||Faye.Scheduler,this._state=0,this.transports={},this.wsExtensions=[],this.proxy=n.proxy||{},"string"==typeof this._proxy&&(this._proxy={origin:this._proxy});var i=n.websocketExtensions;if(i){i=[].concat(i);for(var r=0,o=i.length;o>r;r++)this.addWebsocketExtension(i[r])}this.tls=n.tls||{},this.tls.ca=this.tls.ca||n.ca;for(var s in this._alternates)this._alternates[s]=Faye.URI.parse(this._alternates[s]);this.maxRequestSize=this.MAX_REQUEST_SIZE},endpointFor:function(e){return this._alternates[e]||this.endpoint},addWebsocketExtension:function(e){this.wsExtensions.push(e)},disable:function(e){this._disabled.push(e)},setHeader:function(e,t){this.headers[e]=t},close:function(){var e=this._transport;delete this._transport,e&&e.close()},getConnectionTypes:function(){return Faye.Transport.getConnectionTypes()},selectTransport:function(e){Faye.Transport.get(this,e,this._disabled,function(e){this.debug("Selected ? transport for ?",e.connectionType,Faye.URI.stringify(e.endpoint)),e!==this._transport&&(this._transport&&this._transport.close(),this._transport=e,this.connectionType=e.connectionType)},this)},sendMessage:function(e,t,n){n=n||{};var i,r=e.id,o=n.attempts,s=n.deadline&&(new Date).getTime()+1e3*n.deadline,a=this._envelopes[r];a||(i=new this._scheduler(e,{timeout:t,interval:this.retry,attempts:o,deadline:s}),a=this._envelopes[r]={message:e,scheduler:i}),this._sendEnvelope(a)},_sendEnvelope:function(e){if(this._transport&&!e.request&&!e.timer){var t=e.message,n=e.scheduler,i=this;if(!n.isDeliverable())return n.abort(),void delete this._envelopes[t.id];e.timer=Faye.ENV.setTimeout(function(){i.handleError(t)},1e3*n.getTimeout()),n.send(),e.request=this._transport.sendMessage(t)}},handleResponse:function(e){var t=this._envelopes[e.id];void 0!==e.successful&&t&&(t.scheduler.succeed(),delete this._envelopes[e.id],Faye.ENV.clearTimeout(t.timer)),this.trigger("message",e),this._state!==this.UP&&(this._state=this.UP,this._client.trigger("transport:up"))},handleError:function(e,t){var n=this._envelopes[e.id],i=n&&n.request,r=this;if(i){i.then(function(e){e&&e.abort&&e.abort()});var o=n.scheduler;o.fail(),Faye.ENV.clearTimeout(n.timer),n.request=n.timer=null,t?this._sendEnvelope(n):n.timer=Faye.ENV.setTimeout(function(){n.timer=null,r._sendEnvelope(n)},1e3*o.getInterval()),this._state!==this.DOWN&&(this._state=this.DOWN,this._client.trigger("transport:down"))}}}),Faye.extend(Faye.Dispatcher.prototype,Faye.Publisher),Faye.extend(Faye.Dispatcher.prototype,Faye.Logging),Faye.Scheduler=function(e,t){this.message=e,this.options=t,this.attempts=0},Faye.extend(Faye.Scheduler.prototype,{getTimeout:function(){return this.options.timeout},getInterval:function(){return this.options.interval},isDeliverable:function(){var e=this.options.attempts,t=this.attempts,n=this.options.deadline,i=(new Date).getTime();return void 0!==e&&t>=e?!1:void 0!==n&&i>n?!1:!0},send:function(){this.attempts+=1},succeed:function(){},fail:function(){},abort:function(){}}),Faye.Transport=Faye.extend(Faye.Class({DEFAULT_PORTS:{"http:":80,"https:":443,"ws:":80,"wss:":443},SECURE_PROTOCOLS:["https:","wss:"],MAX_DELAY:0,batching:!0,initialize:function(e,t){this._dispatcher=e,this.endpoint=t,this._outbox=[],this._proxy=Faye.extend({},this._dispatcher.proxy),!this._proxy.origin&&Faye.NodeAdapter&&(this._proxy.origin=Faye.indexOf(this.SECURE_PROTOCOLS,this.endpoint.protocol)>=0?process.env.HTTPS_PROXY||process.env.https_proxy:process.env.HTTP_PROXY||process.env.http_proxy)},close:function(){},encode:function(e){return""},sendMessage:function(e){return this.debug("Client ? sending message to ?: ?",this._dispatcher.clientId,Faye.URI.stringify(this.endpoint),e),this.batching?(this._outbox.push(e),this._promise=this._promise||new Faye.Promise,this._flushLargeBatch(),e.channel===Faye.Channel.HANDSHAKE?(this.addTimeout("publish",.01,this._flush,this),this._promise):(e.channel===Faye.Channel.CONNECT&&(this._connectMessage=e),this.addTimeout("publish",this.MAX_DELAY,this._flush,this),this._promise)):Faye.Promise.fulfilled(this.request([e]))},_flush:function(){this.removeTimeout("publish"),this._outbox.length>1&&this._connectMessage&&(this._connectMessage.advice={timeout:0}),Faye.Promise.fulfill(this._promise,this.request(this._outbox)),delete this._promise,this._connectMessage=null,this._outbox=[]},_flushLargeBatch:function(){var e=this.encode(this._outbox);if(!(e.length<this._dispatcher.maxRequestSize)){var t=this._outbox.pop();this._flush(),t&&this._outbox.push(t)}},_receive:function(e){if(e){e=[].concat(e),this.debug("Client ? received from ? via ?: ?",this._dispatcher.clientId,Faye.URI.stringify(this.endpoint),this.connectionType,e);for(var t=0,n=e.length;n>t;t++)this._dispatcher.handleResponse(e[t])}},_handleError:function(e,t){e=[].concat(e),this.debug("Client ? failed to send to ? via ?: ?",this._dispatcher.clientId,Faye.URI.stringify(this.endpoint),this.connectionType,e);for(var n=0,i=e.length;i>n;n++)this._dispatcher.handleError(e[n])},_getCookies:function(){var e=this._dispatcher.cookies,t=Faye.URI.stringify(this.endpoint);return e?Faye.map(e.getCookiesSync(t),function(e){return e.cookieString()}).join("; "):""},_storeCookies:function(e){var t,n=this._dispatcher.cookies,i=Faye.URI.stringify(this.endpoint);if(e&&n){e=[].concat(e);for(var r=0,o=e.length;o>r;r++)t=Faye.Cookies.Cookie.parse(e[r]),n.setCookieSync(t,i)}}}),{get:function(e,t,n,i,r){var o=e.endpoint;Faye.asyncEach(this._transports,function(o,s){var a=o[0],c=o[1],l=e.endpointFor(a);return Faye.indexOf(n,a)>=0?s():Faye.indexOf(t,a)<0?(c.isUsable(e,l,function(){}),s()):void c.isUsable(e,l,function(t){if(!t)return s();var n=c.hasOwnProperty("create")?c.create(e,l):new c(e,l);i.call(r,n)})},function(){throw new Error("Could not find a usable connection type for "+Faye.URI.stringify(o))})},register:function(e,t){this._transports.push([e,t]),t.prototype.connectionType=e},getConnectionTypes:function(){return Faye.map(this._transports,function(e){return e[0]})},_transports:[]}),Faye.extend(Faye.Transport.prototype,Faye.Logging),Faye.extend(Faye.Transport.prototype,Faye.Timeouts),Faye.Event={_registry:[],on:function(e,t,n,i){var r=function(){n.call(i)};e.addEventListener?e.addEventListener(t,r,!1):e.attachEvent("on"+t,r),this._registry.push({_element:e,_type:t,_callback:n,_context:i,_handler:r})},detach:function(e,t,n,i){for(var r,o=this._registry.length;o--;)r=this._registry[o],e&&e!==r._element||t&&t!==r._type||n&&n!==r._callback||i&&i!==r._context||(r._element.removeEventListener?r._element.removeEventListener(r._type,r._handler,!1):r._element.detachEvent("on"+r._type,r._handler),this._registry.splice(o,1),r=null)}},void 0!==Faye.ENV.onunload&&Faye.Event.on(Faye.ENV,"unload",Faye.Event.detach,Faye.Event),"object"!=typeof JSON&&(JSON={}),function(){function f(e){return 10>e?"0"+e:e}function quote(e){return escapable.lastIndex=0,escapable.test(e)?'"'+e.replace(escapable,function(e){var t=meta[e];return"string"==typeof t?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}function str(e,t){var n,i,r,o,s,a=gap,c=t[e];switch(c&&"object"==typeof c&&"function"==typeof c.toJSON&&(c=c.toJSON(e)),"function"==typeof rep&&(c=rep.call(t,e,c)),typeof c){case"string":return quote(c);case"number":return isFinite(c)?String(c):"null";case"boolean":case"null":return String(c);case"object":if(!c)return"null";if(gap+=indent,s=[],"[object Array]"===Object.prototype.toString.apply(c)){for(o=c.length,n=0;o>n;n+=1)s[n]=str(n,c)||"null";return r=0===s.length?"[]":gap?"[\n"+gap+s.join(",\n"+gap)+"\n"+a+"]":"["+s.join(",")+"]",gap=a,r}if(rep&&"object"==typeof rep)for(o=rep.length,n=0;o>n;n+=1)"string"==typeof rep[n]&&(i=rep[n],r=str(i,c),r&&s.push(quote(i)+(gap?": ":":")+r));else for(i in c)Object.prototype.hasOwnProperty.call(c,i)&&(r=str(i,c),r&&s.push(quote(i)+(gap?": ":":")+r));return r=0===s.length?"{}":gap?"{\n"+gap+s.join(",\n"+gap)+"\n"+a+"}":"{"+s.join(",")+"}",gap=a,r}}"function"!=typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()});var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;Faye.stringify=function(e,t,n){var i;if(gap="",indent="","number"==typeof n)for(i=0;n>i;i+=1)indent+=" ";else"string"==typeof n&&(indent=n);if(rep=t,t&&"function"!=typeof t&&("object"!=typeof t||"number"!=typeof t.length))throw new Error("JSON.stringify");return str("",{"":e})},"function"!=typeof JSON.stringify&&(JSON.stringify=Faye.stringify),"function"!=typeof JSON.parse&&(JSON.parse=function(text,reviver){function walk(e,t){var n,i,r=e[t];if(r&&"object"==typeof r)for(n in r)Object.prototype.hasOwnProperty.call(r,n)&&(i=walk(r,n),void 0!==i?r[n]=i:delete r[n]);return reviver.call(e,t,r)}var j;if(text=String(text),cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(e){return"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})),/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),"function"==typeof reviver?walk({"":j},""):j;throw new SyntaxError("JSON.parse")})}(),Faye.Transport.WebSocket=Faye.extend(Faye.Class(Faye.Transport,{UNCONNECTED:1,CONNECTING:2,CONNECTED:3,batching:!1,isUsable:function(e,t){this.callback(function(){e.call(t,!0)}),this.errback(function(){e.call(t,!1)}),this.connect()},request:function(e){this._pending=this._pending||new Faye.Set;for(var t=0,n=e.length;n>t;t++)this._pending.add(e[t]);var i=new Faye.Promise;return this.callback(function(t){t&&1===t.readyState&&(t.send(Faye.toJSON(e)),Faye.Promise.fulfill(i,t))},this),this.connect(),{abort:function(){i.then(function(e){e.close()})}}},connect:function(){if(!Faye.Transport.WebSocket._unloaded&&(this._state=this._state||this.UNCONNECTED,this._state===this.UNCONNECTED)){this._state=this.CONNECTING;var e=this._createSocket();if(!e)return this.setDeferredStatus("failed");var t=this;e.onopen=function(){e.headers&&t._storeCookies(e.headers["set-cookie"]),t._socket=e,t._state=t.CONNECTED,t._everConnected=!0,t._ping(),t.setDeferredStatus("succeeded",e)};var n=!1;e.onclose=e.onerror=function(){if(!n){n=!0;var i=t._state===t.CONNECTED;e.onopen=e.onclose=e.onerror=e.onmessage=null,delete t._socket,t._state=t.UNCONNECTED,t.removeTimeout("ping"),t.setDeferredStatus("unknown");var r=t._pending?t._pending.toArray():[];delete t._pending,i?t._handleError(r,!0):t._everConnected?t._handleError(r):t.setDeferredStatus("failed")}},e.onmessage=function(e){var n=JSON.parse(e.data);if(n){n=[].concat(n);for(var i=0,r=n.length;r>i;i++)void 0!==n[i].successful&&t._pending.remove(n[i]);t._receive(n)}}}},close:function(){this._socket&&this._socket.close()},_createSocket:function(){var e=Faye.Transport.WebSocket.getSocketUrl(this.endpoint),t=this._dispatcher.headers,n=this._dispatcher.wsExtensions,i=this._getCookies(),r=this._dispatcher.tls,o={extensions:n,headers:t,proxy:this._proxy,tls:r};return""!==i&&(o.headers.Cookie=i),Faye.WebSocket?new Faye.WebSocket.Client(e,[],o):Faye.ENV.MozWebSocket?new MozWebSocket(e):Faye.ENV.WebSocket?new WebSocket(e):void 0},_ping:function(){this._socket&&(this._socket.send("[]"),this.addTimeout("ping",this._dispatcher.timeout/2,this._ping,this))}}),{PROTOCOLS:{"http:":"ws:","https:":"wss:"},create:function(e,t){var n=e.transports.websocket=e.transports.websocket||{};return n[t.href]=n[t.href]||new this(e,t),n[t.href]},getSocketUrl:function(e){return e=Faye.copyObject(e),e.protocol=this.PROTOCOLS[e.protocol],Faye.URI.stringify(e)},isUsable:function(e,t,n,i){this.create(e,t).isUsable(n,i)}}),Faye.extend(Faye.Transport.WebSocket.prototype,Faye.Deferrable),Faye.Transport.register("websocket",Faye.Transport.WebSocket),Faye.Event&&void 0!==Faye.ENV.onbeforeunload&&Faye.Event.on(Faye.ENV,"beforeunload",function(){Faye.Transport.WebSocket._unloaded=!0}),Faye.Transport.EventSource=Faye.extend(Faye.Class(Faye.Transport,{initialize:function(e,t){if(Faye.Transport.prototype.initialize.call(this,e,t),!Faye.ENV.EventSource)return this.setDeferredStatus("failed");this._xhr=new Faye.Transport.XHR(e,t),t=Faye.copyObject(t),t.pathname+="/"+e.clientId;var n=new EventSource(Faye.URI.stringify(t)),i=this;n.onopen=function(){i._everConnected=!0,i.setDeferredStatus("succeeded")},n.onerror=function(){i._everConnected?i._handleError([]):(i.setDeferredStatus("failed"),n.close())},n.onmessage=function(e){i._receive(JSON.parse(e.data))},this._socket=n},close:function(){this._socket&&(this._socket.onopen=this._socket.onerror=this._socket.onmessage=null,this._socket.close(),delete this._socket)},isUsable:function(e,t){this.callback(function(){e.call(t,!0)}),this.errback(function(){e.call(t,!1)})},encode:function(e){return this._xhr.encode(e)},request:function(e){return this._xhr.request(e)}}),{isUsable:function(e,t,n,i){var r=e.clientId;return r?void Faye.Transport.XHR.isUsable(e,t,function(r){return r?void this.create(e,t).isUsable(n,i):n.call(i,!1)},this):n.call(i,!1)},create:function(e,t){var n=e.transports.eventsource=e.transports.eventsource||{},i=e.clientId,r=Faye.copyObject(t);return r.pathname+="/"+(i||""),r=Faye.URI.stringify(r),n[r]=n[r]||new this(e,t),n[r]}}),Faye.extend(Faye.Transport.EventSource.prototype,Faye.Deferrable),Faye.Transport.register("eventsource",Faye.Transport.EventSource),Faye.Transport.XHR=Faye.extend(Faye.Class(Faye.Transport,{encode:function(e){return Faye.toJSON(e)},request:function(e){var t=this.endpoint.href,n=Faye.ENV.ActiveXObject?new ActiveXObject("Microsoft.XMLHTTP"):new XMLHttpRequest,i=this;n.open("POST",t,!0),n.setRequestHeader("Content-Type","application/json"),n.setRequestHeader("Pragma","no-cache"),n.setRequestHeader("X-Requested-With","XMLHttpRequest");var r=this._dispatcher.headers;for(var o in r)r.hasOwnProperty(o)&&n.setRequestHeader(o,r[o]);var s=function(){n.abort()};return void 0!==Faye.ENV.onbeforeunload&&Faye.Event.on(Faye.ENV,"beforeunload",s),n.onreadystatechange=function(){if(n&&4===n.readyState){var t=null,r=n.status,o=n.responseText,a=r>=200&&300>r||304===r||1223===r;if(void 0!==Faye.ENV.onbeforeunload&&Faye.Event.detach(Faye.ENV,"beforeunload",s),n.onreadystatechange=function(){},n=null,!a)return i._handleError(e);try{t=JSON.parse(o)}catch(c){}t?i._receive(t):i._handleError(e)}},n.send(this.encode(e)),n}}),{isUsable:function(e,t,n,i){n.call(i,Faye.URI.isSameOrigin(t))}}),Faye.Transport.register("long-polling",Faye.Transport.XHR),Faye.Transport.CORS=Faye.extend(Faye.Class(Faye.Transport,{encode:function(e){return"message="+encodeURIComponent(Faye.toJSON(e))},request:function(e){var t,n=Faye.ENV.XDomainRequest?XDomainRequest:XMLHttpRequest,i=new n,r=++Faye.Transport.CORS._id,o=this._dispatcher.headers,s=this;if(i.open("POST",Faye.URI.stringify(this.endpoint),!0),i.setRequestHeader){i.setRequestHeader("Pragma","no-cache");for(t in o)o.hasOwnProperty(t)&&i.setRequestHeader(t,o[t])}var a=function(){return i?(Faye.Transport.CORS._pending.remove(r),i.onload=i.onerror=i.ontimeout=i.onprogress=null,void(i=null)):!1};return i.onload=function(){var t=null;try{t=JSON.parse(i.responseText)}catch(n){}a(),t?s._receive(t):s._handleError(e)},i.onerror=i.ontimeout=function(){a(),s._handleError(e)},i.onprogress=function(){},n===Faye.ENV.XDomainRequest&&Faye.Transport.CORS._pending.add({id:r,xhr:i}),i.send(this.encode(e)),i}}),{_id:0,_pending:new Faye.Set,isUsable:function(e,t,n,i){if(Faye.URI.isSameOrigin(t))return n.call(i,!1);if(Faye.ENV.XDomainRequest)return n.call(i,t.protocol===Faye.ENV.location.protocol);if(Faye.ENV.XMLHttpRequest){var r=new Faye.ENV.XMLHttpRequest;return n.call(i,void 0!==r.withCredentials)}return n.call(i,!1)}}),Faye.Transport.register("cross-origin-long-polling",Faye.Transport.CORS),Faye.Transport.JSONP=Faye.extend(Faye.Class(Faye.Transport,{encode:function(e){var t=Faye.copyObject(this.endpoint);return t.query.message=Faye.toJSON(e),t.query.jsonp="__jsonp"+Faye.Transport.JSONP._cbCount+"__",Faye.URI.stringify(t)},request:function(e){var t=document.getElementsByTagName("head")[0],n=document.createElement("script"),i=Faye.Transport.JSONP.getCallbackName(),r=Faye.copyObject(this.endpoint),o=this;r.query.message=Faye.toJSON(e),r.query.jsonp=i;var s=function(){if(!Faye.ENV[i])return!1;Faye.ENV[i]=void 0;try{delete Faye.ENV[i]}catch(e){}n.parentNode.removeChild(n)};return Faye.ENV[i]=function(e){s(),o._receive(e)},n.type="text/javascript",n.src=Faye.URI.stringify(r),t.appendChild(n),n.onerror=function(){s(),o._handleError(e)},{abort:s}}}),{_cbCount:0,getCallbackName:function(){return this._cbCount+=1,"__jsonp"+this._cbCount+"__"},isUsable:function(e,t,n,i){n.call(i,!0)}}),Faye.Transport.register("callback-polling",Faye.Transport.JSONP)}()}).call(this,require("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{_process:4}],4:[function(e,t,n){function i(){}var r=t.exports={};r.nextTick=function(){var e="undefined"!=typeof window&&window.setImmediate,t="undefined"!=typeof window&&window.postMessage&&window.addEventListener;if(e)return function(e){return window.setImmediate(e)};if(t){var n=[];return window.addEventListener("message",function(e){var t=e.source;if((t===window||null===t)&&"process-tick"===e.data&&(e.stopPropagation(),n.length>0)){var i=n.shift();i()}},!0),function(e){n.push(e),window.postMessage("process-tick","*")}}return function(e){setTimeout(e,0)}}(),r.title="browser",r.browser=!0,r.env={},r.argv=[],r.on=i,r.addListener=i,r.once=i,r.off=i,r.removeListener=i,r.removeAllListeners=i,r.emit=i,r.binding=function(e){throw new Error("process.binding is not supported")},r.cwd=function(){return"/"},r.chdir=function(e){throw new Error("process.chdir is not supported")}},{}],5:[function(e,t,n){"use strict";function i(e){return e&&"EPROMISERETRY"===e.code&&a.call(e,"retried")}function r(e,t){var n,r;return"object"==typeof e&&"function"==typeof t&&(n=t,t=e,e=n),r=s.operation(t),new Promise(function(t,n){r.attempt(function(s){Promise.resolve().then(function(){return e(function(e){throw i(e)&&(e=e.retried),o("Retrying","EPROMISERETRY",{retried:e})},s)}).then(t,function(e){i(e)&&(e=e.retried,r.retry(e||new Error))||n(e)})})})}var o=e("err-code"),s=e("retry"),a=Object.prototype.hasOwnProperty;t.exports=r},{"err-code":2,retry:6}],6:[function(e,t,n){t.exports=e("./lib/retry")},{"./lib/retry":7}],7:[function(e,t,n){var i=e("./retry_operation");n.operation=function(e){var t=n.timeouts(e);return new i(t,{forever:e&&e.forever,unref:e&&e.unref})},n.timeouts=function(e){if(e instanceof Array)return[].concat(e);var t={retries:10,factor:2,minTimeout:1e3,maxTimeout:1/0,randomize:!1};for(var n in e)t[n]=e[n];if(t.minTimeout>t.maxTimeout)throw new Error("minTimeout is greater than maxTimeout");for(var i=[],r=0;r<t.retries;r++)i.push(this.createTimeout(r,t));return i.sort(function(e,t){return e-t}),i},n.createTimeout=function(e,t){var n=t.randomize?Math.random()+1:1,i=Math.round(n*t.minTimeout*Math.pow(t.factor,e));return i=Math.min(i,t.maxTimeout)},n.wrap=function(e,t,i){if(t instanceof Array&&(i=t,t=null),!i){i=[];for(var r in e)"function"==typeof e[r]&&i.push(r)}for(var o=0;o<i.length;o++){var s=i[o],a=e[s];e[s]=function(){var i=n.operation(t),r=Array.prototype.slice.call(arguments),o=r.pop();r.push(function(e){i.retry(e)||(e&&(arguments[0]=i.mainError()),o.apply(this,arguments))}),i.attempt(function(){a.apply(e,r)})},e[s].options=t}}},{"./retry_operation":8}],8:[function(e,t,n){function i(e,t){"boolean"==typeof t&&(t={forever:t}),this._timeouts=e,this._options=t||{},this._fn=null,this._errors=[],this._attempts=1,this._operationTimeout=null,this._operationTimeoutCb=null,this._timeout=null,this._options.forever&&(this._cachedTimeouts=this._timeouts.slice(0))}t.exports=i,i.prototype.retry=function(e){if(this._timeout&&clearTimeout(this._timeout),!e)return!1;this._errors.push(e);var t=this._timeouts.shift();if(void 0===t){if(!this._cachedTimeouts)return!1;this._errors.splice(this._errors.length-1,this._errors.length),this._timeouts=this._cachedTimeouts.slice(0),t=this._timeouts.shift()}var n=this,i=setTimeout(function(){n._attempts++,n._operationTimeoutCb&&(n._timeout=setTimeout(function(){n._operationTimeoutCb(n._attempts)},n._operationTimeout),this._options.unref&&n._timeout.unref()),n._fn(n._attempts)},t);return this._options.unref&&i.unref(),!0},i.prototype.attempt=function(e,t){this._fn=e,t&&(t.timeout&&(this._operationTimeout=t.timeout),t.cb&&(this._operationTimeoutCb=t.cb));var n=this;this._operationTimeoutCb&&(this._timeout=setTimeout(function(){n._operationTimeoutCb()},n._operationTimeout)),this._fn(this._attempts)},i.prototype["try"]=function(e){console.log("Using RetryOperation.try() is deprecated"),this.attempt(e)},i.prototype.start=function(e){console.log("Using RetryOperation.start() is deprecated"),this.attempt(e)},i.prototype.start=i.prototype["try"],i.prototype.errors=function(){return this._errors},i.prototype.attempts=function(){return this._attempts},i.prototype.mainError=function(){if(0===this._errors.length)return null;for(var e={},t=null,n=0,i=0;i<this._errors.length;i++){var r=this._errors[i],o=r.message,s=(e[o]||0)+1;e[o]=s,s>=n&&(t=r,n=s)}return t}},{}],9:[function(e,t,n){function i(e,t,n,i,r,o,s,a,c,l,u,d,p,f){function h(){$(o).on("external-access-timeout",p.notifyAuthFailed),$(o).on("rental-expiry",p.notifyRentalExpiry),r.onData(function(){r.onAccess(function(){r.isShared()&&p.notifySharedAccess()})}),Promise.all([g(),m()]).then(p.notifyReadPersonal)}function g(){return new Promise(function(e){o.onExternalCheck(function(){!r.hasAccess()&&e()})})}function m(){return new Promise(function(e){r.onInit(function(){s.item.get().then(function(t){t.item.pdf_hash&&e()},_.noop)})})}e.trackPdfToolbar=!0,e.download=function(e){return d.download(e)},e.print=function(e){return d.print(e)},$(window).on("keydown",function(e){(e.metaKey||e.ctrlKey)&&(70==e.keyCode?a.loadAll():80==e.keyCode&&(e.preventDefault(),d.print()))}),$(l).on("update",function(){u.available().then(p.notifyUpdateAvailable)}),$(l).on("toast",function(e,t){p.notifyMessage(t)}),r.onInit(function(e){a.setPreviewData(e)["catch"](function(e){if(!e||"load_html_fail"!=e.error)throw e;$.get(i.ip_api,function(t){(trackJs||window).console.log("load html fail location:",t),f(e,{country:t.country})}).always(function(){setTimeout(function(){r.onData(function(e){n.redirectOrPost(e.meta.pdf_url)})},300)})})}),r.onAccessCheck(function(e){r.hasAccess()&&a.setFullData(e)}),$(a).on("page-changed",function(e,t){c.scroll(t)}),h()}i.$inject=["$scope","$state","util","endpoint","article","access","sync","viewer","tracker","command","update","articleExport","toast","trackError"],angular.module("reader").controller("ArticleCtrl",i)},{}],10:[function(e,t,n){function i(e,t,n,i,r,o,s,a,c,l){function u(){"wiley"==r.get().publisher&&t(function(){e.publisherPageLabel="Go to HTML"})}function d(){r.get().doi&&(e.defaultAction={handler:e.openRelated,tooltip:"Related Articles",icon:"layers"})}function p(){r.get().doi&&n.get(sprintf("%s/v1/doi/%s",s.altmetric,r.get().doi),{params:{key:l.altmetric}}).then(function(t){e.altmetric={images:t.data.images,score:Math.ceil(t.data.score),detailsUrl:f(t.data,r.get().publisher)}},_.noop)}function f(e,t){return/nature|wiley|ats/.test(t)?("ats"==t&&(t="atsjournals"),sprintf("%s//%s.altmetric.com/details/%s",location.protocol,t,e.altmetric_id)):e.details_url}e.user=o,e.article=r,e.tracker=a,e.altmetric=void 0,e.publisherPageLabel=void 0,e.notes=c.listArr(),r.onInit(function(e){u(),d(),p()}),$(c).on("changed",function(){t(function(){e.notes=c.listArr()})}),e.toolsEnabled=function(){return r.get().doi||e.notesEnabled()},e.notesEnabled=function(){return o.signedIn()&&r.hasAccess()&&!r.get().sync_item_sponsored},e.gotoPublisher=function(){window.open(r.getProxiedUrl(),"_blank"),a.linkout("publisher")},e.openAltmetric=function(){window.open(e.altmetric.detailsUrl,"_blank"),a.altmetric()},e["export"]=function(e){i.show(i.alert({targetEvent:e,clickOutsideToClose:!0,templateUrl:"dialogs/export.html",controller:"ExportCtrl"})),a.exportOptions()},e.share=function(e){i.show(i.alert({targetEvent:e,clickOutsideToClose:!0,templateUrl:"dialogs/share.html",controller:"ShareCtrl"}))}}i.$inject=["$scope","$timeout","$http","$mdDialog","article","user","endpoint","tracker","annotationsModel","API_KEYS"],angular.module("reader").controller("ArticleToolsCtrl",i)},{}],11:[function(e,t,n){function i(e,t,n,i,r,o){i.onInit(function(i){$("body").addClass("publisher-"+(i.original_publisher||i.publisher)),r.setPreviewData(i)["catch"](function(){t.go("error.404",null,{location:!1})}),n(function(){e.articleUrl=[o.dx_doi,i.doi].join("/")})})}i.$inject=["$scope","$state","$timeout","article","viewer","endpoint"],angular.module("reader").controller("DiscoverCtrl",i)},{}],12:[function(e,t,n){function i(e,t,n,i,r){function o(){return t.is("error.404")?"Possible Broken Link (404)":"Possible Server Error (500)"}function s(){return sprintf("I cannot load the following webpage: %s",location.href)}function a(e,t){return sprintf("mailto:support@readcube.com?subject=%s&body=%s",encodeURIComponent(e),encodeURIComponent(t))}e.showCode=!1,e.showMessage=!1,e.supportHref=a(o(),s()),e.edgeSupportHref=["http://support.readcube.com/knowledgebase/articles","815760-i-can-t-open-pdfs-from-the-web-library-app-in-edge"].join("/"),i.visible().then(function(){r.start(),n(function(){e.showCode=!0},600),n(function(){e.showMessage=!0},1200)})}i.$inject=["$scope","$state","$timeout","visibility","errorAnimation"],angular.module("reader").controller("ErrorCtrl",i)},{}],13:[function(e,t,n){function i(e,t,n){function i(t){e.index!=t&&(e.index=t,e.busy=!0)}e.busy=!0,e.detailsOpen=!0,e.figures=n.get().figures||[],e.showNav=e.figures.length>1,e.toggleDetails=function(){e.detailsOpen=!e.detailsOpen},e.figure=function(){return e.figures[e.index]},e.next=function(){i((e.index+1)%e.figures.length)},e.prev=function(){i((e.index+e.figures.length-1)%e.figures.length)},$(window).on("keydown.figure-viewer",function(n){if(!n.metaKey&&!n.ctrlKey)switch(n.keyCode){case 37:case 38:t(e.prev);break;case 39:case 40:t(e.next)}}),e.$on("$destroy",function(){$(window).off("keydown.figure-viewer")})}i.$inject=["$scope","$timeout","article"],angular.module("reader").controller("FigureViewerCtrl",i)},{}],14:[function(e,t,n){function i(e,t,n,i,r,o,s,a,c,l,u,d,p,f){function h(){return d.saveCloud(),a.item.add().then(u.showSyncedAd)["catch"](_.noop)}function g(){return a.item.remove()["catch"](_.noop)}function m(){$(a.item).on("busy",function(){n(function(){e.syncing=!0})}),$(a.item).on("done",function(){n(function(){e.syncing=!1})}),a.item.onAdd(function(){n(function(){e.inLibrary=!0})}),a.item.onRemove(function(){n(function(){e.inLibrary=!1})}),c.onInit(function(t){"wiley"==t.publisher&&n(function(){e.publisherLinkout=function(){window.open(v(),"_blank"),d.linkout("publisher")}})})}function v(){return c.get().meta?c.getProxiedUrl():sprintf("%s/%s",s.dx_doi,c.get().doi)}e.user=o,e.article=c,e.syncing=!1,e.inLibrary=!1,e.downloading=!1,e.downloadPdf=function(t){e.downloading=!0,p.download(t)["finally"](function(){n(function(){e.downloading=!1})}),d.menuBar("download_pdf")},e.toggleInLibrary=function(t){e.syncing||(e.inLibrary?g():(o.signedIn()?h():f.showRegister({params:{tracking_action:"add_to_library",tracking_origin:d.trackingOrigin()},onAuth:function(){l.onLoginCheck(h)},loginAd:"ads/add_to_library.html",targetEvent:t}),d.menuBar("add_to_library")))},e.openMoreMenu=function(e,t){e(t)},e.onAppMenuClick=function(t){t.stopPropagation(),o.signedIn()?e.toggleAppNav():f.showRegister({params:{tracking_action:"toolbar_signup",tracking_origin:d.trackingOrigin()},targetEvent:t})},t.toggleAppNav=function(){i("appnav").toggle(),i("appnav").isOpen()&&(t.$emit("appnav-open"),d.sidepanel("library"))},t.closeAppNav=function(){i("appnav").close(),t.$emit("appnav-close")},m()}i.$inject=["$scope","$rootScope","$timeout","$mdSidenav","$sce","user","endpoint","sync","article","access","toast","tracker","articleExport","userModal"],angular.module("reader").controller("MenuBarCtrl",i)},{}],15:[function(e,t,n){function i(e,t,n,i,r,o,s,a,c,l,u,d){function p(){return u.saveCloud(),a.item.add().then(l.showSyncedAd)["catch"](_.noop)}function f(){return a.item.remove()["catch"](_.noop)}function h(){return i.get().meta?i.getProxiedUrl():sprintf("%s/%s",r.dx_doi,i.get().doi)}e.user=o,e.article=i,e.inLibrary=!1,e.signIn=function(e){s.showRegister({params:{tracking_action:"toolbar_signup",tracking_origin:u.trackingOrigin()},targetEvent:e})},e.signOut=function(){d.clear(),location.href=r.web+"/session/log_out"},e.gotoPublisher=function(){window.open(h(),"_blank"),u.linkout("publisher")},e.toggleInLibrary=function(t){e.inLibrary?f():(o.signedIn()?p():s.showRegister({params:{tracking_action:"add_to_library",tracking_origin:u.trackingOrigin()},onAuth:function(){c.onLoginCheck(p)},loginAd:"ads/add_to_library.html",targetEvent:t}),u.menuBar("add_to_library"))},t.feed_token&&$("body").addClass("article-feed"),a.item.onAdd(function(){n(function(){e.inLibrary=!0})}),a.item.onRemove(function(){n(function(){e.inLibrary=!1})}),i.onInit(function(e){$("body").addClass("initialized"),e.publisher&&i.isBrandable()&&$("body").addClass("publisher-"+e.publisher),window.parent.postMessage({type:"initialized"},"*")}),i.onData(function(t){$("body").addClass("metadata"),e.$emit("start-read-mode"),n(function(){e.metadata=t.meta,e.supplements=t.supplements,e.references=t.references,e.figures=t.figures})}),i.onData(function(){i.onAccess(function(){i.isShared()&&l.notifySharedAccess()})}),i.onAccessCheck(function(e){e.pdf_url&&$("body").addClass("can-save"),e.print_url&&$("body").addClass("can-print")})}i.$inject=["$scope","$stateParams","$timeout","article","endpoint","user","userSidenav","sync","access","toast","tracker","trackId"],angular.module("reader").controller("MobileReaderCtrl",i)},{}],16:[function(e,t,n){function i(e,t,n,i,r,o){e.pageIdx=1,e.numPages=1,e.downloading=!1,e.download=function(n){e.downloading=!0,o.download(n)["finally"](function(){t(function(){e.downloading=!1})}),i.menuBar("download_pdf")},e.menu=function(){n("mobile_menu").toggle()},e.prevPage=function(){r.gotoPage(r.getPage()-1)},e.nextPage=function(){r.gotoPage(r.getPage()+1)},r.onInit(function(){t(function(){e.numPages=r.numPages()})}),$(r).on("page-changed",function(n,i){t(function(){e.pageIdx=i})})}i.$inject=["$scope","$timeout","$mdSidenav","tracker","mobileViewer","articleExport"],angular.module("reader").controller("MobileToolbarCtrl",i)},{}],17:[function(e,t,n){function i(e,t,n,i){function r(){return parseInt(i.session.get(s()))||10}function o(e){i.session.set(s(),Math.min(e,60))}function s(){return["processing-refresh",a()].join(":")}function a(){return t.resource_id.split(":").pop()}e.refresh=r();var c=n(function(){--e.refresh>0||(n.cancel(c),o(2*r()),location.reload())},1e3)}i.$inject=["$scope","$stateParams","$interval","storage"],angular.module("reader").controller("ProcessingCtrl",i)},{}],18:[function(e,t,n){function i(e,t,n,i,r,o,s,a,c,l,u,d){e.env=a,e.article=c,e.metadata=void 0,e.related=void 0,e.references=void 0,e.supplements=void 0,e.figures=void 0,e.goNext=void 0,e.goPrev=void 0,e.openRelated=function(){r("related").open(),u.related(),u.sidepanel("related"),c.getRelated().then(function(t){o(function(){e.related=t||[]})})},e.openReferences=function(){r("references").open(),u.sidepanel("references")},e.openMetrics=function(){l.signedIn()?(r("cited-by").open(),n.$emit("cited-by-open"),u.sidepanel("cited_by")):d.promptRegister(function(){r("cited-by").open(),n.$emit("cited-by-open"),u.sidepanel("cited_by")})},e.openSupplements=function(){r("supplements").open(),u.sidepanel("supplements")},e.openFigures=function(){r("figures").open(),u.sidepanel("figures")},t.feed_token&&$("body").addClass("article-feed"),c.onInit(function(t){$("body").addClass("initialized"),t.publisher&&c.isBrandable()&&$("body").addClass("publisher-"+t.publisher),window.parent.postMessage({type:"initialized"},"*"),o(function(){t.sync_next_item_id&&(e.goNext=function(){s.redirectOrPost(i.href("sponsored",{resource_id:[t.sync_collection_id,t.sync_next_item_id].join(":")},{absolute:!0}))}),t.sync_prev_item_id&&(e.goPrev=function(){s.redirectOrPost(i.href("sponsored",{resource_id:[t.sync_collection_id,t.sync_prev_item_id].join(":")},{absolute:!0}))})})}),c.onData(function(t){$("body").addClass("metadata"),e.$emit("start-read-mode"),o(function(){e.metadata=t.meta,e.supplements=t.supplements,e.references=t.references,e.figures=t.figures})}),c.onAccessCheck(function(e){e.pdf_url&&$("body").addClass("can-save"),e.print_url&&$("body").addClass("can-print")})}i.$inject=["$scope","$stateParams","$rootScope","$state","$mdSidenav","$timeout","util","environment","article","user","tracker","toast"],angular.module("reader").controller("ReaderCtrl",i)},{}],19:[function(e,t,n){function i(e,t,n,i,r){e.types=n.types.split(","),i.onInit(function(e){r.setPreviewData(e)["catch"](function(e){if(!e||"load_html_fail"!=e.error)throw e;t.go("error.404",null,{location:!1})})}),i.onAccess(function(e){r.setFullData(e)})}i.$inject=["$scope","$state","$stateParams","article","viewer"],angular.module("reader").controller("ResolveCtrl",i)},{}],20:[function(e,t,n){function i(e,t,n,i,r,o,s){e.article=i,e.toolbarLinks=void 0,e.notes=o.listArr(),i.onInit(function(t){$("body").addClass("initialized"),t.publisher&&i.isBrandable()&&$("body").addClass("publisher-"+t.publisher),(t.download_url||t.url)&&$("body").addClass("can-save"),r.setPreviewData(t)["catch"](function(e){if(!e||"load_html_fail"!=e.error)throw e;s(e)}),r.setFullData(t),e.$emit("start-read-mode"),e.caption=t.caption||["Supplement",parseInt(t.index)+1].join(" "),e.type=t.type.toUpperCase().slice(0,4).replace(/\W/,""),n(function(){e.toolbarLinks={save:{target:t.download_url?void 0:"_blank",href:t.download_url||t.url}}})}),$(i).on("resources-expired",function(){i.updateSupplement().then(r.setFullData)}),$(o).on("changed",function(){n(function(){e.notes=o.listArr()})})}i.$inject=["$scope","$state","$timeout","article","viewer","annotationsModel","trackError"],angular.module("reader").controller("SupplementCtrl",i)},{}],21:[function(e,t,n){function i(e,t,n,i){function r(t){e.trackPdfToolbar&&i.pdfToolbar(t)}e.printing=!1,e.downloading=!1,e.disabled={fullscreen_exit:!0},e.toolbar={zoom_in:function(){n.scaleBy(1.25),r("zoom_in")},zoom_out:function(){n.scaleBy(.8),r("zoom_out")},rotate_right:function(){n.rotatePageBy(90),r("rotate")},fullscreen:function(){n.fitWidth(),r("fit_width"),e.disabled.fullscreen=!0,e.disabled.fullscreen_exit=!1},fullscreen_exit:function(){n.fitPage(),n.gotoPage(n.getPage()),r("fit_page"),e.disabled.fullscreen=!1,e.disabled.fullscreen_exit=!0},keyboard_arrow_down:function(){n.gotoPage(n.getPage()+1),r("page_down")},keyboard_arrow_up:function(){n.gotoPage(n.getPage()-1),r("page_up")},save:function(n){e.download&&!e.downloading&&(e.downloading=!0,e.download(n)["finally"](function(){t(function(){e.downloading=!1})}),r("save"))},print:function(n){e.print&&!e.printing&&(e.printing=!0,e.print(n)["finally"](function(){t(function(){e.printing=!1})}),r("print"))}}}i.$inject=["$scope","$timeout","viewer","tracker"],angular.module("reader").controller("ViewerToolbarCtrl",i)},{}],22:[function(e,t,n){function i(e,t,n,i,r){e.titleAction=r,e.msgAction={download:"saving",print:"printing"}[r],e.close=function(){n.hide()},i.onData(function(){t(function(){e.articleUrl=i.getProxiedUrl()})})}i.$inject=["$scope","$timeout","$mdDialog","article","action"],angular.module("reader").controller("ComplimentaryCtrl",i)},{}],23:[function(e,t,n){function i(e,t,n,i,r){function o(e){return"bibtex"==e?"bib":"ris"}var s={type:"text/plain;charset=UTF-8"};e.format="ris",e["export"]=function(e){var a=n.get().meta,c=new Blob([r[o(e)](a,!0)],s);saveAs(c,encodeURIComponent(r.getKey(a)+"."+o(e))),i.exportCitation(e),t.hide()}}i.$inject=["$scope","$mdDialog","article","tracker","exporter"],angular.module("reader").controller("ExportCtrl",i)},{}],24:[function(e,t,n){function i(e,t,n,i){e.synced=!1,e.endpoint=n,e.printPdf=function(){i.pdf().then(function(){t.hide()})},e.cloudPrint=function(){i.cloud().then(function(){t.hide()})},e.sendToMobile=function(){i.mobile().then(function(){e.synced=!0})}}i.$inject=["$scope","$mdDialog","endpoint","articlePrint"],angular.module("reader").controller("PrintCtrl",i)},{}],25:[function(e,t,n){function i(e,t,n){function i(){e.busy=!0,n.generate(e.includeAnnotations).then(function(n){t(function(){e.shareLink=n.shared_access_url})})["finally"](function(){t(function(){e.busy=!1})})}e.busy=!1,e.includeAnnotations=!1,e.shareLink="Generating Link...",e.$watch("includeAnnotations",function(e,t){e!=t&&i()}),e.select=function(e){e.preventDefault(),e.target.select()},i()}i.$inject=["$scope","$timeout","share"],angular.module("reader").controller("ShareCtrl",i)},{}],26:[function(e,t,n){function i(e,t,n,i){e.titleAction=i,e.msgAction={download:"Saving",print:"Printing"}[i],e.close=function(){t.hide()},n.get().purchased_at&&(e.purchaseDate=new Date(1e3*n.get().purchased_at),e.purchaseType={1:"48-hour Rental",2:"Cloud Access"}[n.get().purchase_tier])}i.$inject=["$scope","$mdDialog","article","action"],angular.module("reader").controller("UnavailableCtrl",i)},{}],27:[function(e,t,n){function i(e,t,n,i,r,o,s,a){function c(e){var t=i.merge(i.pickDefined(n,a),{index:e.index});return t.parent_url&&(t.parent_url=1),t}function l(e){var n=t.href("supplement",c(e));window.open(n,"_blank")}e.viewSupplement=function(e,t){"video"==t.type?(e.preventDefault(),o.video(),s(t)):t.stylesheet&&(e.preventDefault(),o.supplement(),l(t))}}i.$inject=["$scope","$state","$stateParams","util","article","tracker","videoPlayer","SUPPL_PARAMS"],angular.module("reader").controller("SupplementsCtrl",i)},{}],28:[function(e,t,n){function i(e,t,n,i,r,o,n,s){function a(){return o.saveCloud(),r.item.add().then(n.showSyncedAd)["catch"](_.noop)}e.close=function(){n.hide()},e.addToLibrary=function(e){n.hide(t),i.signedIn()?a():s.showRegister({params:{tracking_action:"annotations_notification",tracking_origin:o.trackingOrigin()},onAuth:a,loginAd:"ads/add_to_library.html",targetEvent:e})}}i.$inject=["$scope","toastId","toast","user","sync","tracker","toast","userModal"],angular.module("reader").controller("AnnotsNotSyncedCtrl",i)},{}],29:[function(e,t,n){function i(e,t,n,i,r){e.articleUrl=void 0,e.close=function(){i.hide()},n.onData(function(i){t(function(){e.articleUrl=n.getProxiedUrl()})}),n.onAccessCheck(function(){n.hasFullAccess()&&i.hide(r)})}i.$inject=["$scope","$timeout","article","toast","toastId"],angular.module("reader").controller("AuthFailCtrl",i)},{}],30:[function(e,t,n){function i(e,t,n,i,r,o,s){e.close=function(){n.hide()},e.register=function(){s.showRegister({params:{tracking_action:"metrics_register_prompt",tracking_origin:r.trackingOrigin()},onAuth:o})},e.login=function(){s.showLogin({params:{tracking_action:"metrics_login_prompt",tracking_origin:r.trackingOrigin()},onAuth:o})},i.onSignIn(function(){n.hide(t)})}i.$inject=["$scope","toastId","toast","user","tracker","onAuth","userModal"],angular.module("reader").controller("PromptRegisterCtrl",i)},{}],31:[function(e,t,n){function i(e,t,n,i,r,o){t.close=function(){r.hide()},t.openPersonal=function(){o.item.get().then(function(t){i.redirectOrPost(e.href("library",{resource_id:[t.item.collection_id,t.item.id].join(":")},{absolute:!0}))},_.noop)}}i.$inject=["$state","$scope","$timeout","util","toast","sync"],angular.module("reader").controller("ReadPersonalCtrl",i)},{}],32:[function(e,t,n){function i(e,t,n,i,r){function o(){a()>=0?e.expiresIn=a():n.cancel(o.promise)}function s(){return 1e3*r.get().expires_at}function a(){return s()-Date.now()}e.expiresIn=void 0,e.expiredOn=void 0,e.close=function(){i.hide()},e.$on("$destroy",function(){n.cancel(o.promise)}),a()>=0?(o(),o.promise=n(o,1e3)):e.expiredOn=s()}i.$inject=["$scope","$timeout","$interval","toast","article"],angular.module("reader").controller("RentalExpiryCtrl",i)},{}],33:[function(e,t,n){function i(e,t,n,i,r,o){e.gotoPublisher=void 0,e.whatsThisLink="http://www.nature.com/npg_/company_info/content-sharing.html","author_token"==i.get().access_method?(e.publisherName="Springer Nature",e.message="Online access to this article has been shared by the author(s) via the Springer Nature sharing initiative."):(e.publisherName="Nature",e.message="Online access to this article has been provided by the nature.com content sharing initiative."),e.close=function(){r.hide()},i.onData(function(){t(function(){e.gotoPublisher=function(){n.redirectOrPost(i.getProxiedUrl())}})}),i.onAccessCheck(function(){i.hasFullAccess()&&r.hide(o)})}i.$inject=["$scope","$timeout","util","article","toast","toastId"],angular.module("reader").controller("SharedAccessCtrl",i)},{}],34:[function(e,t,n){function i(e,t,n){e.endpoint=t,e.close=function(){n.hide()}}i.$inject=["$scope","endpoint","toast"],angular.module("reader").controller("SyncedAdCtrl",i)},{}],35:[function(e,t,n){function i(e,t,n){e.close=function(){n.hide()},e.reload=function(){t.reload()}}i.$inject=["$scope","update","toast"],angular.module("reader").controller("UpdateAvailableCtrl",i)},{}],36:[function(e,t,n){function i(){return P.get().publisher}function r(e){return S(i())?e.replace(parseUri(e).host,S(i())):e}function o(){var e=I.jsonp_access[i()];return e?r(e):null}function s(){return"http://www.nature.com/articles/doi:"+P.get().doi+".epdf"}function a(){return"nature"==i()?j.addParams(r(s()),{pdf_url:P.get().meta.pdf_url,parent_url:location.toString()}):null}function c(){$(N.all).on("jsonp_access_result",function(e,t){w(t.result)}).on("pdf_size",function(e,t){j.log("pdf size:",t.size),f(),h(t.size)}).on("pdf_size_fail",function(e,t){j.log("get pdf size failed with status:",t.status),f(),F().then(E)})}function l(){o()?g():I.parent?d():p()}function u(){if(D={},M=!1,U=!1,L=!1,P.isPersonal()||P.isFeed())F();else try{$(O).trigger("auth-begin"),P.onData(function(){l(),y()}),X.onSignIn(_)}catch(e){throw $(O).trigger("auth-end"),e}}function d(){window.parent.postMessage({type:"get_pdf_size",pdf_url:P.get().meta.pdf_url},I.parent)}function p(){a()&&(f(),$("<iframe></iframe>").attr("src",a()).addClass("access").appendTo(document.body))}function f(){$("iframe.access").remove()}function h(e){D.size=parseInt(e)||1337,F().then(E)}function g(){I.parent?m():v()}function m(){window.parent.postMessage({type:"jsonp_access_check"},I.parent)}function v(){var e=j.timer.tic(),t=P.get(),n={resource:t.meta.original_doi};t.options&&t.options.cochrane&&(n.pdfType=t.options.cochrane),$.ajax({url:o(),dataType:"jsonp",data:n,success:function(t){j.log("jsonp access response:",j.timer.toc(e)+"ms",t),w(t)}})}function w(e){D.publisher_access_response=j.merge(e,{publisher:i()}),F().then(E)}function y(){setTimeout(function(){U||F()},5e3),setTimeout(function(){L||P.hasFullAccess()||$(O).trigger("external-access-timeout")},12e3)}function _(){F().then(function(){M=!0,$(O).trigger("login-access-check")})}function b(e){M?e():$(O).one("login-access-check",e)}function k(e){L?e():$(O).one("external-access-check",e)}function x(){P.onAccess(function(e){if(e.expires_at){var t=1e3*e.expires_at,n=t-Date.now();n>=0&&Y.add(function(){location.reload(!0)},Date.now()+n),$(O).trigger("rental-expiry",[t])}})}function C(){P.onAccess(function(){$(P).on("resources-expired",u)})}function E(){L=!0,$(O).trigger("external-access-check")}function F(){return U=!0,$(O).trigger("auth-begin"),P.checkAccessWith(D).then(function(e){return $(O).trigger("auth-end"),e},function(e){return $(O).trigger("auth-end"),e})}function A(){I.parent&&k(function(){var e=P.hasAccess()?"access:fulltext":"access:preview";window.parent.postMessage({type:e},I.parent)})}function T(){R||(P.onInit(function(e){A(),c(),u(),C(),x()}),R=!0)}var X=e("./user"),j=e("./utils/util"),Y=e("./utils/alarm_clock"),S=e("./proxy_host"),I=e("./endpoint"),N=e("./receiver"),P=e("./article"),O={},R=!1,D={},M=!1,U=!1,L=!1;O.init=T,O.checkAccess=F,O.onLoginCheck=b,O.onExternalCheck=k,t.exports=O},{"./article":45,"./endpoint":53,"./proxy_host":67,"./receiver":68,"./user":81,"./utils/alarm_clock":83,"./utils/util":96}],37:[function(e,t,n){function i(){return{id:m.guid(),created:m.dateISO(),renderer:"html5",type:"highlight",has_note:!1,color_id:1}}function r(e,t){var n=document.createDocumentFragment();return e.each(function(){var e=this.cloneNode();e.className=t,n.appendChild(e)}),n}function o(e){var t=document.createElement("div");return t.setAttribute("style",["position:absolute","top:"+e.top+"px","left:"+e.left+"px","width:"+e.width+"px","height:"+e.height+"px"].join(";")),t}function s(e){var t=e.getElem()[0].getBoundingClientRect();return new v(t.left,t.top,e.getWidth(),e.getHeight())}function a(e,t){return Math.abs(e.top+e.height-(t.top+t.height))<1}function c(e,t){var n=[];return _.each(e,function(e){var i=n[n.length-1];i&&t(e,i)?i.boundingRect(e):n.push(e)}),n}function l(e,t){var n=[],i=s(e),r=1/e.getScale();return m.getElems(t).each(function(){var e=this.getBoundingClientRect(),t=new v(e.left,e.top,e.width,e.height);t.translate(-i.left,-i.top),t.scale(r,r),n.push(t)}),c(n,a)}function u(e,t){var n=s(e),i=e.getScale();return $.map(t,function(e){var t=new v(e[0],n.height-e[1]-e[3],e[2],e[3]);return t.scale(i,i),t.translate(n.left,n.top),t})}function d(e,t){var n=s(e);return $.map(t,function(e){return[[w.round10(e.left,-1),w.round10(n.height-e.top-e.height,-1),w.round10(e.width,-1),w.round10(e.height,-1)]]})}function p(e,t){var n=s(e);return $.map(t,function(e){return new v(e[0],n.height-e[1]-e[3],e[2],e[3])})}function f(e,t){var n=y.serialize(e,t.getElem(),128);return{preceeding_text:n.prefix,text:n.text}}function h(e,t){return{rects:d(t,l(t,e))}}function g(e,t){var n="html5"==t.renderer,i="swf"==t.renderer,r=!n&&!i,o=null,s={container:e.getElem(),insertWhitespace:!n};return t.text?(t.preceeding_text||(t.preceeding_text=""),r&&!_.isEmpty(t.rects)&&(s.boundingRects=u(e,t.rects)),o||(o=y.deserialize({prefix:t.preceeding_text,text:t.text},s)),!o&&i&&(o=y.deserialize({prefix:t.preceeding_text.slice(0,-1),text:t.text.slice(0,-1)},s)),!o&&i&&(o=y.deserialize({prefix:t.preceeding_text,text:t.text},m.merge(s,{matchMisconverted:!0}))),!o&&r&&(o=y.deserialize({prefix:"",text:t.text},s)),o):null}var m=e("../utils/util"),v=e("../utils/rect"),w=e("../utils/number"),y=e("../utils/range_serializer"),b=e("./annotation_toolbar"),k=function(e,t,n){t=m.merge(i(),t),n=n||g(e,t),this.klass="annotation",this.id=m.guid(),this.page=e,this.data=t,this.range=n,this._initData(),this._initRects(),this._initElems(),this._addDrawable(),this._addEventable(),this._initToolbar()};k.prototype={_initData:function(){!this.data.text&&this.range&&(this.data=m.merge(this.data,f(this.range,this.page))),!this.data.rects&&this.range&&(this.data=m.merge(this.data,h(this.range,this.page)))},_initRects:function(){this.data.rects?this.rects=p(this.page,this.data.rects):this.range&&(this.rects=l(this.page,this.range))},_initElems:function(){var e=[],t=this.page.getZoom();_.each(this.rects,function(n){e.push(o(n.scale(t,t)))}),this._elems=$(e)},_addDrawable:function(){var e=[this.klass+"-elem-draw",this.getColor(),this.id].join(" "),t=this.range?m.getElems(this.range):page.getElem().find(".t");m.hasTransparentText(t)&&(e+=" transparent");var n=r(this._elems,e);this._drawableElems=$(n).children(),this.page.getDrawable().append(n)},_addEventable:function(){var e=[this.klass,this.id].join(" "),t=r(this._elems,e);this._eventableElems=$(t).children(),this.page.getEventable().append(t)},_initToolbar:function(){var e=this;this.toolbar=new b(this),$(this.toolbar).on("add-note",function(){e._setNote(""),e.openToolbar()}).on("set-note",function(){e._setNote(e.toolbar.getNote())}).on("delete",function(){e.toolbar.close(),$(e).trigger("delete")})},_removeEventable:function(){this._eventableElems.remove(),this._eventableElems=null},_removeDrawable:function(){this._drawableElems.remove(),this._drawableElems=null},_destroyToolbar:function(){$(this.toolbar).off("add-note set-note delete"),this.toolbar.destroy(),this.toolbar=null},_setNote:function(e){this.hasNote()&&this.getNote()==e||(this.data.has_note=!0,this.data.note=e,$(this).trigger("change"))},setData:function(e){this.data=m.clone(e)},openToolbar:function(){this.toolbar.open()},hasNote:function(){return this.data.has_note},getElems:function(){return this._eventableElems},getNote:function(){return this.data.note},getColor:function(){var e=parseInt(this.data.color_id);return!e||1>e||e>4?"color-1":"color-"+e},getId:function(){return this.id},getDataId:function(){return this.data.id},getKlass:function(){return this.klass},destroy:function(){this._destroyToolbar(),this._removeEventable(),this._removeDrawable(),this.range=null,this.klass=null,this.data=null,this.page=null},serialize:function(){return m.clone(this.data)}},t.exports=k},{"../utils/number":89,"../utils/range_serializer":90,"../utils/rect":91,"../utils/util":96,"./annotation_toolbar":38}],38:[function(e,t,n){var i=e("./base_toolbar"),r=function(e){this.annot=e,this._init("annotations-base-toolbar","annotation")};r.prototype=$.extend(new i,{_initEvents:function(){this._deleted=!1,this._elem.find(".add-note").click($.proxy(this._onAddNote,this)),this._elem.find(".delete").click($.proxy(this._onDelete,this)),this._textarea().on("keydown",function(e){e.stopPropagation()}),this._textarea().on("keyup",_.debounce($.proxy(this._onSetNote,this),5e3)),this._textarea().on("blur",$.proxy(this._onSetNote,this)),$(this.annot).on("click",$.proxy(this.open,this))},_textarea:function(){return this._elem.find("textarea")},_onAddNote:function(){this._elem.toggleClass("note",!0),$(this).trigger("add-note")},_onDelete:function(){this._deleted=!0,$(this).trigger("delete")},_onSetNote:function(){this._deleted||$(this).trigger("set-note")},getNote:function(){return this._textarea().val()},updateNote:function(){this._textarea().is(":focus")||(this._elem.toggleClass("note",this.annot.hasNote()),this.getNote()!=this.annot.getNote()&&this._textarea().val(this.annot.getNote()||""))},open:function(){this.updateNote(),i.prototype.open.call(this,this.annot.getElems().first(),this.annot.getColor()),this._textarea().is(":visible")&&!this.getNote()&&this._textarea().focus()},destroy:function(){i.prototype.destroy.apply(this),this.selection=null,this.annot=null}}),t.exports=r},{"./base_toolbar":41}],39:[function(e,t,n){function i(e,t){C[e.getId()]=e,y.add(e),$(e).on("change",function(){b.updateItem(e.serialize())}).on("delete",function(){b.removeItem(e.getDataId()),r(e)}),t&&e.openToolbar()}function r(e){$(e).off("change delete"),y.remove(e),delete E[e.getDataId()],delete C[e.getId()],e.destroy()}function o(e){var t=e.page_start+1,n=g.getPageObj(t),r=new k(n,e,null);r&&(delete E[e.id],i(r))}function s(e){var t=e.page_start+1;F[t]=!1,E[e.id]=e,g.onInit(function(){a(t,g.getPageObj(t))})}function a(e,t){if(!F[e]&&t.hasText()){h.timer.tic();for(var n in E){var i=E[n];i&&i.page_start+1==e&&o(i)}F[e]=!0}}function c(e){return _.find(C,function(t){return t.getDataId()==e})}function l(){m.get().sync_item_shared||(E=b.list(),$(g).on("page-loaded",function(e,t){a(t,g.getPageObj(t))}),g.onInit(function(){g.eachPage(a)}),$(b).on("add.external",function(e,t){s(t)}),$(b).on("update.external",function(e,t,n){var i=c(t.id);i&&i.setData(n)}),$(b).on("remove.external",function(e,t){var n=c(t.id);n&&r(n)}),$(b).on(["add.internal","update.internal","remove.internal"].join(" "),u))}function u(){m.hasAccess()&&v.item.get().then(function(e){e.item.pdf_hash||v.item.add()["catch"](_.noop)},_.noop)}function d(e,t,n){var r=g.getPageObj(t),o=new k(r,h.merge(n,{sha256:m.get().hash,page_start:t-1,page_end:t-1}),e);i(o,n.has_note),b.addItem(o.serialize())}function p(e,t,n){d(e,t,{color_id:n}),w.highlight()}function f(e,t,n){d(e,t,{has_note:!0,note:n}),w.note()}var h=e("../utils/util"),g=e("../viewer/viewer"),m=e("../article"),v=e("../sync/sync"),w=e("../tracking/tracker"),y=e("../input_handler"),b=e("./annotations_model"),k=e("./annotation"),x={},C={},E={},F={};l(),x.addHighlight=p,x.addNote=f,t.exports=x},{"../article":45,"../input_handler":66,"../sync/sync":74,"../tracking/tracker":79,"../utils/util":96,"../viewer/viewer":102,"./annotation":37,"./annotations_model":40}],40:[function(e,t,n){function i(e){return e?".internal":".external"}function r(e){$(N).trigger("not-synced",[e])}function o(e,t){$(N).trigger("add"+i(t),[e]).trigger("changed")}function s(e,t,n){$(N).trigger("update"+i(n),[e,t]).trigger("changed")}function a(e,t){$(N).trigger("remove"+i(t),[e]).trigger("changed")}function c(e,t){e.text&&(P[e.id]=e,o(e,t))}function l(e,t,n){P[e.id]&&(_.isEqual(e,t)||(delete P[e.id],P[t.id]=t,s(e,t,n)))}function u(e,t){var n=P[e];n&&(delete P[e],a(n,t))}function d(e){return _.pick(e,["preceeding_text","text","color_id","has_note","note","page_start","page_end"])}function p(e){return CryptoJS.MD5(JSON.stringify(d(e))).toString()}function f(e){var t={},n={};return _.each(P,function(e){t[p(e)]=e}),_.each(e.user_data.annotations,function(e){n[p(e)]=e}),_.filter(A.objDiff(t,n),function(e){return!_.isEmpty(d(e))})}function h(){return j.get().shared_annotations_url}function g(e,t){(e=h())&&Y.read(e).then(function(e){_.isEmpty(t=f(e))||(T.signedIn()?$(N).trigger("merge-shared-prompt",function(){F(t)}):F(t))})}function m(e){e=e||{},S.annots.list().then(function(t){var n=A.arrayToHash(t.annotations);_.each(P,function(t,i){n[i]||e[i]||u(i)}),_.each(n,function(t,n){P[n]?(delete e[n],l(P[n],t)):c(t)}),_.each(e,function(e){S.annots.add(e).then(function(t){l(e,t.annotation)},r)})},_.noop)}function v(){var e=j.get().sync_collection_id||T.get().id;return sprintf("/%s/collections/%s/items/%s",X.get(),e,S.item.id())}function w(){g(),S.item.onAdd(function(){m(_.clone(P)),O=I.subscribe(v(),function(){m()})}),S.item.onRemove(function(){O&&O.cancel()})}function y(){return A.clone(P)}function b(){return A.hashToArray(P)}function k(e){return c(e,!0),S.annots.add(e).then(function(t){l(e,t.annotation)},r)}function x(e){var t=A.objDiff(P[e.id],e);return _.isEmpty(t)?Promise.resolve({status:"ok"}):(l(P[e.id],e,!0),S.annots.update(e.id,t).then(function(t){l(e,t.annotation)},function(t){404==t.status?u(e.id):r(t)}))}function C(e){return u(e,!0),S.annots.remove(e)["catch"](_.noop)}function E(){return Y.writableUrl().then(function(e){return new Promise(function(t){Y.write(e.url,{user_data:{modified:A.dateISO(),annotations:_.toArray(P)}}).then(function(){t(e.id)},_.noop)})})}function F(e){_.each(e,function(e){c(e),S.annots.add(e).then(function(t){l(e,t.annotation)},_.noop)})}var A=e("../utils/util"),T=e("../user"),X=e("../environment"),j=e("../article"),Y=e("../s3_storage"),S=e("../sync/sync"),I=e("../sync/faye_client"),N={},P={},O=null;w(),N.list=y,N.listArr=b,N.addItem=k,N.updateItem=x,N.removeItem=C,N.writeShared=E,t.exports=N},{"../article":45,"../environment":54,"../s3_storage":70,"../sync/faye_client":72,"../sync/sync":74,"../user":81,"../utils/util":96}],41:[function(e,t,n){var i=e("../elements/popover"),r=function(){};r.prototype={_init:function(e,t){this._elem=$("#"+e).clone(),this._elem.removeAttr("id").addClass(t),this._initEvents()},_initEvents:function(){},_open:function(e,t){this._anchor=e,i.open({placement:"up",content:this._elem,anchor:this._anchor,klass:t})},open:function(e,t){this._open(e||this._anchor,t)},close:function(){i.close(this._anchor)},isOpen:function(){return i.isOpen(this._anchor)},destroy:function(){this.close(),this._elem.remove(),this._elem=null,this._anchor=null}},t.exports=r},{"../elements/popover":52}],42:[function(e,t,n){var i=e("./base_toolbar"),r=function(e){this.selection=e,this._init("resolve-toolbar","resolve")};r.prototype=$.extend(new i,{_initEvents:function(){var e=this;this._elem.find(".row").click(function(){e.close(),$(e).trigger("marked",[{type:$(this).attr("type").toLowerCase(),text:e.selection.getRangeAndClear().text().replace(/(?:\r?\n|\r)+/g," ")}])}),$(this.selection).on("set-selection",function(){e.open(e.selection.getElems().first())}).on("clear-selection",$.proxy(this.close,this))},destroy:function(){i.prototype.destroy.apply(this),this.selection=null}}),t.exports=r},{"./base_toolbar":41}],43:[function(e,t,n){function i(e,t){function n(){var e=f.commonAncestorContainer;return e.nodeType==Node.TEXT_NODE&&(e=e.parentNode.parentNode),$(e).find("."+p)}function i(e){try{e.removeAllRanges()}catch(t){}}function s(){o.remove(u),n().removeClass(p),i(rangy.getSelection()),$(u).trigger("clear-selection")}function a(){var e=rangy.getSelection(),n=e.getAllRanges()[0];return t(n)?(d=r.guid(),f=n,h.applyToRange(f),e.setSingleRange(f),o.add(u),$(u).trigger("set-selection"),!0):(i(e),!1)}function c(){var t=rangy.getSelection();return t.isCollapsed?!1:$.contains(e[0],t.anchorNode)&&$.contains(e[0],t.focusNode)?!0:!1}function l(){$(document).on("mousedown.selection",function(){c()&&s(),e.one("mouseup.selection",function(){return c()&&a()?(e.one("click.selection",!1),!1):void 0})})}e=e||$(document.body),t=t||function(){return!0};var u={},d=null,p="current-selection",f=rangy.createRange(),h=rangy.createClassApplier(p);return l(),u.clear=function(){return s()},u.getRange=function(){return f.cloneRange()},u.getRangeAndClear=function(){var e=f.cloneRange();return s(),e},u.getElems=function(){return n()},u.getKlass=function(){return p},u.getId=function(){return d},u}var r=e("../utils/util"),o=e("../input_handler");t.exports=i},{"../input_handler":66,"../utils/util":96}],44:[function(e,t,n){var i=e("./base_toolbar"),r=function(e){this.selection=e,this._init("annotations-base-toolbar","selection")};r.prototype=$.extend(new i,{_initEvents:function(){var e=this;this._elem.find(".add-note").click(function(){$(e).trigger("add-note")}),this._elem.find(".annot-colors .sample").click(function(t){$(e).trigger("highlight",[$(this).data("colorid")])}),$(this.selection).on("set-selection",function(){e.selection.getRange().text()&&e.open(e.selection.getElems().first())}).on("clear-selection",$.proxy(this.close,this))},destroy:function(){i.prototype.destroy.apply(this),this.selection=null}}),t.exports=r},{"./base_toolbar":41}],45:[function(e,t,n){function i(){var e=new Date,t=Date.UTC(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate());return t+47*pe.hrs}function r(){return K.clone(ae)}function o(){return se}function s(){return!!re.sync_item_id}function a(){return re.sync_item_sponsored}function c(){return!s()||a()}function l(){return/(?:sharing|referrer|author)_token/.test(re.access_method)}function u(){return!!ce.feed_token}function d(){return ae.resource_id||ae.doi}function p(){return CryptoJS.MD5(sprintf("eofzHtB5%s",d().toLowerCase())).toString()}function f(){return K.merge(ae,ce,_.pick(re,"doi","hash"),{st:p()})}function h(){return K.addParams(Z.services+"/reader/basic_data",f())}function g(){return K.addParams(Z.services+"/reader/article_data",K.merge(re.options,f()))}function m(e){return K.addParams(Z.services+"/articles/metrics",K.merge({doi:re.doi,scroll:1,size:30},e))}function v(){return Z.services+"/reader/pages"}function w(){return K.addParams(Z.services+"/reader/related",f())}function y(e){return oe=K.merge(oe,re.options,e,f()),K.referrerHost()&&(oe.referrer=K.referrerHost()),oe}function b(e,t){return function(n){n.error?t(n):e(n)}}function k(e){return function(t){e(t.responseJSON||t.responseText)}}function x(){return new Promise(function(e,t){$.ajax(K.merge(de,{url:h(),dataType:"json",success:b(e,t),error:k(t)}))})}function C(){return new Promise(function(e,t){$.ajax(K.merge(de,{url:g(),dataType:"json",success:e,error:k(t)}))})}function E(e){return new Promise(function(t,n){$.ajax(K.merge(de,{url:m(e),dataType:"json",success:t,error:k(n)}))})}function F(e,t){return new Promise(function(n,i){$.ajax(K.merge(de,{url:e,type:"POST",dataType:"json",data:y(t),success:n,error:k(i)}))})}function A(){return new Promise(function(e){A.data?e(A.data):$.ajax(K.merge(de,{url:w(),dataType:"json",success:function(t){e(A.data=t)}}))})}function T(){return _.has(re,"access")}function X(e){return F(v(),e)}function j(e){return e=e.toLowerCase(),-1!=e.indexOf("video")?"video":0==e.indexOf("vnd.")?-1!=e.indexOf("word")?"doc":-1!=e.indexOf("excel")||-1!=e.indexOf("sheet")?"xls":-1!=e.indexOf("powerpoint")||-1!=e.indexOf("presentation")?"ppt":"type":e}function Y(e,t){return e.index=t,e.caption=e.caption||"Supplement "+(t+1),e.type=j(e.type),e}function S(e){return e.supplements=_(e.supplements).map(Y),e}function I(){te.remove(ue),ue=te.add(function(){$(ie).trigger("resources-expired")},i())}function N(e){return re=K.merge(re,e),Z.parent&&ce.publisher&&(re.publisher=ce.publisher),I(),$(ie).trigger("initialized",[D()]),re}function P(e){return re=K.merge(re,S(e)),Z.parent&&ce.publisher&&(re.meta=re.meta||{},re.meta.publisher=ce.publisher,"wiley"==ce.publisher&&(re.meta.url=sprintf("http://onlinelibrary.wiley.com/doi/%s/abstract",re.doi),re.meta.pdf_url=sprintf("http://onlinelibrary.wiley.com/doi/%s/pdf",re.doi))),$(ie).trigger("data",[D()]),re}function O(e){return re=K.merge(re,e),I(),$(ie).trigger("access-check",[D()]),M()&&$(ie).trigger("access",[D()]),re}function R(){return M()&&re.pdf_url}function D(){return K.clone(re)}function M(){return re.access}function U(e){return X(e).then(O)}function L(e){return F(Z.services+"/reader/generate_shared_access",e)}function z(e){re.meta?e(D()):$(ie).one("data",function(t,n){e(n)})}function B(e){M()?e(D()):$(ie).one("access",function(t,n){e(n)})}function V(e){T()&&e(D()),$(ie).on("access-check",function(t,n){e(n)})}function H(e){T()?e(D()):$(ie).one("access-check",function(t,n){e(n)})}function J(){var e=(re.meta.url||"").replace("#","%23");return ee(re.publisher)?e.replace(parseUri(e).host,ee(re.publisher)):e}function q(e){_.isEmpty(re)?$(ie).one("initialized",function(t,n){e(n)}):e(D())}function W(e){return le?le:(se="supplement",le=ne.init(e),le.then(N),le)}function Q(){return ne.update().then(N)}function G(e,t){return le?le:(ae=e||{},ce=t||{},le=x(),le.then(N).then(function(e){e.meta?P(e):C().then(P)}),le)}var K=e("./utils/util"),Z=e("./endpoint"),ee=e("./proxy_host"),te=e("./utils/alarm_clock"),ne=e("./supplement"),ie={},re={},oe={},se="article",ae=null,ce=null,le=null,ue=null,de={crossDomain:!0,xhrFields:{withCredentials:!0}},pe={sec:1e3,min:6e4,hrs:36e5};ie.init=G,ie.initSupplement=W,ie.updateSupplement=Q,ie.onInit=q,ie.get=D,ie.getIds=r,ie.getType=o,ie.hasAccess=M,ie.hasFullAccess=R,ie.checkAccessWith=U,ie.generateSharedAccess=L,ie.getMetrics=E,ie.onData=z,ie.onAccess=B,ie.onAccessCheck=V,ie.onceAccessChecked=H,ie.getRelated=A,ie.isPersonal=s,ie.isSponsored=a,ie.isBrandable=c,ie.isShared=l,ie.isFeed=u,ie.getProxiedUrl=J,window.article=ie,t.exports=ie},{"./endpoint":53,"./proxy_host":67,"./supplement":71,"./utils/alarm_clock":83,"./utils/util":96}],46:[function(e,t,n){function i(){return l.getPageObj(1)}function r(){var e=i();if(e){var t=e.getWidth()*e.getScale(),n=e.getMargin()*e.getScale(),r=t/d.data("original-width"),o=d.data("original-height")*r,s=d.data("bg-original-width"),a=d.data("bg-original-height")*r;d.css({width:t,height:o,margin:n+"px auto","background-size":s+"px "+a+"px"}),d.find("img").each(function(){var e=$(this),n=e.data("original-height")*r,i=e.data("original-width")*r,s=1;i>o&&(s=o/i),n*s>t&&(s=t/n),e.css("height",i*s)})}}function o(e){d=e,d.data("original-width",d.width()),d.data("original-height",d.height()),c.onData(function(e){(!c.isPersonal()||c.get().sync_item_sponsored)&&s(e.banner)})}function s(e){e&&(e.url&&d.click(function(){window.open(e.url,"_blank")}),a(e.background,function(t){function n(e){d.append(e)}d.css("background-image",'url("'+e.background+'")').show(),d.data("bg-original-width",$(t).data("original-width")),d.data("bg-original-height",$(t).data("original-height")),r(),a(e.left,function(e){e.className="left",n(e),r()}),a(e.center,function(e){e.className="center",n(e),r()}),a(e.right,function(e){e.className="right",n(e),r()})}),$(l).on("scale",r),l.onInit(r))}function a(e,t){var n=new Image;n.onload=function(){$(n).data("original-width",n.width),$(n).data("original-height",n.height),t(n)},n.src=e}var c=e("./article"),l=e("./viewer/viewer"),u={},d=null;u.init=o,t.exports=u},{"./article":45,"./viewer/viewer":102}],47:[function(e,t,n){function i(e,t){var n=[];-1!=e.indexOf("'",1)&&(e=e.replace(/\'$/,""),n.push(e)),-1!=e.indexOf("",1)&&(e=e.replace(/\/,""),n.push(e)),n.push(e.replace(" "," "));for(var i=1;i<e.length-2;i++)n.push(e.substring(0,i)+e.substring(i,e.length).replace(/(.{1})/,"$1-"));return n.push(".",".",""),t.match(/^\s*\d{1}\s*$/)||n.push(""),n}function r(e){for(var t=[],n=1;n<e.length-2;n++)t.push(e.substring(0,n)+e.substring(n,e.length).replace(/(.{1})/,"$1-"));return t}var o=e("../utils/util"),s=e("../utils/range_serializer"),a=function(e,t){this.klass="enhanced-"+t.type,this.id=o.guid(),this.range=e,this.data=t,this.elems=null,this.klassApp=null,this.idApp=null,this._init()};a.prototype={_init:function(){this.klassApp=rangy.createClassApplier(this.klass),this.idApp=rangy.createClassApplier(this.id),this.klassApp.applyToRange(this.range),this.idApp.applyToRange(this.range),this.elems=o.getElems(this.range,this.id),this.elems.closest("div.t").addClass("citation-container")},getElems:function(){return this.elems},getId:function(){return this.id},getKlass:function(){return this.klass},getType:function(){return this.data.type},getData:function(){return o.clone(this.data)},getRange:function(){return this.range.cloneRange()},destroy:function(){this.klassApp.undoToRange(this.range),this.idApp.undoToRange(this.range),this.klassApp=null,this.idApp=null,this.range=null,this.elems=null,this.data=null}},a.deserialize=function(e,t,n){var c=null,l={container:e,matchFilter:n,matchWeirdCitations:!0,matchTranslits:"author"==t.type,matchCase:"author"==t.type};if(!c&&t.text.match(/^\d{4}$/)&&(c=s.deserialize({prefix:t.prefix.split(/\(|\[|;/g).pop().trim(),text:t.text},o.merge(l,{matchTranslits:!1}))),c||(c=s.deserialize({prefix:t.prefix.split(/\s+|\n/).pop(),text:t.text},l)),!c&&t.text.match(/\d+\s+-\s+\d+/)&&(c=s.deserialize({prefix:t.prefix,text:t.text.replace(/\s+-\s+/g," - - ")},l)),c||(c=s.deserialize({prefix:t.prefix.replace(/(;)/g," $1 "),text:t.text.replace(/(\d+|[a-zA-Z\.]+|,|;)/g," $1 ")},l)),c||(c=s.deserialize(t,o.merge(l,{matchBrokenTxt:!0}))),c||(c=s.deserialize(t,o.merge(l,{insertWhitespace:!0}))),c||"author"!=t.type||(c=s.deserialize(t,o.merge(l,{removeDiacritics:!0}))),c||"author"!=t.type||(c=s.deserialize(t,o.merge(l,{removeDiacritics:!0,matchCase:!1}))),c||(c=s.deserialize(t,o.merge(l,{matchTranslits:!1,matchMisconverted:!0}))),c||(c=s.deserialize(t,o.merge(l,{matchTranslits:!1,matchBrokenSpaces:!0}))),c||(c=s.deserialize(t,o.merge(l,{matchTranslits:!1,matchBrokenDigits:!0}))),!c&&t.prefix.length)for(var u=i(t.prefix,t.text),d=0;d<u.length&&!(c=s.deserialize({prefix:u[d],text:t.text},l));d++);if(!c&&!t.text.match(/^\s*\d{1}\s*$/))for(var u=r(t.text),d=0;d<u.length&&!(c=s.deserialize({prefix:t.prefix,text:u[d]},l));d++);return c?new a(c,t):(e.children().length&&o.log("* missed citation: ["+t.prefix+"]["+t.text+"]"),null)},t.exports=a},{"../utils/range_serializer":90,"../utils/util":96}],48:[function(e,t,n){function i(e){if("reference"!=e.getType())return!1;var t=e.getData().text;return t=t.replace(/[\s\[\]\(\)]/g,""),t=t.replace(/[-]/g,","),/^(\d{1,3},)*\d{1,3}$/.test(t)}function r(e){return i(e)?"enhanced-rectangle-draw":"enhanced-underline-draw"}function o(e){e.addClass("animate-enhanced show-enhanced"),setTimeout(function(){e.removeClass("show-enhanced")},1e3),setTimeout(function(){e.removeClass("animate-enhanced")},1500)}function s(){var e=p.getPageObj(p.getPage());return e&&e.hasText()?(o(e.getElem()),!0):!1}function a(e){g[e.getId()]=e;var t=r(e),n=e.getElems().filter(function(){return!!this.textContent});d.hasTransparentText(n)&&(t+=" transparent"),n.addClass(t),"author"==e.getType()?n.filter(function(){return f.detectGlyph(this.textContent)}).addClass("diacritic"):n.length>1&&n.each(function(e){0==e?$(this).addClass("leftmost"):e==n.length-1?$(this).addClass("rightmost"):$(this).addClass("middle")}),n.on({"mouseenter.citation-drawer":function(){n.addClass("hover")},"mouseleave.citation-drawer":function(){n.removeClass("hover")},"open.popover.citation-drawer":function(){n.addClass("active")},"close.popover.citation-drawer":function(){n.removeClass("active")}})}function c(e){var t=r(e),n=e.getElems();n.off(["mouseenter.citation-drawer","mouseleave.citation-drawer","open.popover.citation-drawer","close.popover.citation-drawer"].join(" ")),n.removeClass(t+" transparent diacritic leftmost middle rightmost"),delete g[e.getId()]}function l(){p.onInit(function(){$(document).one("mousemove.citation-drawer",function(){$(document).on("mousemove.citation-drawer",function(){s()&&$(document).off("mousemove.citation-drawer")})}),$(window).on("keydown.citation-drawer",function(e){e.metaKey||e.ctrlKey||82==e.keyCode&&s()})})}function u(){_.each(_.keys(g),function(e){c(g[e])})}var d=e("../utils/util"),p=e("../viewer/viewer"),f=e("../utils/diacritics"),h={},g={};h.init=l,h.add=a,h.remove=c,h.removeAll=u,t.exports=h},{"../utils/diacritics":86,"../utils/util":96,"../viewer/viewer":102}],49:[function(e,t,n){function i(e){var t=e.getId();k[t]=e,w.add(e),y.add(e),$(b).trigger("add",[e])}function r(e){return[e.startNode.textContent,e.startNodeIndex.toString(),e.endNode.textContent,e.endNodeIndex.toString()].join("-")}function o(e){return[e.startContainer.textContent,e.startOffset.toString(),e.endContainer.textContent,e.endOffset.toString()].join("-")}function s(e,t){var n=t.getRange(),i=[e,o(n)].join(":");x[i]||(x[i]=[]),x[i].push(n)}function a(e){var t=rangy.createRange();return t.setStart(e.startNode,e.startNodeIndex),t.setEnd(e.endNode,e.endNodeIndex),t}function c(e,t){return t.startContainer.isEqualNode(e.startNode)&&t.endContainer.isEqualNode(e.endNode)?t.equals(a(e)):!1}function l(e){return function(t){var n=[e,r(t)].join(":");if(!x[n])return!0;for(var i=0;i<x[n].length;i++)if(c(t,x[n][i]))return!1;return!0}}function u(e){var t=[];return"nature"==T&&t.push({provider:"NPG Journals",url:"http://www.nature.com/search?"+$.param({author_match:"all",author:e.standard_name})}),t.concat([{provider:"PubMed",url:"http://www.ncbi.nlm.nih.gov/pubmed/?"+$.param({term:e.standard_name+"[Author]"})},{provider:"Google Scholar",url:"http://scholar.google.com/scholar?"+$.param({as_q:"",as_sauthors:e.text})}])}function d(e,t){var n=F[e-1][t],r=v.getPageObj(e);"author"==n.type&&(n=m.merge(n,{search:u(n)})),"figure"==n.type?n.figures=$.map(n.ids,function(e){return E[e-1]}):n.references=$.map(n.ids,function(e){return A[e-1]});var o=_.deserialize(r.getElem(),n,l(e));o&&(s(e,o),i(o))}function p(e,t){if(!C[e]&&t.hasText()&&F[e-1]){for(var n=(m.timer.tic(),0);n<F[e-1].length;n++)d(e,n);C[e]=!0}}function f(e){E=e.figures,F=e.citations,A=e.references,T=e.publisher,y.init(),v.onInit(function(){v.eachPage(p)}),$(v).on("page-loaded.citations-model",function(e,t){p(t,v.getPageObj(t))})}function h(e){for(var t in k)if(!1===e(k[t]))break}function g(){return m.clone(k)}var m=e("../utils/util"),v=e("../viewer/viewer"),w=e("../input_handler"),y=e("./citation_drawer"),_=e("./citation"),b={},k={},x={},C={},E=null,F=null,A=null,T=null;b.init=f,b.forEach=h,b.getAll=g,t.exports=b},{"../input_handler":66,"../utils/util":96,"../viewer/viewer":102,"./citation":47,"./citation_drawer":48}],50:[function(e,t,n){var i=e("./environment"),r=e("./sync/faye_client"),o={};r.subscribe(sprintf("/%s/web_reader",i.get()),function(e){if(e&&e.command){var t=e.command.split(":");$(o).trigger(t[0],[t.pop()])}}),t.exports=o},{"./environment":54,"./sync/faye_client":72}],51:[function(e,t,n){function i(){return"WebkitAppearance"in document.documentElement.style}function r(){return"safari"==u.name&&"win"==u.os}function o(){return"safari"==u.name&&u.versionNumber<6}function s(){return"chrome"==u.name&&u.versionNumber<29}function a(){return"firefox"==u.name&&u.versionNumber<17}function c(){for(var e=0;e<h.length;e++){var t=h[e];if("string"!=typeof t){for(var n=!1,c=0;c<t.length;c++)if(Modernizr[t[c]]){n=!0;break}if(!n)return l.log("browser does not support "+t.join(" or ")),{result:!1,message:"old_browser"}}else if(!Modernizr[t])return l.log("browser does not support "+t),{result:!1,message:"old_browser"}}return i()||p()?f.production()&&d()?(l.log("browser is mobile"),{result:!1,message:"mobile_browser"}):a()||s()||o()||r()?(l.log("browser is outdated"),{result:!1,message:"old_browser"}):{result:!0,message:"ok"}:(l.log("browser does not support subpixel font rendering"),{result:!1,message:"font_fail"})}var l=e("./utils/util"),u=e("./utils/browser"),d=e("./utils/mobile_detect"),p=e("./utils/subpixelfont_test"),f=e("./environment"),h=[["flexbox","flexboxlegacy"],"fontface","backgroundsize","borderradius","boxshadow","opacity","rgba","textshadow","cssgradients","csstransforms","csstransitions","hashchange","history","video","postmessage","svg"];t.exports=c},{"./environment":54,"./utils/browser":84,"./utils/mobile_detect":88,"./utils/subpixelfont_test":93,"./utils/util":96}],52:[function(e,t,n){function i(e){return{width:e[0].offsetWidth,height:e[0].offsetHeight}}function r(e){if(document.body.contains(e[0]))return i(e);e=e.clone(),y.append(e).appendTo(document.body);var t=i(e);return e.remove(),y.detach(),t}function o(e){try{return e.scrollParent()}catch(t){return $(document.body)}}function s(e){function t(){m.removeClass("up down left right"),m.css({top:"",left:""}),w.css({top:"",left:""})}function n(){t(),m.addClass("up"),T=r(v),m.css({top:j.top-S-X.height-T.height-p.top,left:Y.x-I-X.width/2});var e=u.getBoundingRect(w);return Math.max(0,A.top-(e.top-d.top))}function i(){t(),m.addClass("down"),T=r(v),m.css({top:j.bottom-S+T.height+p.bottom,left:Y.x-I-X.width/2});var e=u.getBoundingRect(w);return Math.max(0,e.bottom+d.bottom-A.bottom)}function s(){t(),m.addClass("left"),T=r(v),m.css({top:Y.y-S-X.height/2,left:j.left-I-X.width-T.width-p.left});var e=u.getBoundingRect(w);return Math.max(0,A.left-(e.left-d.left))}function l(){t(),m.addClass("right"),T=r(v),m.css({top:Y.y-S-X.height/2,left:j.right-I+T.width+p.right});var e=u.getBoundingRect(w);return Math.max(0,e.right+d.right-A.right)}function y(e){var t=[],r=[n,i],o="up"==e?0:1;(t[o]=r[o]())&&(t[1-o]=r[1-o]())&&(t[o]<=t[1-o]?r[o]():r[1-o]())}function _(e){var t=[],n=[s,l],i="left"==e?0:1;(t[i]=n[i]())&&(t[1-i]=n[1-i]())&&(t[i]<=t[1-i]?n[i]():n[1-i]())}function b(e){var t=e.left>0,n=e.right>0;return n&&t?e.left>=e.right?"right":"left":n?"left":t?"right":null}function k(e){var t=e.top>0,n=e.bottom>0;return n&&t?e.top>=e.bottom?"bottom":"top":n?"top":t?"bottom":null}function x(){var e=u.getBoundingRect(w),t={left:A.left-e.left+d.left,right:e.right-A.right+d.right},n=b(t);"left"==n&&w.css("left",Math.max(-(X.width/2)+T.width,-t.right)),"right"==n&&w.css("left",Math.min(X.width/2-T.width,t.left))}function C(){var e=u.getBoundingRect(w),t={top:A.top-e.top+d.top,bottom:e.bottom-A.bottom+d.bottom},n=k(t);"top"==n&&w.css("top",Math.max(-(X.height/2)+T.height,-t.bottom)),"bottom"==n&&w.css("top",Math.min(X.height/2-T.height,t.top))}c()&&a(),h=e.anchor,g=e.content;var E=o(h),F=E.offset(),A=u.getBoundingRect(E);t(),w.removeClass(),w.addClass("container"),e.klass&&w.addClass(e.klass),w.children().detach(),w.append(g),m.appendTo(E),m.css({visibility:"hidden",display:"block"});var T=null,X=r(g),j=u.getBoundingRect(h),Y={x:(j.left+j.right)/2,y:(j.top+j.bottom)/2},S=F.top-E.scrollTop(),I=F.left-E.scrollLeft();switch(e.placement){case"up":case"down":y(e.placement),x();break;case"left":case"right":_(e.placement),C()}$(window).one("resize.popover",function(){a()}),$(document).one("mouseup.popover",function(e){$.contains(h[0],e.target)||a()}),m.css("visibility","visible"),h.trigger("open.popover"),$(f).trigger("open-popover")}function a(e){return c(e)?($(window).off(".popover"),$(document).off(".popover"),m.css({visibility:"hidden",display:"none"}),h.trigger("close.popover"),$(f).trigger("close-popover"),g=null,h=null,!0):!1}function c(e){return h?e?e.is(h):!0:!1}function l(e){a(e.anchor)||s(e)}var u=e("../utils/util"),d={top:42,right:20,bottom:0,left:20},p={top:7,right:2,bottom:2,left:2},f={},h=null,g=null,m=$(['<div class="popover">','<div class="container"></div>','<div class="arrow"></div>',"</div>"].join(""));m.on("mousedown mouseup click",function(e){e.stopImmediatePropagation()});var v=m.find(".arrow"),w=m.find(".container"),y=$("<div></div>").css({position:"absolute",visibility:"hidden"});f.open=s,f.close=a,f.toggle=l,f.isOpen=c,t.exports=f},{"../utils/util":96}],53:[function(e,t,n){var i=e("./environment"),r=e("./utils/util"),o=parseUri(location.href).queryKey.parent_url;o&&(o=decodeURIComponent(o));var s=r.merge({parent:o,dx_doi:"//dx.doi.org",ip_api:"http://ip-api.com/json",altmetric:"//api.altmetric.com",authors_springernature:"http://authors.springernature.com",mobile_apps:{ios:"https://itunes.apple.com/us/app/readcube/id864042981?ls=1&amp;mt=8",android:"https://play.google.com/store/apps/details?id=com.readcube.mobile"},scripts:{easeljs:"//code.createjs.com/easeljs-0.8.1.min.js",tweenjs:"//code.createjs.com/tweenjs-0.6.1.min.js",movieclip:"//code.createjs.com/movieclip-0.8.1.min.js",cpgadget:"//www.google.com/cloudprint/client/cpgadget.js"},jsonp_access:{wiley:"http://onlinelibrary.wiley.com/readcube",iucr:"http://onlinelibrary.wiley.com/readcube",kluwer:"http://journals.lww.com/readcubeaccess.rpdf/access",asha:"http://pubs.asha.org/services/ResourceAccessCheck.svc/CheckAccess"}},{production:{web:"//www.readcube.com",app:"//app.readcube.com",sync:"//sync.readcube.com",analytics:"//analytics.readcube.com",services:"//services.readcube.com",push:"//push.readcube.com/bayeux",version:"//s3.amazonaws.com/reader.readcube.com/version.json"},staging:{web:"//staging.readcube.com",app:"//app-staging.readcube.com",sync:"//sync-staging.readcube.com",analytics:"//analytics-staging.readcube.com",services:"//services-staging.readcube.com",push:"//push.readcube.com/bayeux",version:"//s3.amazonaws.com/reader-staging.readcube.com/version.json"},development:{web:"//local.readcube.com:3000",app:"//local.readcube.com:4000",sync:"//local.readcube.com:3003",analytics:"//local.readcube.com:3004",services:"//local.readcube.com:3001",push:"//local.readcube.com:8000/bayeux",version:"/version.1b521ae7.json"}}[i.get()]);window.endpoint=s,t.exports=s},{"./environment":54,"./utils/util":96}],54:[function(e,t,n){function i(e){return e.toLowerCase()==u}function r(){return u}function o(){return i("development")}function s(){return i("staging")}function a(){return i("production")}function c(){/(staging|test)\.readcube\.com/i.test(location.hostname)?u="staging":/local\.readcube\.com/i.test(location.hostname)&&(u="development")}var l={},u="production";c(),l.is=i,l.get=r,l.staging=s,l.production=a,l.development=o,t.exports=l},{}],55:[function(e,t,n){function i(e){return _.map(e||[],a.authorName).join(" and ")}function r(e){return e?e.replace("-","--"):void 0}function o(e,t){var n={author:i(e.authors),year:e.year,title:e.title,journal:e.journal,publisher:a.publisherName(e.publisher),issn:e.issn,doi:e.doi,url:a.articleUrl(),volume:e.volume,month:e.month,pages:r(e.pagination),number:e.issue};return t&&(n["abstract"]=e["abstract"]),n}function s(e,t){var n=a.LINE_END,i=["@article{"+a.getKey(e)];return _.each(o(e,t),function(e,t){(e||0===e)&&i.push(sprintf("  %s = {%s}",t,e))}),i.join(","+n)+n+"}"+n}var a=e("./helper");t.exports=s},{"./helper":57}],56:[function(e,t,n){var i=e("./helper"),r=e("./bibtex"),o=e("./ris");t.exports={getKey:i.getKey,bib:r,ris:o}},{"./bibtex":55,"./helper":57,"./ris":58}],57:[function(e,t,n){function i(e){return{nature:"Nature Publishing Group",wiley:"Wiley Online Library"}[e]}function r(e){var t=e.name||e,n=t.split(" ");return 1==n.length?n[0]:n.pop()+", "+n.join(" ")}function o(){return sprintf("http:%s/%s",c.dx_doi,a.get().doi)}function s(e){try{return[e.authors[0].name.split(/[\s]+/).pop(),e.year,e.title.split(/[,\.\s]+/)[0]].join("").toLowerCase()}catch(t){return a.get().doi.replace(/[\W]+/g,"")}}var a=e("../article"),c=e("../endpoint"),l=e("../utils/browser"),u="win"==l.platform?"\r\n":"\n";t.exports={LINE_END:u,publisherName:i,authorName:r,articleUrl:o,getKey:s}},{"../article":45,"../endpoint":53,"../utils/browser":84}],58:[function(e,t,n){function i(e,t){return t||0===t?sprintf("%s  - %s",e,t):void 0}function r(e,t){return e?e.split("-")[t]:void 0}function o(e,t){var n=[i("TY","JOUR")];return n.push(i("T1",e.title)),_.each(e.authors,function(e){n.push(i("AU",s.authorName(e)))}),n.push(i("DO",e.doi)),n.push(i("JO",e.journal)),n.push(i("VL",e.volume)),n.push(i("IS",e.issue)),n.push(i("SP",r(e.pagination,0))),n.push(i("EP",r(e.pagination,1))),n.push(i("SN",e.issn)),n.push(i("UR",s.articleUrl())),n.push(i("Y1",e.year)),n.push(i("PB",s.publisherName(e.publisher))),t&&n.push(i("AB",e["abstract"])),n.push("ER  - "+s.LINE_END),_.compact(n).join(s.LINE_END)}var s=e("./helper");t.exports=o},{"./helper":57}],59:[function(e,t,n){var i=e("../environment"),r="UA-19582843-2",o="4587af51bbb542afbbc9d93bf9567159",s="190e62ffe743e9fc44da8419f01ade8f",a="H9jSrH2fJST0D33BtNfyOA",c={production:"c940ea0703828ead4745629146c021da",staging:"bf6138a7d35159129ccf0117fef1ce95",development:"bf6138a7d35159129ccf0117fef1ce95"}[i.get()];t.exports={ga:r,trackjs:o,altmetric:s,uservoice:a,mixpanel:c}},{"../environment":54}],60:[function(e,t,n){!function(e,t,n,i,r,o,s){e.GoogleAnalyticsObject=r,e[r]=e[r]||function(){(e[r].q=e[r].q||[]).push(arguments)},e[r].l=1*new Date,o=t.createElement(n),s=t.getElementsByTagName(n)[0],o.async=1,o.src=i,s.parentNode.insertBefore(o,s)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga")},{}],61:[function(e,t,n){var i=i||{};i.cmd=i.cmd||[],function(){var e=document.createElement("script");e.async=!0,e.type="text/javascript";var t="https:"==document.location.protocol;e.src=(t?"https:":"http:")+"//www.googletagservices.com/tag/js/gpt.js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(e,n)}(),t.exports=i},{}],62:[function(e,t,n){!function(e,t){if(!t.__SV){var n,i,r,o;window.mixpanel=t,t._i=[],t.init=function(e,n,i){function s(e,t){var n=t.split(".");2==n.length&&(e=e[n[0]],t=n[1]),e[t]=function(){e.push([t].concat(Array.prototype.slice.call(arguments,0)))}}var a=t;for("undefined"!=typeof i?a=t[i]=[]:i="mixpanel",a.people=a.people||[],a.toString=function(e){var t="mixpanel";return"mixpanel"!==i&&(t+="."+i),e||(t+=" (stub)"),t},a.people.toString=function(){return a.toString(1)+".people (stub)"},r="disable time_event track track_pageview track_links track_forms register register_once alias unregister identify name_tag set_config people.set people.set_once people.increment people.append people.union people.track_charge people.clear_charges people.delete_user".split(" "),o=0;o<r.length;o++)s(a,r[o]);t._i.push([e,n,i])},t.__SV=1.2,n=e.createElement("script"),n.type="text/javascript",n.async=!0,n.src="undefined"!=typeof MIXPANEL_CUSTOM_LIB_URL?MIXPANEL_CUSTOM_LIB_URL:"file:"===e.location.protocol&&"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js".match(/^\/\//)?"https://cdn.mxpnl.com/libs/mixpanel-2-latest.min.js":"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js",i=e.getElementsByTagName("script")[0],i.parentNode.insertBefore(n,i)}}(document,window.mixpanel||[])},{}],63:[function(e,t,n){e("./trackjs_prelude"),function(e,t,n){"use awesome";if(e.trackJs)e.console&&e.console.warn&&e.console.warn("TrackJS global conflict");else{var i=function(e,t,n,i,r){this.util=e,this.onError=t,this.onFault=n,this.options=r,r.enabled&&this.initialize(i)};i.prototype={initialize:function(e){e.addEventListener&&(this.wrapAndCatch(e.Element.prototype,"addEventListener",1),this.wrapAndCatch(e.XMLHttpRequest.prototype,"addEventListener",1),this.wrapRemoveEventListener(e.Element.prototype),this.wrapRemoveEventListener(e.XMLHttpRequest.prototype)),this.wrapAndCatch(e,"setTimeout",0),this.wrapAndCatch(e,"setInterval",0)},wrapAndCatch:function(e,t,n){var i=this,o=e[t];i.util.hasFunction(o,"apply")&&(e[t]=function(){try{var s,a,c=Array.prototype.slice.call(arguments),l=c[n];if(i.options.bindStack)try{throw Error()}catch(u){a=u.stack,s=i.util.isoNow()}if("addEventListener"===t&&(this._trackJsEvt||(this._trackJsEvt=new r),this._trackJsEvt.getWrapped(c[0],l,c[2])))return;return l&&i.util.hasFunction(l,"apply")&&(c[n]=function(){try{return l.apply(this,arguments)}catch(e){throw i.onError("catch",e,{bindTime:s,bindStack:a}),i.util.wrapError(e)}},"addEventListener"===t&&this._trackJsEvt.add(c[0],l,c[2],c[n])),o.apply(this,c)}catch(d){e[t]=o,i.onFault(d)}})},wrapRemoveEventListener:function(e){if(e&&e.removeEventListener&&this.util.hasFunction(e.removeEventListener,"call")){var t=e.removeEventListener;e.removeEventListener=function(e,n,i){if(this._trackJsEvt){var r=this._trackJsEvt.getWrapped(e,n,i);return r&&this._trackJsEvt.remove(e,n,i),t.call(this,e,r,i)}return t.call(this,e,n,i)}}}};var r=function(){this.events=[]};r.prototype={add:function(e,t,n,i){-1>=this.indexOf(e,t,n)&&this.events.push([e,t,!!n,i])},remove:function(e,t,n){e=this.indexOf(e,t,!!n),e>=0&&this.events.splice(e,1)},getWrapped:function(e,t,i){return e=this.indexOf(e,t,!!i),e>=0?this.events[e][3]:n},indexOf:function(e,t,n){for(var i=0;i<this.events.length;i++)if(this.events[i][0]===e&&this.events[i][1]===t&&this.events[i][2]===!!n)return i;return-1}};var o=function(e,t){this.util=e,this.initCurrent(t)};o.prototype={current:{},initOnly:{application:"",enabled:!0,token:!0,callback:{enabled:!0},console:{enabled:!0},network:{enabled:!0},visitor:{enabled:!0},window:{enabled:!0}},defaults:{application:"",enabled:!0,onError:function(){return!0},serialize:function(e){return e===n?"undefined":null===e?"null":"number"==typeof e&&isNaN(e)?"NaN":""===e?"Empty String":0===e?"0":!1===e?"false":e&&e.toString?e.toString():"unknown"},sessionId:"",token:"",userId:"",version:"",callback:{enabled:!0,bindStack:!1},console:{enabled:!0,display:!0,error:!0,watch:["log","debug","info","warn","error"]},network:{enabled:!0,error:!0},visitor:{enabled:!0},window:{enabled:!0}},initCurrent:function(e){return this.validate(e,this.defaults,"config",{})?(this.current=this.util.extend(this.current,this.defaults,e),!0):(this.current=this.util.extend(this.current,this.defaults),!1)},setCurrent:function(e){return this.validate(e,this.defaults,"config",this.initOnly)?(this.current=this.util.extend(this.current,e),!0):!1},validate:function(e,t,n,i){var r=!0;n=n||"",i=i||{};for(var o in e)if(e.hasOwnProperty(o))if(t.hasOwnProperty(o)){var s=typeof t[o];s!==typeof e[o]?(console.warn(n+"."+o+": property must be type "+s+"."),r=!1):"[object Array]"!==Object.prototype.toString.call(e[o])||this.validateArray(e[o],t[o],n+"."+o)?"[object Object]"===Object.prototype.toString.call(e[o])?r=this.validate(e[o],t[o],n+"."+o,i[o]):i.hasOwnProperty(o)&&(console.warn(n+"."+o+": property cannot be set after load."),r=!1):r=!1}else console.warn(n+"."+o+": property not supported."),r=!1;return r},validateArray:function(e,t,n){var i=!0;n=n||"";for(var r=0;r<e.length;r++)this.util.contains(t,e[r])||(console.warn(n+"["+r+"]: invalid value: "+e[r]+"."),i=!1);return i}};var s=function(e,t,n,i,r,o,s){this.util=e,this.log=t,this.onError=n,this.onFault=i,this.serialize=r,s.enabled&&(o.console=this.wrapConsoleObject(o.console,s))};s.prototype={wrapConsoleObject:function(e,t){e=e||{};var n,i=e.log||function(){},r=this;for(n=0;n<t.watch.length;n++)(function(n){var o=e[n]||i;e[n]=function(){try{var e=Array.prototype.slice.call(arguments);if(r.log.add("c",{timestamp:r.util.isoNow(),severity:n,message:r.serialize(e)}),t.error&&"error"===n)try{throw Error(r.serialize(e))}catch(i){r.onError("console",i)}t.display&&(r.util.hasFunction(o,"apply")?o.apply(this,e):o(e[0],e[1],e[2]))}catch(s){r.onFault(s)}}})(t.watch[n]);return e},report:function(){return this.log.all("c")}};var a=function(e,t,n,i,r){this.config=e,this.util=t,this.log=n,this.window=i,this.document=r,this.correlationId=this.token=null,this.initialize()};a.prototype={initialize:function(){this.token=this.getCustomerToken(),this.correlationId=this.getCorrelationId()},getCustomerToken:function(){if(this.config.current.token)return this.config.current.token;var e=this.document.getElementsByTagName("script");return e[e.length-1].getAttribute("data-token")},getCorrelationId:function(){var e;try{e=this.document.cookie.replace(/(?:(?:^|.*;\s*)TrackJS\s*\=\s*([^;]*).*$)|^.*$/,"$1"),e||(e=this.util.uuid(),this.document.cookie="TrackJS="+e+"; expires=Fri, 31 Dec 9999 23:59:59 GMT; path=/")}catch(t){e=this.util.uuid()}return e},report:function(){return{application:this.config.current.application,correlationId:this.correlationId,sessionId:this.config.current.sessionId,token:this.token,userId:this.config.current.userId,version:this.config.current.version}}};var c=function(e){this.loadedOn=(new Date).getTime(),this.window=e};c.prototype={discoverDependencies:function(){var e,t={};this.window.jQuery&&this.window.jQuery.fn&&this.window.jQuery.fn.jquery&&(t.jQuery=this.window.jQuery.fn.jquery),this.window.jQuery&&this.window.jQuery.ui&&this.window.jQuery.ui.version&&(t.jQueryUI=this.window.jQuery.ui.version),this.window.angular&&this.window.angular.version&&this.window.angular.version.full&&(t.angular=this.window.angular.version.full);for(e in this.window)if("_trackJs"!==e&&"_trackJS"!==e&&"_trackjs"!==e&&"webkitStorageInfo"!==e&&"webkitIndexedDB"!==e&&"top"!==e&&"parent"!==e&&"frameElement"!==e)try{if(this.window[e]){var n=this.window[e].version||this.window[e].Version||this.window[e].VERSION;"string"==typeof n&&(t[e]=n)}}catch(i){}return t},report:function(){return{age:(new Date).getTime()-this.loadedOn,dependencies:this.discoverDependencies(),userAgent:this.window.navigator.userAgent,viewportHeight:this.window.document.documentElement.clientHeight,viewportWidth:this.window.document.documentElement.clientWidth}}};var l=function(e){this.util=e,this.appender=[],this.maxLength=30};l.prototype={all:function(e){var t,n,i=[];for(n=0;n<this.appender.length;n++)(t=this.appender[n])&&t.category===e&&i.push(t.value);return i},clear:function(){this.appender.length=0},truncate:function(){this.appender.length>this.maxLength&&(this.appender=this.appender.slice(Math.max(this.appender.length-this.maxLength,0)))},add:function(e,t){var n=this.util.uuid();return this.appender.push({
key:n,category:e,value:t}),this.truncate(),n},get:function(e,t){var n,i;for(i=0;i<this.appender.length;i++)if(n=this.appender[i],n.category===e&&n.key===t)return n.value;return!1}};var u=function(e,t,n,i,r,o){this.util=e,this.log=t,this.onError=n,this.onFault=i,this.window=r,this.options=o,o.enabled&&this.initialize(r)};u.prototype={initialize:function(e){e.XMLHttpRequest&&this.util.hasFunction(e.XMLHttpRequest.prototype.open,"apply")&&this.watchNetworkObject(e.XMLHttpRequest),e.XDomainRequest&&this.util.hasFunction(e.XDomainRequest.prototype.open,"apply")&&this.watchNetworkObject(e.XDomainRequest)},watchNetworkObject:function(e){var t=this,n=e.prototype.open,i=e.prototype.send;return e.prototype.open=function(e,t){return 0>t.indexOf("localhost:0")&&(this._trackJs={method:e,url:t}),n.apply(this,arguments)},e.prototype.send=function(){try{if(!this._trackJs)return i.apply(this,arguments);this._trackJs.logId=t.log.add("n",{startedOn:t.util.isoNow(),method:this._trackJs.method,url:this._trackJs.url}),t.listenForNetworkComplete(this)}catch(e){t.onFault(e)}return i.apply(this,arguments)},e},listenForNetworkComplete:function(e){var t=this;t.window.ProgressEvent&&e.addEventListener&&e.addEventListener("readystatechange",function(){4===e.readyState&&t.finalizeNetworkEvent(e)},!0),e.addEventListener?e.addEventListener("load",function(){t.finalizeNetworkEvent(e),t.checkNetworkFault(e)},!0):setTimeout(function(){try{var n=e.onload;e.onload=function(){t.finalizeNetworkEvent(e),t.checkNetworkFault(e),"function"==typeof n&&t.util.hasFunction(n,"apply")&&n.apply(e,arguments)};var i=e.onerror;e.onerror=function(){t.finalizeNetworkEvent(e),t.checkNetworkFault(e),"function"==typeof oldOnError&&i.apply(e,arguments)}}catch(r){t.onFault(r)}},0)},finalizeNetworkEvent:function(e){if(e._trackJs){var t=this.log.get("n",e._trackJs.logId);t&&(t.completedOn=this.util.isoNow(),t.statusCode=1223==e.status?204:e.status,t.statusText=1223==e.status?"No Content":e.statusText)}},checkNetworkFault:function(e){if(this.options.error&&400<=e.status&&1223!=e.status){var t=e._trackJs||{};this.onError("ajax",e.status+" "+e.statusText+": "+t.method+" "+t.url)}},report:function(){return this.log.all("n")}};var d=function(t){this.util=t,this.disabled=!1,this.throttleStats={attemptCount:0,throttledCount:0,lastAttempt:(new Date).getTime()},e.JSON&&e.JSON.stringify||(this.disabled=!0)};d.prototype={errorEndpoint:function(t){var n="https://capture.trackjs.com/capture";return this.util.testCrossdomainXhr()||-1!==e.location.protocol.indexOf("https")||(n="http://capture.trackjs.com/capture"),n+"?token="+t},usageEndpoint:function(e){return this.appendObjectAsQuery(e,"https://usage.trackjs.com/usage.gif")},trackerFaultEndpoint:function(e){return this.appendObjectAsQuery(e,"https://usage.trackjs.com/fault.gif")},appendObjectAsQuery:function(e,t){t+="?";for(var n in e)e.hasOwnProperty(n)&&(t+=encodeURIComponent(n)+"="+encodeURIComponent(e[n])+"&");return t},getCORSRequest:function(t,n){var i;return this.util.testCrossdomainXhr()?(i=new e.XMLHttpRequest,i.open(t,n),i.setRequestHeader("Content-Type","text/plain")):"undefined"!=typeof e.XDomainRequest?(i=new e.XDomainRequest,i.open(t,n)):i=null,i},sendTrackerFault:function(e){this.throttle(e)||((new Image).src=this.trackerFaultEndpoint(e))},sendUsage:function(e){(new Image).src=this.usageEndpoint(e)},sendError:function(t,i){var r=this;if(!this.disabled&&!this.throttle(t))try{var o=this.getCORSRequest("POST",this.errorEndpoint(i));o.onreadystatechange=function(){4===o.readyState&&200!==o.status&&(r.disabled=!0)},o._trackJs=n,o.send(e.JSON.stringify(t))}catch(s){throw this.disabled=!0,s}},throttle:function(e){var t=(new Date).getTime();if(this.throttleStats.attemptCount++,this.throttleStats.lastAttempt+1e3>=t){if(this.throttleStats.lastAttempt=t,10<this.throttleStats.attemptCount)return this.throttleStats.throttledCount++,!0}else e.throttled=this.throttleStats.throttledCount,this.throttleStats.attemptCount=0,this.throttleStats.lastAttempt=t,this.throttleStats.throttledCount=0;return!1}};var p=function(e){this.window=e};p.prototype={bind:function(e,t){return function(){return e.apply(t,Array.prototype.slice.call(arguments))}},contains:function(e,t){var n;for(n=0;n<e.length;n++)if(e[n]===t)return!0;return!1},defer:function(e,t){setTimeout(function(){e.apply(t)})},extend:function(e){for(var t,i=Array.prototype.slice.call(arguments,1),r=0;r<i.length;r++)for(t in i[r])null===i[r][t]||i[r][t]===n?e[t]=i[r][t]:"[object Object]"===Object.prototype.toString.call(i[r][t])?(e[t]=e[t]||{},this.extend(e[t],i[r][t])):e[t]=i[r][t];return e},hasFunction:function(e,t){try{return!!e[t]}catch(n){return!1}},isBrowserIE:function(){var e=this.window.navigator.userAgent,t=e.match(/Trident\/([\d.]+)/);return t&&"7.0"===t[1]?11:(e=e.match(/MSIE ([\d.]+)/))?parseInt(e[1],10):!1},isBrowserSupported:function(){var e=this.isBrowserIE();return!e||e>=8},isoNow:function(){var e=new Date;return e.toISOString?e.toISOString():e.getUTCFullYear()+"-"+this.pad(e.getUTCMonth()+1)+"-"+this.pad(e.getUTCDate())+"T"+this.pad(e.getUTCHours())+":"+this.pad(e.getUTCMinutes())+":"+this.pad(e.getUTCSeconds())+"."+String((e.getUTCMilliseconds()/1e3).toFixed(3)).slice(2,5)+"Z"},pad:function(e){return e=String(e),1===e.length&&(e="0"+e),e},testCrossdomainXhr:function(){return"withCredentials"in new XMLHttpRequest},uuid:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)})},wrapError:function(e){if(e.innerError)return e;var t=Error("TrackJS Caught: "+(e.message||e));return t.description="TrackJS Caught: "+e.description,t.file=e.file,t.line=e.line||e.lineNumber,t.column=e.column||e.columnNumber,t.stack=e.stack,t.innerError=e,t}};var f=function(e,t,n,i,r,o){this.util=e,this.log=t,this.onError=n,this.onFault=i,this.options=o,this.document=r,o.enabled&&this.initialize(r)};f.prototype={initialize:function(e){var t=this.util.bind(this.onDocumentClicked,this),n=this.util.bind(this.onInputChanged,this);e.addEventListener?(e.addEventListener("click",t,!0),e.addEventListener("blur",n,!0)):e.attachEvent&&(e.attachEvent("onclick",t),e.attachEvent("onfocusout",n))},onDocumentClicked:function(e){try{var t=this.getElementFromEvent(e);t&&t.tagName&&(this.isDescribedElement(t,"a")||this.isDescribedElement(t,"button")||this.isDescribedElement(t,"input",["button","submit"])?this.writeVisitorEvent(t,"click"):this.isDescribedElement(t,"input",["checkbox","radio"])&&this.writeVisitorEvent(t,"input",t.value,t.checked))}catch(n){this.onFault(n)}},onInputChanged:function(e){try{var t=this.getElementFromEvent(e);t&&t.tagName&&(this.isDescribedElement(t,"textarea")?this.writeVisitorEvent(t,"input",t.value):this.isDescribedElement(t,"select")&&t.options&&t.options.length?this.onSelectInputChanged(t):this.isDescribedElement(t,"input")&&!this.isDescribedElement(t,"input",["button","submit","hidden","checkbox","radio"])&&this.writeVisitorEvent(t,"input",t.value))}catch(n){this.onFault(n)}},onSelectInputChanged:function(e){if(e.multiple)for(var t=0;t<e.options.length;t++)e.options[t].selected&&this.writeVisitorEvent(e,"input",e.options[t].value);else 0<=e.selectedIndex&&e.options[e.selectedIndex]&&this.writeVisitorEvent(e,"input",e.options[e.selectedIndex].value)},writeVisitorEvent:function(e,t,i,r){"password"===this.getElementType(e)&&(i=n),this.log.add("v",{timestamp:this.util.isoNow(),action:t,element:{tag:e.tagName.toLowerCase(),attributes:this.getElementAttributes(e),value:this.getMetaValue(i,r)}})},getElementFromEvent:function(e){return e.target||t.elementFromPoint(e.clientX,e.clientY)},isDescribedElement:function(e,t,n){if(e.tagName.toLowerCase()!==t.toLowerCase())return!1;if(!n)return!0;for(e=this.getElementType(e),t=0;t<n.length;t++)if(n[t]===e)return!0;return!1},getElementType:function(e){return(e.getAttribute("type")||"").toLowerCase()},getElementAttributes:function(e){for(var t={},n=0;n<e.attributes.length;n++)"value"!==e.attributes[n].name.toLowerCase()&&(t[e.attributes[n].name]=e.attributes[n].value);return t},getMetaValue:function(e,t){return e===n?n:{length:e.length,pattern:this.matchInputPattern(e),checked:t}},matchInputPattern:function(e){return""===e?"empty":/^[a-z0-9!#$%&'*+=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?$/.test(e)?"email":/^(0?[1-9]|[12][0-9]|3[01])[\/\-](0?[1-9]|1[012])[\/\-]\d{4}$/.test(e)||/^(\d{4}[\/\-](0?[1-9]|1[012])[\/\-]0?[1-9]|[12][0-9]|3[01])$/.test(e)?"date":/^(?:(?:\+?1\s*(?:[.-]\s*)?)?(?:\(\s*([2-9]1[02-9]|[2-9][02-8]1|[2-9][02-8][02-9])\s*\)|([2-9]1[02-9]|[2-9][02-8]1|[2-9][02-8][02-9]))\s*(?:[.-]\s*)?)?([2-9]1[02-9]|[2-9][02-9]1|[2-9][02-9]{2})\s*(?:[.-]\s*)?([0-9]{4})(?:\s*(?:#|x\.?|ext\.?|extension)\s*(\d+))?$/.test(e)?"usphone":/^\s*$/.test(e)?"whitespace":/^\d*$/.test(e)?"numeric":/^[a-zA-Z]*$/.test(e)?"alpha":/^[a-zA-Z0-9]*$/.test(e)?"alphanumeric":"characters"},report:function(){return this.log.all("v")}};var h=function(e,t,n,i,r){this.onError=e,this.onFault=t,this.serialize=n,r.enabled&&this.watchWindowErrors(i)};h.prototype={watchWindowErrors:function(e){var t=this;e.onerror=function(e,n,i,r,o){try{o=o||{},o.message=o.message||t.serialize(e),o.file=o.file||t.serialize(n),o.line=o.line||parseInt(i,10)||null,o.column=o.column||parseInt(r,10)||null,t.onError("window",o)}catch(s){t.onFault(s)}}}};var g=function(e,t,n,i,r,o,s,a,c,l,u,d,p,f,h,g){try{if(this.window=h,this.document=g,this.util=new u(this.window),this.onError=this.util.bind(this.onError,this),this.onFault=this.util.bind(this.onFault,this),this.serialize=this.util.bind(this.serialize,this),this.transmitter=new l(this.util),this.config=new i(this.util,e),this.log=new a(this.util),this.api=new t(this.config,this.util,this.onError,this.serialize),this.environment=new s(this.window),this.customer=new o(this.config,this.util,this.log,this.window,this.document),this.customer.token&&(this.apiConsoleWatcher=new r(this.util,this.log,this.onError,this.onFault,this.serialize,this.api,this.config.defaults.console),this.config.current.enabled&&(this.windowConsoleWatcher=new r(this.util,this.log,this.onError,this.onFault,this.serialize,this.window,this.config.current.console),this.util.isBrowserSupported()))){this.callbackWatcher=new n(this.util,this.onError,this.onFault,this.window,this.config.current.callback),this.visitorWatcher=new d(this.util,this.log,this.onError,this.onFault,this.document,this.config.current.visitor),this.networkWatcher=new c(this.util,this.log,this.onError,this.onFault,this.window,this.config.current.network),this.windowWatcher=new p(this.onError,this.onFault,this.serialize,this.window,this.config.current.window);var m=this;setTimeout(function(){m.transmitter.sendUsage({token:m.customer.token,correlationId:m.customer.correlationId,application:m.config.current.application,x:m.util.uuid()})},1e3)}}catch(v){this.onFault(v)}};g.prototype={reveal:function(){return this.customer.token?this.api:(this.window.console&&this.window.console.warn&&this.window.console.warn("TrackJS could not find a token"),n)},onError:function(){var t=!1;return function(n,i,r){if(this.util.isBrowserSupported()&&this.config.current.enabled)try{i=i||{},r=r||{bindStack:null,bindTime:null,force:!1};var o=i.message||this.serialize(i,r.force);if(o&&o.indexOf){if(-1!==o.indexOf("TrackJS Caught"))return;if(t&&-1!==o.indexOf("Script error"))return void(t=!1)}var s=this.util.extend({},{bindStack:r.bindStack,bindTime:r.bindTime,column:i.column||i.columnNumber,console:this.windowConsoleWatcher.report(),customer:this.customer.report(),entry:n,environment:this.environment.report(),file:i.file||i.fileName,line:i.line||i.lineNumber,message:o,network:this.networkWatcher.report(),url:(e.location||"").toString(),stack:i.stack,timestamp:this.util.isoNow(),visitor:this.visitorWatcher.report(),version:"2.1.14"});if(!r.force)try{if(!this.config.current.onError(s,i))return}catch(a){s.console.push({timestamp:this.util.isoNow(),severity:"error",message:a.message});var c=this;setTimeout(function(){c.onError("catch",a,{force:!0})},0)}this.log.clear(),setTimeout(function(){t=!1}),t=!0,this.transmitter.sendError(s,this.customer.token)}catch(l){console.log(l),this.onFault(l)}}}(),onFault:function(e){var t=this.transmitter||new d;e=e||{},e={token:this.customer.token,file:e.file||e.fileName,msg:e.message||"unknown",stack:(e.stack||"unknown").substr(0,500),url:this.window.location,v:"2.1.14",x:this.util.uuid()},t.sendTrackerFault(e)},serialize:function(e,t){if(this.config.current.serialize&&!t)try{return this.config.current.serialize(e)}catch(n){this.onError("catch",n,{force:!0})}return this.config.defaults.serialize(e)}},i=new g(e._trackJs||e._trackJS||e._trackjs||{},function(e,t,n,i){return{attempt:function(e,i){try{var r=Array.prototype.slice.call(arguments,2);return e.apply(i||this,r)}catch(o){throw n("catch",o),t.wrapError(o)}},configure:function(t){return e.setCurrent(t)},track:function(e){if(e=e||{},!e.stack)try{throw Error(i(e))}catch(t){e=t}n("direct",e)},watch:function(e,i){return function(){try{var r=Array.prototype.slice.call(arguments,0);return e.apply(i||this,r)}catch(o){throw n("catch",o),t.wrapError(o)}}},watchAll:function(e){var i,r=Array.prototype.slice.call(arguments,1);for(i in e)"function"==typeof e[i]&&(t.contains(r,i)||function(){var r=e[i];e[i]=function(){try{var e=Array.prototype.slice.call(arguments,0);return r.apply(this,e)}catch(i){throw n("catch",i),t.wrapError(i)}}}());return e},version:"2.1.14"}},i,o,s,a,c,l,u,d,p,f,h,r,e,t),e.trackJs=i.reveal()}}(window,document)},{"./trackjs_prelude":64}],64:[function(e,t,n){function i(e){try{return"string"==typeof e?e:JSON.stringify(e)}catch(t){}}function r(e){for(var t=[],n=0;n<e.length;n++)t.push(i(e[n]));return t.join(" ")}function o(){return{production:"readcube-reader",staging:"readcube-reader-staging"}[s.get()]||""}var s=e("../environment"),a=e("./api_keys");window._trackJs={enabled:!!o(),application:o(),token:a.trackjs,serialize:function(e){return Array.isArray(e)?r(e):i(e)}}},{"../environment":54,"./api_keys":59}],65:[function(e,t,n){var i=e("./api_keys");!function(){var e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src="//widget.uservoice.com/"+i.uservoice+".js";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}(),window.UserVoice=window.UserVoice||[],UserVoice.push(["set",{mode:"contact",menu:!1,topic_id:4937,forum_id:263598,permalinks_enabled:!1,contact_title:"How can we help you?",ticket_custom_fields:{Product:"HTML5 Web Reader"}}])},{"./api_keys":59}],66:[function(e,t,n){function i(e){var t=e.attr("class");return t?(t=$.grep(t.split(" "),function(e){return!!m[e]}).sort(function(e,t){return m[e]-m[t]}),t[0]):null}function r(e,t){t.getElems().on(e+"."+t.getId(),function(t){var n=$(t.target),r=i(n);if(r){var o=n.data(r+v).split(" ").pop();return $(g[o]).trigger(jQuery.Event(e,{originalEvent:t})),!1}})}function o(e,t){t.getElems().off(e+"."+t.getId())}function s(e){for(var t=0;t<h.length;t++)r(h[t],e)}function a(e){for(var t=0;t<h.length;t++)o(h[t],e)}function c(e){var t=e.getId(),n=e.getKlass()+v;e.getElems().each(function(){var e=$(this),i=e.data(n),r=i?[i,t].join(" "):t;e.data(n,r)})}function l(e){var t=e.getId(),n=e.getKlass()+v;e.getElems().each(function(){var e=$(this),i=e.data(n);if(i){var r=$.grep(i.split(" "),function(e){return e!=t});e.data(n,r.join(" "))}})}function u(e){g[e.getId()]=e,c(e),s(e)}function d(e){a(e),l(e),delete g[e.getId()]}function p(){_.each(_.keys(g),function(e){d(g[e])})}var f={},h=["mouseenter","mouseleave","click"],g={},m={annotation:1,"current-selection":2,"enhanced-reference":3,"enhanced-author":4,"enhanced-figure":5},v="-input-id";f.add=u,f.remove=d,f.removeAll=p,t.exports=f},{}],67:[function(e,t,n){function i(e){return _.findKey(u,function(t){return t.test(e)})}function r(e,t){var n=JSON.parse(c.session.get(l)||"{}");n[e]=t,c.session.set(l,JSON.stringify(n))}function o(e){var t=JSON.parse(c.session.get(l));return t&&t[e]}function s(e){return e==i(a.referrerHost())&&r(e,a.referrerHost()),o(e)}var a=e("./utils/util"),c=e("./utils/storage"),l="readcube-proxy-referrer",u={nature:/nature\.com/,palgrave:/palgraveconnect\.com/,wiley:/onlinelibrary\.wiley\.com/,karger:/karger\.(com|de)/};t.exports=s},{"./utils/storage":92,"./utils/util":96}],68:[function(e,t,n){function i(e){return/readcube\.com(:\d+)?$/.test(e||"")?!0:!1}function r(){$(window).on("message",function(e){for(;e.originalEvent;)e=e.originalEvent;e.data&&e.data.type&&(i(e.origin)&&$(o.readcube).trigger(e.data.type,[e.data]),$(o.all).trigger(e.data.type,[e.data]))}),window.popupMessage=function(e){$(o.all).trigger(e.type,[e])}}var o=(e("./utils/util"),{all:{},readcube:{}});r(),t.exports=o},{"./utils/util":96}],69:[function(e,t,n){function i(){/10\.1002\/(?:cctc|cbic|cmdc|cssc|cphc|cplu|celc|chem|adsc|asia|ange|anie|open|ajoc)\./gi.test(c.get().doi)&&l.onInit(function(){l.eachPage(function(e,t){t.onLoaded(function(){t.hasText()&&t.getElem().find('*:contains("ACHTUNGTRENNUNG")').contents().each(function(e,t){"ACHTUNGTRENNUNG"==t.textContent&&$(s.wrapTextNode(t)).hide()})})})})}function r(){"10.1002/adfm.201502338"==c.get().doi&&"chrome"==a.name&&l.onInit(function(){l.eachPage(function(e,t){10==e&&t.onLoaded(function(){t.getElem().find(".x84.y2ec").css("left",1282)})})})}function o(){c.onInit(function(){i(),r()})}var s=e("./utils/util"),a=e("./utils/browser"),c=e("./article"),l=e("./viewer/viewer");t.exports={init:o}},{"./article":45,"./utils/browser":84,"./utils/util":96,"./viewer/viewer":102}],70:[function(e,t,n){function i(e){return new Promise(function(t,n){$.ajax({url:e,dataType:"json",success:t,error:n})})}function r(e,t){return new Promise(function(n,i){$.ajax({url:e,type:"PUT",contentType:"application/json; charset=UTF-8",data:JSON.stringify(t),success:n,error:i})})}function o(){return new Promise(function(e,t){$.ajax({url:s.services+"/reader/annotations_bucket",success:e,error:t})})}var s=e("./endpoint"),a={};a.read=i,a.write=r,a.writableUrl=o,t.exports=a},{"./endpoint":53}],71:[function(e,t,n){function i(e){return c.addParams(l.services+"/reader/supplement",e)}function r(e){return new Promise(function(t,n){$.ajax(c.merge(f,{url:i(e),dataType:"json",success:t,error:function(e){n(e.responseJSON||e.responseText)}}))})}function o(){return c.clone(d)}function s(e){return p=e||{},r(p).then(function(e){return d=e})}function a(){return r(p).then(function(e){return d=e})}var c=e("./utils/util"),l=e("./endpoint"),u={},d={},p=null,f={crossDomain:!0,xhrFields:{withCredentials:!0}};u.init=s,u.update=a,u.get=o,window.supplement=u,t.exports=u},{"./endpoint":53,"./utils/util":96}],72:[function(e,t,n){function i(e){return e.data?e.data.sync_client_id:null}var r=e("faye"),o=(e("../utils/util"),e("../endpoint")),s=e("./primitives"),a=e("../tracking/track_error");o.push||a({error:"endpoint.push is undefined"});var c=new r.Client(o.push);c.addExtension({incoming:function(e,t){i(e)!=s.clientId&&t(e)},outgoing:function(e,t){t(e)}}),t.exports=c},{"../endpoint":53,"../tracking/track_error":77,"../utils/util":96,"./primitives":73,faye:3}],73:[function(e,t,n){function i(){return[k.sync,"items","add"].join("/")}function r(e){e=e||x.get().sync_item_id,e=e||encodeURIComponent(x.get().doi);var t=[k.sync];return x.get().sync_collection_id&&(t=t.concat(["collections",x.get().sync_collection_id])),t.concat(["items",e]).join("/")}function o(e){return[r(e),"view"].join("/")}function s(e,t){var n=[r(e),"annotations"].join("/");return t&&(n=[n,t].join("/")),n}function a(){return{"ext_ids[doi]":x.get().doi,access_token:x.get().access_token}}function c(e){return _.filter(e,function(e){return e.sha256==x.get().hash})}function l(e,t){return function(n){"ok"==n.status?e(n):t(n)}}function u(e,t){return function(n){404==n.status?e({status:"ok"}):t(n)}}function d(e){var t=r(e);return d[t]?d[t]:d[t]=new Promise(function(e,n){$.ajax(b.merge(A,{type:"GET",url:t,success:l(e,n),error:n,complete:function(){delete d[t]}}))})}function p(){return new Promise(function(e,t){$.ajax(b.merge(A,{type:"POST",url:i(),dataType:"json",data:a(),success:l(e,t),error:t}))})}function f(e,t){return new Promise(function(n,i){$.ajax(b.merge(A,{type:"PATCH",url:r(e),contentType:"application/json; charset=UTF-8",dataType:"json",data:JSON.stringify({item:t}),success:l(n,i),error:i}))})}function h(e){return new Promise(function(t,n){$.ajax(b.merge(A,{type:"DELETE",url:r(e),success:l(t,n),error:u(t,n)}))})}function g(e){return new Promise(function(e,t){$.ajax(b.merge(A,{type:"POST",url:o(),success:l(e,t),error:t}))})}function m(e){return new Promise(function(t,n){$.ajax(b.merge(A,{type:"GET",url:s(e),success:l(function(e){e.annotations=c(e.annotations),t(e)},n),error:n}))})}function v(e,t){return new Promise(function(n,i){$.ajax(b.merge(A,{type:"POST",url:s(e),contentType:"application/json; charset=UTF-8",dataType:"json",data:JSON.stringify({annotation:t}),success:l(n,i),error:i}))})}function w(e,t,n){return new Promise(function(i,r){$.ajax(b.merge(A,{type:"PATCH",url:s(e,t),contentType:"application/json; charset=UTF-8",dataType:"json",data:JSON.stringify({annotation:n}),success:l(i,r),error:r}))})}function y(e,t){return new Promise(function(n,i){$.ajax(b.merge(A,{type:"DELETE",url:s(e,t),success:l(n,i),error:u(n,i)}))})}var b=e("../utils/util"),k=e("../endpoint"),x=e("../article"),C={},E={},F=b.guid(),A={crossDomain:!0,xhrFields:{withCredentials:!0},headers:{"X-Readcube-Sync-Client":"Web Reader","X-Readcube-Sync-Client-Id":F}};C.get=d,C.add=p,C.update=f,C.remove=h,C.view=g,E.list=m,E.add=v,E.update=w,E.remove=y,t.exports={item:C,annots:E,clientId:F}},{"../article":45,"../endpoint":53,"../utils/util":96}],74:[function(e,t,n){function i(){return j}function r(){j=!0,$(Y.item).trigger("busy")}function o(){j=!1,$(Y.item).trigger("done")}function s(e){X=e.item,$(Y.item).trigger("added"),T(function(e){return F.item.view()["catch"](e)},{minTimeout:2e3})}function a(e){X=e.item,$(Y.item).trigger("changed")}function c(){X={},$(Y.item).trigger("removed")}function l(){return _.isEmpty(X)?null:X.id}function u(){return x.signedIn()?_.isEmpty(X)?F.item.get(l()):Promise.resolve({item:X}):Promise.reject({status:"signed_out"})}function d(){return i()?Promise.reject({status:"busy"}):(r(),F.item.add().then(function(e){s(e),o()},o))}function p(){return _.isEmpty(X)?Promise.resolve({status:"ok"}):i()?Promise.reject({status:"busy"}):(r(),F.item.remove(l()).then(function(){c(),o()},o))}function f(e){_.isEmpty(X)||e(X),$(Y.item).on("added",function(){e(X)})}function h(e){_.isEqual(X,{})&&e(),$(Y.item).on("removed",e)}function g(){return _.isEmpty(X)?Promise.reject({status:"item_not_synced"}):F.annots.list(l())}function m(e){return _.isEmpty(X)?Promise.reject({status:"item_not_synced"}):F.annots.add(l(),e)}function v(e,t){return _.isEmpty(X)?Promise.reject({status:"item_not_synced"}):F.annots.update(l(),e,t)}function w(e){return _.isEmpty(X)?Promise.reject({status:"item_not_synced"}):F.annots.remove(l(),e)}function y(e){x.signedIn()&&F.item.get(l()).then(function(e){_.isEmpty(X)?s(e):_.isEqual(X,e.item)||a(e)},function(e){404==e.status&&c()})}function b(){var e=C.get().sync_collection_id||x.get().id;return sprintf("/%s/collections/%s/items/*",E.get(),e)}function k(){C.onInit(function(e){e.discover||e.sync_item_sponsored||x.onSignIn(function(){A.subscribe(b(),y),F.item.get(l()).then(s)["catch"](_.noop)})})}var x=e("../user"),C=e("../article"),E=e("../environment"),F=e("./primitives"),A=e("./faye_client"),T=e("promise-retry"),X=null,j=!1,Y={item:{},annots:{}};k(),Y.item.id=l,Y.item.get=u,Y.item.add=d,Y.item.remove=p,Y.item.onAdd=f,Y.item.onRemove=h,Y.annots.list=g,Y.annots.add=m,Y.annots.update=v,Y.annots.remove=w,window.sync=Y,t.exports=Y},{"../article":45,"../environment":54,"../user":81,"./faye_client":72,"./primitives":73,"promise-retry":5}],75:[function(e,t,n){function i(e){s(),a(),d(e)}function r(){if(clearTimeout(T),T=setTimeout(o,X),j){var e=g.timer.toc(j)/1e3;u({duration:Math.round(e)})}j=g.timer.tic()}function o(){if(j){var e=g.timer.toc(j)/1e3;u({duration:Math.round(e)})}j=null}function s(){b={},sessionUpdateBatch={},C={},x=!1,clearInterval(E),E=setInterval(c,F),setTimeout(function(){clearInterval(E),E=setInterval(c,A)},6e4)}function a(){clearTimeout(T),j&&(g.timer.toc(j),j=null)}function c(){if(_){var e={};e=g.merge(e,k),x&&(e=g.merge(e,{counters:C})),$.isEmptyObject(e)||p(e),b=g.merge(b,k),k={},x=!1}}function l(e){g.log("received metrics event:",e),k=g.merge(k,g.objDiff(b,e))}function u(e){for(var t in e)C[t]=(C[t]||0)+e[t];x=!0}function d(e){var t=parseUri(location.href).queryKey,n={session_id:y,doi:e.doi,publisher:e.meta.publisher,environment:article.isPersonal()?"web_library":"html5",shared:{view:!!t.shared_access_token,token:t.shared_access_token,annotations:!!e.shared_annotations_url},referred:{view:!!t.referrer_access_token,token:t.referrer_access_token},author_share:{view:!!t.author_access_token,token:t.author_access_token},feed:{view:!!t.feed_token,token:t.feed_token},referrer_url:t.tracking_referrer,article:{issn:e.meta.issn,eissn:e.meta.eissn,year:e.meta.year,references:e.references.length>0,inline_references:h(e),video_supplement:f(e),supplements:e.supplements.length>0,figures:e.figures.length>0},access:{proxy:v(article.get().publisher)}};e.sync_collection_id&&(n.collection_id=e.sync_collection_id,e.sync_item_sponsored?n.collection_type="sponsored":e.sync_item_shared?n.collection_type="shared":n.collection_type="personal"),$.ajax({url:m.analytics+"/metrics/create_session_ex.json",type:"POST",contentType:"application/json; charset=UTF-8",dataType:"json",crossDomain:!0,xhrFields:{withCredentials:!0},data:JSON.stringify({data:n}),success:function(e){g.log("created metrics session:",n),_=e.result}})}function p(e){g.log("updated metrics:",e),$.ajax({url:m.analytics+"/metrics/update_session_ex.json",type:"POST",contentType:"application/json; charset=UTF-8",dataType:"json",crossDomain:!0,xhrFields:{withCredentials:!0},data:JSON.stringify({data:g.merge(e,{session_id:y,article_session_id:_})})})}function f(e){if(!e.supplements)return!1;var t=e.supplements.filter(function(e){return"video"==e.type}).length;return t>0}function h(e){if(!e.citations)return!1;var t=e.citations.reduce(function(e,t){return e+t.length},0);return t>0}var g=e("../utils/util"),m=e("../endpoint"),v=e("../proxy_host"),w=e("./track_id"),y=w.get(),_=null,b={},k={},x=!1,C={},E=null,F=1e4,A=3e4,T=null,X=6e4,j=null;t.exports={start:i,active:r,idle:o,sendEvent:l,addCounter:u}},{"../endpoint":53,"../proxy_host":67,"../utils/util":96,"./track_id":78}],76:[function(e,t,n){function i(){a=!0,$(s).trigger("new")}var r=e("../endpoint"),o=e("../receiver"),s={},a=!1;article.onInit(function(){r.parent?$(o.all).on("new_session",i):i()}),s.onceStarted=function(e){a?e():$(s).one("new",e)},s.onStart=function(e){a&&e(),$(s).on("new",e)},t.exports=s},{"../endpoint":53,"../receiver":68}],77:[function(e,t,n){var i=e("../utils/util");t.exports=function(e,t){t&&("string"==typeof e&&(e={error:e}),t=i.pickDefined(t,["doi","resource_id","country"]),e=$.extend({params:t},e)),trackJs&&trackJs.track(e)}},{"../utils/util":96}],78:[function(e,t,n){function i(){l=a.getItem(u),l||(l=s.guid(),a.setItem(u,l))}function r(){a.removeItem(u)}function o(){return l}var s=e("../utils/util"),a=e("../utils/cookies"),c={},l=null,u="readcube-track-id";i(),c.get=o,c.clear=r,t.exports=c},{"../utils/cookies":85,"../utils/util":96}],79:[function(e,t,n){function i(){D.get().doi&&"article"==D.getType()&&(ga("set","dimension3",D.get().doi),U.onStart(r),$(R).on("auth",function(e,t){c(t.user,t.auth)}),D.onAccessCheck(function(e){var t=D.hasAccess()?e.access_method:"denied";ga("send","event","article","access_method",t),L.sendEvent({access:{method:t},access_denied:!D.hasAccess()})}),D.onAccess(function(e){e.feed_id&&L.sendEvent({feed:{id:e.feed_id}})}),$(document).on("mousemove click scroll",_.throttle(o,3e3,{leading:!0})),$(window).on({focus:o,blur:s}))}function r(){var e=window.READER_VERSION;ga("send","event","webreader","version",e.version),ga("send","event","webreader","build",e.build),D.onData(function(){L.start(D.get()),ga("send","event","article","read","web"),ga("send","event","article","origin",O())})}function o(){L.active()}function s(){L.idle()}function a(){ga("send","event","article","altmetric"),L.sendEvent({altmetric:!0})}function c(e,t){var n={};n[t]=!0,L.sendEvent(n)}function l(){L.sendEvent({cite:!0})}function u(){L.sendEvent({discover:!0})}function d(){ga("send","event","article","checkout_opened")}function p(e){ga("send","event","article","save_pdf","web",e?1:0),e&&L.sendEvent({download:!0})}function f(){L.addCounter({highlight:1})}function h(e){var t={};t[e]=!0,L.sendEvent({inline:t})}function g(e){ga("send","event","article","linkout",e)}function m(e,t){B.push({doi:e,source:t}),L.sendEvent({referrals:B.slice()})}function v(){L.addCounter({note:1})}function w(e){var t={};t[e]=!0,L.sendEvent({print:t}),ga("send","event","article","print","web")}function y(e){L.sendEvent({purchased:!0,purchase_id:e.purchase.id})}function b(){L.sendEvent({related:!0})}function k(){L.sendEvent({save_cloud:!0})}function x(e){ga("send","event","article","scroll","page",e)}function C(e){var t={};t[e]=!0,L.sendEvent({sidepanel:t}),ga("send","event","article","sidepanel",e)}function E(e){ga("send","event","article","pdf_toolbar",e)}function F(e){ga("send","event","article","menu_bar",e)}function A(e){var t={};t[e]=!0,L.sendEvent({share:t})}function T(e){L.sendEvent({share:{token:e}})}function X(){L.sendEvent({supplement:!0}),ga("send","event","article","supplement","view")}function j(e){e?L.sendEvent({tooltips:{viewed:!0}}):L.sendEvent({tooltips:{skipped:!0}})}function Y(){ga("send","event","article","video","view"),L.sendEvent({video_supplement:!0})}function S(){ga("send","event","article","export_options","view")}function I(e){ga("send","event","article","export_citation","format",e)}function N(){ga("send","event","article","export_notes")}function P(){var e=D.get().access_method;return"sharing_token"==e?"web_reader_share":"referrer_token"==e?"web_reader_referral":"web_reader"}function O(){return M.parent?M.parent.match(/[\.\/]epdf/i)?"epdf_endpoint":"overlay":"readcube.com"}var R=e("../user"),D=e("../article"),M=e("../endpoint"),U=e("./session"),L=e("./readcube_analytics"),z={},B=[];window.ga||(window.ga=_.noop),D.onInit(i),z.menuBar=F,z.pdfToolbar=E,z.trackingOrigin=P,z.altmetric=a,z.auth=c,z.cite=l,z.discover=u,z.checkout=d,z.download=p,z.highlight=f,z.inline=h,z.linkout=g,z.referral=m,z.note=v,z.print=w,z.purchase=y,z.related=b,z.saveCloud=k,z.scroll=x,z.share=A,z.shareToken=T,z.supplement=X,z.sidepanel=C,z.tooltips=j,z.video=Y,z.exportOptions=S,z.exportCitation=I,z.exportNotes=N,t.exports=z},{"../article":45,"../endpoint":53,"../user":81,"./readcube_analytics":75,"./session":76}],80:[function(e,t,n){function i(){return new Promise(function(e,t){$.ajax({url:s.version,cache:a.development()}).done(function(t){var n=new Date(t.build),i=new Date(window.READER_VERSION.build);n>i&&e()})})}function r(){o.redirectOrPost(s.parent||location.href)}var o=e("./utils/util"),s=e("./endpoint"),a=e("./environment"),c={};c.available=i,c.reload=r,t.exports=c},{"./endpoint":53,"./environment":54,"./utils/util":96}],81:[function(e,t,n){function i(){return i.promise?i.promise:i.promise=new Promise(function(e,t){$.ajax(d.services+"/auth/user_details",{xhrFields:{withCredentials:!0},crossDomain:!0,dataType:"json",success:e,error:t})}).then(function(e){return o(e)})}function r(){return u.clone(h)}function o(e,t){var n=h;return h=e,"register"!=t&&(t="login"),!s(n)&&s(e)&&$(f).trigger("auth",[u.merge(r(),{auth:t})]),$(f).trigger("change",[r()]),r()}function s(e){return e&&e.id}function a(){return s(h)}function c(e){a()&&e(),$(f).on("auth",e)}function l(){$(p.readcube).on(["auth:success","checkout:auth"].join(" "),function(e,t){o(t.user,t.auth)}),i()["catch"](_.noop)}var u=e("./utils/util"),d=e("./endpoint"),p=e("./receiver"),f={},h={};
l(),f.get=r,f.set=o,f.fetch=i,f.signedIn=a,f.onSignIn=c,t.exports=f},{"./endpoint":53,"./receiver":68,"./utils/util":96}],82:[function(e,t,n){function i(e){return _.compact([s,e]).join("-")}var r=e("./utils/storage"),o={},s=null;o.setPrefix=function(e){s||(s=e)},o.get=function(e,t){var n=r.local.get(i(e));return n?JSON.parse(n):t||null},o.set=function(e,t){r.local.set(i(e),JSON.stringify(t))},o.remove=function(e){r.local.remove(i(e))},o.clear=function(){r.local.clear()},t.exports=o},{"./utils/storage":92}],83:[function(e,t,n){function i(){setInterval(function(){a.forEach(function(e){Date.now()>=e.time_utc&&(e.time_utc=1/0,e.handler())})},1e3)}function r(e,t){return"function"!=typeof e||parseInt(t)<=Date.now()?void 0:a.push({handler:e,time_utc:t})}function o(e){isNaN(e=parseInt(e))||1>e||e>a.length||(a[e-1].time_utc=1/0)}var s={},a=[];i(),s.add=r,s.remove=o,t.exports=s},{}],84:[function(e,t,n){var i=[];jQBrowser.platform&&i.push(jQBrowser.platform+"-os"),jQBrowser.name&&(i.push(jQBrowser.name),parseInt(jQBrowser.versionNumber)&&i.push(jQBrowser.name+"-"+jQBrowser.versionNumber)),i.length&&$("html").addClass(i.join(" ")),t.exports=jQBrowser},{}],85:[function(e,t,n){var i={getItem:function(e){try{return e?decodeURIComponent(document.cookie.replace(new RegExp("(?:(?:^|.*;)\\s*"+encodeURIComponent(e).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=\\s*([^;]*).*$)|^.*$"),"$1"))||null:null}catch(t){return null}},setItem:function(e,t,n,i,r,o){try{if(!e||/^(?:expires|max\-age|path|domain|secure)$/i.test(e))return!1;var s="";if(n)switch(n.constructor){case Number:s=n===1/0?"; expires=Fri, 31 Dec 9999 23:59:59 GMT":"; max-age="+n;break;case String:s="; expires="+n;break;case Date:s="; expires="+n.toUTCString()}return document.cookie=encodeURIComponent(e)+"="+encodeURIComponent(t)+s+(r?"; domain="+r:"")+(i?"; path="+i:"")+(o?"; secure":""),!0}catch(a){return!1}},removeItem:function(e,t,n){try{return this.hasItem(e)?(document.cookie=encodeURIComponent(e)+"=; expires=Thu, 01 Jan 1970 00:00:00 GMT"+(n?"; domain="+n:"")+(t?"; path="+t:""),!0):!1}catch(i){return!1}},hasItem:function(e){try{return e?new RegExp("(?:^|;\\s*)"+encodeURIComponent(e).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=").test(document.cookie):!1}catch(t){return!1}},keys:function(){try{for(var e=document.cookie.replace(/((?:^|\s*;)[^\=]+)(?=;|$)|^\s*|\s*(?:\=[^;]*)?(?:\1|$)/g,"").split(/\s*(?:\=[^;]*)?;\s*/),t=e.length,n=0;t>n;n++)e[n]=decodeURIComponent(e[n]);return e}catch(i){return[]}}};t.exports=i},{}],86:[function(e,t,n){function i(e){return/[`'\"~]{1}/.test(e)}function r(e){return e.replace(/[^\u0000-\u007E]/g,function(e){return s[e]||e})}for(var o=[{base:"A",letters:"A"},{base:"AA",letters:""},{base:"AE",letters:""},{base:"AO",letters:""},{base:"AU",letters:""},{base:"AV",letters:""},{base:"AY",letters:""},{base:"B",letters:"B"},{base:"C",letters:"C"},{base:"D",letters:"D"},{base:"DZ",letters:""},{base:"Dz",letters:""},{base:"E",letters:"E"},{base:"F",letters:"F"},{base:"G",letters:"G"},{base:"H",letters:"H"},{base:"I",letters:"I"},{base:"J",letters:"J"},{base:"K",letters:"K"},{base:"L",letters:"L"},{base:"LJ",letters:""},{base:"Lj",letters:""},{base:"M",letters:"M"},{base:"N",letters:"N"},{base:"NJ",letters:""},{base:"Nj",letters:""},{base:"O",letters:"O"},{base:"OI",letters:""},{base:"OO",letters:""},{base:"OU",letters:""},{base:"OE",letters:""},{base:"oe",letters:""},{base:"P",letters:"P"},{base:"Q",letters:"Q"},{base:"R",letters:"R"},{base:"S",letters:"S"},{base:"T",letters:"T"},{base:"TZ",letters:""},{base:"U",letters:"U"},{base:"V",letters:"V"},{base:"VY",letters:""},{base:"W",letters:"W"},{base:"X",letters:"X"},{base:"Y",letters:"Y"},{base:"Z",letters:"Z"},{base:"a",letters:"a"},{base:"aa",letters:""},{base:"ae",letters:""},{base:"ao",letters:""},{base:"au",letters:""},{base:"av",letters:""},{base:"ay",letters:""},{base:"b",letters:"b"},{base:"c",letters:"c"},{base:"d",letters:"d"},{base:"dz",letters:""},{base:"e",letters:"e"},{base:"f",letters:"f"},{base:"g",letters:"g"},{base:"h",letters:"h"},{base:"hv",letters:""},{base:"i",letters:"i"},{base:"j",letters:"j"},{base:"k",letters:"k"},{base:"l",letters:"l"},{base:"lj",letters:""},{base:"m",letters:"m"},{base:"n",letters:"n"},{base:"nj",letters:""},{base:"o",letters:"o"},{base:"oi",letters:""},{base:"ou",letters:""},{base:"oo",letters:""},{base:"p",letters:"p"},{base:"q",letters:"q"},{base:"r",letters:"r"},{base:"s",letters:"s"},{base:"t",letters:"t"},{base:"tz",letters:""},{base:"u",letters:"u"},{base:"v",letters:"v"},{base:"vy",letters:""},{base:"w",letters:"w"},{base:"x",letters:"x"},{base:"y",letters:"y"},{base:"z",letters:"z"}],s={},a=0;a<o.length;a++)for(var c=o[a].letters.split(""),l=0;l<c.length;l++)s[c[l]]=o[a].base;t.exports={detectGlyph:i,remove:r}},{}],87:[function(e,t,n){function i(e,t,n,i){var a,c=[],l=[],u=o(t);if(!u)return l;if(e.global)for(;a=e.exec(u);)c.push(r(a,i));else a=u.match(e),a&&c.push(r(a,i));return c.length&&(l=s(t,c,n)),l}function r(e,t){if(t=t||0,!e[0])throw"findTxt cannot handle zero-length matches";var n=e.index;if(t>0){var i=e[t];if(!i)throw"Invalid capture group";n+=e[0].indexOf(i),e[0]=i}return[n,n+e[0].length,[e[0]]]}function o(e){if(3===e.nodeType)return e.data;var t="";if(e=e.firstChild)do t+=o(e);while(e=e.nextSibling);return t}function s(e,t,n){var i,r,o,s,a=e,c=0,l=[],u=[],d=t.shift();e:for(;;){if(3===a.nodeType&&(!r&&a.length+c>=d[1]?(r=a,s=d[1]-c):i&&u.push(a),!i&&a.length+c>d[0]&&(i=a,o=d[0]-c),c+=a.length),i&&r){var p={startNode:i,startNodeIndex:o,endNode:r,endNodeIndex:s,matchIndex:l.length+1};if(l.push(p),n&&!1===n(p))break;if(a=r,c-=r.length-s,i=null,r=null,u=[],d=t.shift(),!d)break}else if(a.firstChild||a.nextSibling){a=a.firstChild||a.nextSibling;continue}for(;;){if(a.nextSibling){a=a.nextSibling;break}if(a.parentNode===e)break e;a=a.parentNode}}return n?void 0:l}t.exports=i},{}],88:[function(e,t,n){function i(){var e={Android:function(){return/Android/i.test(s)},BlackBerry:function(){return/BlackBerry/i.test(s)},iOS:function(){return/iPhone|iPad|iPod/i.test(s)},Opera:function(){return/Opera Mini/i.test(s)},Windows:function(){/IEMobile/i.test(s)}};for(var t in e)if(e[t]())return t;return null}function r(){return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(s)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(s.substr(0,4))||/micromessenger/i.test(s)}function o(){return!!i()||r()}var s=navigator.userAgent||navigator.vendor||window.opera;t.exports=o},{}],89:[function(e,t,n){function i(e,t,n){return"undefined"==typeof n||0===+n?Math[e](t):(t=+t,n=+n,isNaN(t)||"number"!=typeof n||n%1!==0?NaN:(t=t.toString().split("e"),t=Math[e](+(t[0]+"e"+(t[1]?+t[1]-n:-n))),t=t.toString().split("e"),+(t[0]+"e"+(t[1]?+t[1]+n:n))))}var r={};r.round10=function(e,t){return i("round",e,t)},r.floor10=function(e,t){return i("floor",e,t)},r.ceil10=function(e,t){return i("ceil",e,t)},t.exports=r},{}],90:[function(e,t,n){function i(e){return e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")}function r(e,t,n){var i=e.cloneRange(),r=i.text(),o=r.length,s=o-n;if(0>s){if(i.moveStart("character",s),!$.contains(t[0],i.commonAncestorContainer))return arguments.callee(e,t,n>>1);r=i.text()}return{text:r.substr(-o),prefix:r.substring(0,r.length-o)}}function o(e){return function(t){var n=t.nodeType==Node.TEXT_NODE;n&&(t=l.wrapTextNode(t));var i=t.getBoundingClientRect();n&&(t=l.unwrapTextNode(t));for(var r=new u(i.left,i.top,i.width,i.height),o=0;o<e.length;o++)if(r.intersects(e[o]))return!0;return!1}}function s(e){var t=rangy.createRange();return t.setStart(e.startNode,e.startNodeIndex),t.setEnd(e.endNode,e.endNodeIndex),t}function a(e,t){if(!e.length)return null;if(!t||!t.length)return s(e[0]);for(var n=null,i=0,r=o(t),a=0;a<e.length;a++){var c=s(e[a]),l=c.getNodes([Node.TEXT_NODE,Node.ELEMENT_NODE],r);l.length>i&&(i=l.length,n=c)}return n}function c(e,t){t=$.extend({matchFilter:null,insertWhitespace:!1,removeDiacritics:!1,matchTranslits:!1,matchCase:!1,matchBrokenTxt:!1,matchWeirdCitations:!1,matchMisconverted:!1,matchBrokenSpaces:!1,matchBrokenDigits:!1,boundingRects:null},t);var n=e.text,r=e.prefix;t.insertWhitespace&&(n=n.replace(/\s+/g,"").split("").join(" "),r=r.replace(/\s+/g,"").split("").join(" "));var o=i(n),s=i(r);if(t.removeDiacritics&&(o=p.remove(o)),t.matchTranslits){o=o.replace(/\\?[-]/gi,"."),o=o.replace(/([szc]{1})/gi,"$1[`'\"~]? ");var c=o.replace(/([aeiou]{1})/gi,".");c.replace(/[^a-z]/gi,"").length>3&&(o=c)}if(t.matchBrokenTxt&&e.text.match(/[a-z]+/i)&&e.text.match(/\d{4}/)&&(o=o.replace(/([a-z0-9]{1})/gi,"(?:$1|[^\\x20-\\x7F]{1})")),t.matchWeirdCitations&&(o=o.replace(/(| )/gi,"."),s=s.replace(/(\d+)\\\)/,"$1 \\)")),t.matchMisconverted){var l=s.replace(/(ff|fi|fl|[^\x00-\x7F])/gi,"(?:$1|.{1,2})"),u=o.replace(/(ff|fi|fl|[^\x00-\x7F])/gi,"(?:$1|.{1,2})");l.replace(/[^a-z]/gi,"").length&&(s=l),u.replace(/[^a-z]/gi,"").length&&(o=u)}t.matchBrokenDigits&&(o=o.replace(/\d+/g,"(?:[^\\x00-\\x7F]|\\d)+"),s=s.replace(/\d+/g,"(?:[^\\x00-\\x7F]|\\d)+")),t.matchBrokenSpaces&&(o=o.replace(/\s+/g,"(?:[^\\x00-\\x7F]|\\s)+"),s=s.replace(/\s+/g,"(?:[^\\x00-\\x7F]|\\s)+")),o="("+o.replace(/\s+/g,"\\s*")+")",s=s.replace(/\s+/g,"\\s*");var f=(t.matchCase?"":"i")+"g",h=new RegExp(s+"\\s*"+o,f),g=d(h,t.container[0],null,1);return t.matchFilter&&(g=$.grep(g,t.matchFilter)),a(g,t.boundingRects)}var l=e("./util"),u=e("./rect"),d=e("./findtxt"),p=e("./diacritics");t.exports={serialize:r,deserialize:c}},{"./diacritics":86,"./findtxt":87,"./rect":91,"./util":96}],91:[function(e,t,n){function i(e,t,n,i){this.left=e,this.top=t,this.width=n,this.height=i}i.prototype.intersects=function(e){return this.left<=e.left+e.width&&e.left<=this.left+this.width&&this.top<=e.top+e.height&&e.top<=this.top+this.height},i.prototype.boundingRect=function(e){var t=Math.max(this.left+this.width,e.left+e.width),n=Math.max(this.top+this.height,e.top+e.height);this.left=Math.min(this.left,e.left),this.top=Math.min(this.top,e.top),this.width=t-this.left,this.height=n-this.top},i.prototype.translate=function(e,t){return this.left+=e,this.top+=t,this},i.prototype.scale=function(e,t){return this.left*=e,this.width*=e,this.top*=t,this.height*=t,this},i.prototype.clone=function(){return new i(this.left,this.top,this.width,this.height)},t.exports=i},{}],92:[function(e,t,n){function i(e){return window[e+"Storage"]}function r(e,t){try{return i(e).getItem(t)}catch(n){return null}}function o(e,t,n){try{return i(e).setItem(t,n)}catch(r){}}function s(e,t){try{return i(e).removeItem(t)}catch(n){}}function a(e){try{return i(e).clear()}catch(t){}}var c={},l={};c.get=_.partial(r,"local"),c.set=_.partial(o,"local"),c.remove=_.partial(s,"local"),c.clear=_.partial(a,"local"),l.get=_.partial(r,"session"),l.set=_.partial(o,"session"),l.remove=_.partial(s,"session"),l.clear=_.partial(a,"session"),t.exports={local:c,session:l}},{}],93:[function(e,t,n){function i(){var e=document.getElementsByTagName("body")[0],t=document.createElement("div");t.style.position="absolute",t.style.visibility="hidden",t.style.fontFamily='"Georgia"',t.innerHTML="PICS",e.appendChild(t);var n=10,i=4,r=.1;t.style.fontSize=n+"px";var o=t.offsetWidth;t.style.fontSize=n*i+"px";var s=t.offsetWidth;return e.removeChild(t),Math.abs(s/o-i)<r}t.exports=i},{}],94:[function(e,t,n){function i(e,t){return e.translate?t?["translate3d(",e.translate.x,"px,",e.translate.y,"px,0)"].join(""):["translate(",e.translate.x,"px,",e.translate.y,"px)"].join(""):""}function r(e){return e.scale?["scale(",e.scale,")"].join(""):""}function o(e){return e?[e.x+"px",e.y+"px",0].join(" "):""}function s(e,t,n){var o=r(t),s=i(t,n),a=[s,o].join(" ");a&&(e[0].style.webkitTransform=a,e[0].style.mozTransform=a,e[0].style.transform=a)}function a(e,t){var n=o(t);n&&(e[0].style.webkitTransformOrigin=n,e[0].style.mozTransformOrigin=n,e[0].style.transformOrigin=n)}t.exports={setElementTransformOrigin:a,setElementTransform:s}},{}],95:[function(e,t,n){function i(){function e(e){var t=h[0].getBoundingClientRect(),n=e?{x:(e.x-t.left)/b.scale,y:(e.y-t.top)/b.scale}:{x:0,y:0},i=(n.x-k.x)*(b.scale-1),r=(n.y-k.y)*(b.scale-1);k=n,b.translate.x+=i,b.translate.y+=r,w=b.scale,m+=i,v+=r}function t(e){e=Math.min(e,_),e=Math.max(e,y),b.scale=e}function n(e,t){t&&(e=i(e)),b.translate=e}function i(e){var t=h[0].offsetWidth*b.scale,n=h[0].offsetHeight*b.scale,i=k.x*(b.scale-1),r=k.y*(b.scale-1),o=g.viewport.left+g.viewport.width-t,s=g.viewport.top+g.viewport.height-n;return t>g.viewport.width?(e.x=Math.max(e.x,i+o),e.x=Math.min(e.x,i)):e.x=i+o/2,n>g.viewport.height?(e.y=Math.max(e.y,r+s),e.y=Math.min(e.y,r)):e.y=r+s/2,e}function o(e){r.setElementTransformOrigin(h,k),r.setElementTransform(h,b,e)}function s(e){C||(C=!0,requestAnimationFrame(function(){o(e),C=!1}))}function a(e){n({x:m+e.deltaX,y:v+e.deltaY},!E),s(E)}function c(e){t(w*e.scale),s(E)}function l(){e(),n(b.translate,!0),m=b.translate.x,v=b.translate.y,w=b.scale,b={translate:{x:m,y:v},scale:w},o()}function u(){m=0,v=0,w=g.scale||1,y=w,_=8*w,k={x:0,y:0},b={translate:{x:m,y:v},scale:w}}function d(t,n){g=n,h=t,h[0].ontouchmove=function(e){e.preventDefault()},u(),x=new Hammer.Manager(h[0]),x.add(new Hammer.Pan({pointers:0})),x.add(new Hammer.Pinch).recognizeWith(x.get("pan")),x.on("pinchstart",function(t){E=!0,h.addClass("pinching"),e(t.center)}),x.on("panstart panmove",a),x.on("pinchstart pinchmove",c),x.on("hammer.input",function(e){e.isFinal&&(l(),h.removeClass("pinching"),E=!1)}),l()}function p(n){var i=n.width/g.viewport.width;g.viewport=n,w*=i,y*=i,_*=i,e({x:g.viewport.left,y:g.viewport.top}),t(b.scale*i),l()}function f(e){g.scale=e,u(),l()}var h,g,m,v,w,y,_,b,k,x,C,E,$={};return $.init=d,$.resize=p,$.reset=f,$}var r=e("./transform_helper");t.exports=i},{"./transform_helper":94}],96:[function(e,t,n){function i(){return!P.production()||N.local.get("readcube-console-log")}function r(){try{Array.prototype.unshift.call(arguments,"[READCUBE]"),i()&&console.log.apply(console,arguments)}catch(e){}}function o(e){return $.extend(!0,{},e)}function s(){return Array.prototype.splice.call(arguments,0,0,!0,{}),$.extend.apply($,arguments)}function a(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0,n="x"==e?t:3&t|8;return n.toString(16)})}function c(e){var t=[];for(var n in e)t.push(n+"="+encodeURIComponent(e[n]));return t.join("&")}function l(e,t){var n=e.split("#");return n[0]+=-1==n[0].indexOf("?")?"?":"&",n[0]+=c(t),n.join("#")}function u(e,t,n){$("<link>",{rel:"stylesheet",type:"text/css",href:e}).error(n||_.noop).load(t||_.noop).appendTo("head")}function d(e,t){var n=document.createElement("script");n.onload=t||_.noop,n.src=e,document.getElementsByTagName("head").item(0).appendChild(n)}function p(e){for(var t={top:+(1/0),left:+(1/0),bottom:-(1/0),right:-(1/0)},n=0;n<e.length;n++){var i=e[n].getBoundingClientRect();t.top=Math.min(t.top,i.top),t.left=Math.min(t.left,i.left),t.bottom=Math.max(t.bottom,i.bottom),t.right=Math.max(t.right,i.right)}return t}function f(){var e=["webkit","moz","ms","o"];if("hidden"in document)return"hidden";for(var t=0;t<e.length;t++)if(e[t]+"Hidden"in document)return e[t]+"Hidden";return null}function h(){var e=f();return e?document[e]:!1}function g(e){return"undefined"==typeof e?(new Date).toISOString():new Date(e).toISOString()}function m(e){var t={};if(!e)return t;for(var n=0;n<e.length;n++)t[e[n].id]=e[n];return t}function v(e){var t=[];if(!e)return t;for(var n in e)t.push(e[n]);return t}function w(e,t){return _.pick(_.pick(e,t||_.keys(e)),function(e){return"undefined"!=typeof e})}function y(e,t){var n={};for(var i in e)if(i in t)if(_.isObject(t[i])&&!_.isArray(t[i])){var r=y(e[i],t[i]);_.isEmpty(r)||(n[i]=r)}else _.isEqual(e[i],t[i])||(n[i]=t[i]);for(var i in t)i in e||(n[i]=t[i]);return n}function b(e){var t=document.createElement("span");return e.parentNode.insertBefore(t,e),t.appendChild(e),t}function k(e){var t=e.firstChild;return e.parentNode.insertBefore(t,e),e.parentNode.removeChild(e),t}function x(e){return e.textContent&&/[^\s]/.test(e.textContent)}function C(e){var t=!1;return e.each(function(){return x(this)&&j($(this).css("color"))?(t=!0,!1):void 0}),t}function E(e,t){var n=e.commonAncestorContainer;return n.nodeType==Node.TEXT_NODE&&(n=n.parentNode.parentNode),t?$(n).find("."+t):(t=a(),rangy.createClassApplier(t).applyToRange(e),$(n).find("."+t).removeClass(t))}function F(){try{return window.self!==window.top}catch(e){return!0}}function A(e){F()?window.parent.postMessage({type:"redirect",url:e},"*"):location.href=e}function T(e){return $('meta[name="'+e+'"]').attr("content")}function X(){var e="reader-referrer-"+CryptoJS.MD5(location.href).toString(),t=N.session.get(e);return t?t:(t=T("reader-referrer")||parseUri(document.referrer).host,t&&N.session.set(e,t),t)}function j(e){return/transparent|rgba\(.+,\s?0\)/.test(e)}function Y(e){return{top:parseFloat(e.paddingTop),right:parseFloat(e.paddingRight),bottom:parseFloat(e.paddingBottom),left:parseFloat(e.paddingLeft)}}function S(e){return{top:parseFloat(e.borderTop),right:parseFloat(e.borderRight),bottom:parseFloat(e.borderBottom),left:parseFloat(e.borderLeft)}}function I(e){var t=getComputedStyle(e[0]),n=e[0].getBoundingClientRect(),i=Y(t),r=S(t),o={top:i.top+r.top,right:i.right+r.right,bottom:i.bottom+r.bottom,left:i.left+r.left};return{top:n.top+o.top,left:n.left+o.left,bottom:n.bottom-o.bottom,right:n.right-o.right,width:n.width-o.left-o.right,height:n.height-o.top-o.bottom}}var N=e("./storage"),P=e("../environment"),O=function(){var e={};return{tic:function(){var t=a();return e[t]=Date.now(),t},toc:function(t){var n=Date.now()-e[t];return delete e[t],n}}}();t.exports={log:r,meta:T,guid:a,clone:o,merge:s,timer:O,loadCss:u,loadScript:d,addParams:l,getBoundingRect:p,wrapTextNode:b,unwrapTextNode:k,getElems:E,docHidden:h,arrayToHash:m,hashToArray:v,pickDefined:w,dateISO:g,objDiff:y,redirectOrPost:A,referrerHost:X,getInnerRect:I,hasTransparentText:C}},{"../environment":54,"./storage":92}],97:[function(e,t,n){function i(){var e=["webkit","moz","ms","o"];if("hidden"in document)return"hidden";for(var t=0;t<e.length;t++)if(e[t]+"Hidden"in document)return e[t]+"Hidden";return null}function r(){var e=i();return e?document[e]:!1}function o(e){var t=i();if(t){var n=t.replace(/[H|h]idden/,"")+"visibilitychange";document.addEventListener(n,e)}}function s(){return new Promise(function(e){e=_.once(e),r()?o(function(){r()||e()}):e()})}var a={};a.isHidden=r,a.onChange=o,a.visible=s,t.exports=a},{}],98:[function(e,t,n){function i(e){function t(e){1==++d&&$(l).trigger("loading-start")}function n(e,t){t&&!p[e]&&(++u,p[e]=!0,$(l).trigger("page-loaded",[e])),0==--d&&$(l).trigger("loading-stop")}function i(i,r,o){t(i),e[i].load(function(){n(i,!0),r&&r()},function(){n(i,!1),o&&o()})}function r(t,n){for(var r=0,o=!1,s=0;s<e.length;s++)i(s,function(){++r==e.length&&t&&t()},function(){o||(o=!0,n&&n())})}function o(){for(var t=0;t<e.length;t++)e[t].isVisible()&&i(t)}function s(t,n){f=!1,n=n||h;for(var r=Math.min(e.length,1+2*n),o=[t],s=0,a=1;o.length<r;a++){var c=t-a,l=t+a;c>=0&&o.push(c),l<e.length&&o.push(l)}!function(){if(!(f||s>=r)){var e=arguments.callee,t=o[s];i(t,function(){++s,e()})}}()}function a(){f=!0}function c(){return u}var l={},u=0,d=0,p={},f=!1,h=2;return l.loadAll=r,l.loadVisible=o,l.preloadPages=s,l.stopPreloading=a,l.getLoadedCnt=c,l}t.exports=i},{}],99:[function(e,t,n){function i(e){function t(){return e.container.width()/(w.width*w.zoom)}function n(){return $('<div class="pf w0 h0 hw-accel hidden"></div>')}function i(){return $(sprintf('<img class="bf" src="%s">',e.urls.bg))}function s(){return $(sprintf('<img class="bt" src="%s">',e.urls.thumb))}function a(t){var n=$(t).find(".pc");return e.urls.bg&&(n.prepend(i()),n.addClass("full-text")),n.prepend(s()),n}function c(){return n().append('<div class="pc"></div>')}function l(t){return e.urls.text?void $.ajax({url:e.urls.text,dataType:"text",success:function(e){t(a($(e)))}}):void t(a(c()))}function u(i){v=n(),v.append(i),v.appendTo(e.container),v.removeClass("hidden"),m=o(),m.init(v,{viewport:r.getInnerRect(e.container),scale:t()})}function d(){v.length?(v.removeClass("hidden"),m.reset(t())):e.text?u(a(e.text)):l(u)}function p(){v.addClass("hidden")}function f(){m&&v.length&&m.resize(r.getInnerRect(e.container))}function h(t){e.urls.text||(e.urls=t,v.length&&l(function(e){v.empty(),v.append(e)}))}var g={},m=null,v=$(),w=e.dimensions;return g.show=d,g.hide=p,g.resize=f,g.setUrls=h,g}var r=e("../utils/util"),o=e("../utils/transformable");t.exports=i},{"../utils/transformable":95,"../utils/util":96}],100:[function(e,t,n){function i(e){return Math.min(y.length-1,Math.max(0,e))}function r(e,t){x&&(t?$(w).trigger(e,[t]):$(w).trigger(e))}function o(e){return e.text&&e.text.length?new Promise(function(t,n){$.ajax({url:e.text[0],dataType:"text",success:t,error:function(){n({error:"load_html_fail"})}})}):Promise.reject({error:"load_html_fail"})}function s(e){return e.stylesheet?new Promise(function(t,n){m.loadCss(e.stylesheet,t,function(){n({error:"load_html_fail"})})}):Promise.reject({error:"load_html_fail"})}function a(e){d(function(){_.each(y,function(t,n){t.setUrls({thumb:e.thumb[n],text:e.text[n],bg:e.background[n]})})})}function c(e,t,n,i){var r=t.size||t.sizes[n],o={container:C,dimensions:{zoom:t.zoom,height:r[1],width:r[0]},urls:{thumb:e.thumb[n],text:e.text[n],bg:e.background[n]}};return i&&(o.text=i),new v(o)}function l(e){return Promise.all([o(e),s(e)]).then(function(t){var n=t[0],i=$(n).data("pages"),o=i.length;y.push(c(e,i,0,n));for(var s=1;o>s;s++)y.push(c(e,i,s));u(0),x=!0,r("initialized")})}function u(e){e!=b&&(k&&k.hide(),k=y[b=e],k.show(),r("page-changed",b+1))}function d(e){x?e():$(w).one("initialized",e)}function p(e){C=e,$(window).on("resize",function(){_.each(y,function(e){e.resize()})})}function f(){return x?y.length:0}function h(){return x?b+1:0}function g(e){e=parseInt(e),isNaN(e)||(e=i(e-1),u(e))}var m=e("../utils/util"),v=e("./mobile_page"),w={},y=[],b=null,k=null,x=!1,C=null;w.init=p,w.onInit=d,w.setPreviewData=l,w.setFullData=a,w.numPages=f,w.gotoPage=g,w.getPage=h,t.exports=w},{"../utils/util":96,"./mobile_page":99}],101:[function(e,t,n){var i=e("../utils/rect"),r=e("../utils/browser"),o=e("promise-retry"),s=0,a=function(e){this._dimensions=e.dimensions,this._container=e.container,this._text=e.text,this._urls=e.urls,this._init()};a.prototype={_init:function(){this._page=this._createPlaceholder(),this._bgLoaded=!1,this._drawable=null,this._eventable=null,this._content=null,this._loading=!1,this._loaded=!1,this._jqxhr=null,this._scale=1,this._scalePage(),this._page.appendTo(this._container)},_createPlaceholder:function(){return $('<div class="pf w0 h0"></div>')},_setThumb:function(){var e=this;o(function(t){return new Promise(function(t,n){return e._urls.text?t():(e._page.find("img.bt").remove(),void $('<img class="bt" alt="" src="'+e._urls.thumb+'">').on("dragstart",!1).one("load",t).one("error",n).prependTo(e._page))})["catch"](t)},{retries:s})["catch"](_.noop)},_setImageBg:function(){var e=this;o(function(t){return new Promise(function(t,n){e._content.find("img.page-bg").remove(),$('<img class="bf page-bg" alt="" src="'+e._urls.bg+'">').on("dragstart",!1).one("load",t).one("error",n).prependTo(e._content)}).then(function(){e._bgLoaded=!0})["catch"](t)},{retries:s})["catch"](_.noop)},_setObjectBg:function(){var e=this;o(function(t,n){return new Promise(function(t,n){e._content.find("object.page-bg").remove();var i=$('<object class="bf page-bg" data="'+e._urls.bg+'"></object>').attr("type","image/svg+xml").on("dragstart",!1).prependTo(e._content);i[0].addEventListener("load",t),i[0].addEventListener("error",n)}).then(function(){e._bgLoaded=!0})["catch"](t)},{retries:s})["catch"](_.noop)},_setBackground:function(){this._urls&&(this._page.find("img.bt").remove(),/chrome|safari/.test(r.name)?this._setObjectBg():this._setImageBg())},_scalePage:function(){if(this._page.css({width:this._dimensions.width*this._scale,height:this._dimensions.height*this._scale,margin:this._dimensions.margin*this._scale+"px auto"}),this._content){var e=this._scale/this._dimensions.zoom;this._content.css("transform","scale("+e.toFixed(5)+")")}},_createPage:function(e){this._content=$(e).find(".pc"),this._content.find("a").each(function(){var e=$(this),t=e.attr("href");/^http(s)?:\/\//.test(t)||e.attr("href","http://"+t.replace(/^\/+/,"")),e.attr("target","_blank")}),this._drawable=$('<div class="drawable"></div>'),this._eventable=$('<div class="eventable"></div>'),this._content.prepend(this._drawable),this._content.append(this._eventable),this._content.appendTo(this._page),this._scalePage(),this._setBackground()},_handleLoadSuccess:function(){this._jqxhr=null,this._loaded=!0,this._loading=!1,$(this).trigger("loaded")},_loadPage:function(){var e=this;this._text?(this._createPage(this._text),this._handleLoadSuccess()):this._urls.text?o(function(t){return new Promise(function(t,n){e._jqxhr=$.ajax({url:e._urls.text,dataType:"text",success:t,error:n})}).then(function(t){e._loading&&(e._createPage(t),e._handleLoadSuccess())})["catch"](function(n){e._loading&&(/^4\d{2}$/.test(n.status)||t())})},{retries:s})["catch"](_.noop):this._urls.thumb&&(this._setThumb(),this._handleLoadSuccess())},setUrls:function(e){!this._urls.text&&e.text&&(this._page.find("img").off("error"),this._jqxhr&&this._jqxhr.abort(),this._loading=!1,this._loaded=!1,this._jqxhr=null,this._urls=e)},updateUrls:function(e){this._urls=e},hasAccess:function(){return!!this._urls.text},hasText:function(){return!!this._content},fullyLoaded:function(){return this.hasAccess()?this._bgLoaded&&this.hasText():!0},load:function(e,t){this.onLoaded(e),this._loaded||this._loading||(this._loading=!0,this._loadPage())},scale:function(e){this._scale!=e&&(this._scale=e,this._scalePage())},rotateBy:function(e){var t=this;this._deg=(this._deg||0)+Math.floor(e),this._page.css({transition:"all .2s ease",transform:"rotate("+this._deg+"deg)"}),setTimeout(function(){t._page.css("transition","none")},200)},isVisible:function(){var e=this._container[0].getBoundingClientRect(),t=this._page[0].getBoundingClientRect();return i.prototype.intersects.call(e,t)},getElem:function(){return this._page},getWidth:function(){return this._dimensions.width},getHeight:function(){return this._dimensions.height},getMargin:function(){return this._dimensions.margin},getScale:function(){return this._scale},getZoom:function(){return this._dimensions.zoom},getDrawable:function(){return this._drawable},getEventable:function(){return this._eventable},onLoaded:function(e){e=e||function(){},this._loaded&&e(),$(this).on("loaded",e)},destroy:function(){this._page.remove()}},t.exports=a},{"../utils/browser":84,"../utils/rect":91,"promise-retry":5}],102:[function(e,t,n){function i(e,t){W&&(t?$(V).trigger(e,[t]):$(V).trigger(e))}function r(){J=B(H),$(J).on({"page-loaded.viewer":function(e,t){J.getLoadedCnt()>=H.length&&te.off("scroll.loader"),i("page-loaded",t+1)},"loading-start.viewer":function(){i("loading-start")},"loading-stop.viewer":function(){i("loading-stop")}})}function o(e){return Math.min(H.length-1e-9,Math.max(0,e))}function s(){var e=parseInt(te.css("padding-left")),t=parseInt(te.css("padding-right"));return te[0].getBoundingClientRect().width-e-t}function a(){return 0}function c(){return te.height()}function l(){return c()/(H[Z].getHeight()+ee)/K}function u(){var e,t=0,n=(te.scrollTop()-a())/K;for(e=0;e<H.length&&(t+=H[e].getHeight()+ee,!(t>n));e++);var i=(t-n)/(H[e].getHeight()+ee);return e+(1-i)}function d(e){var t,n=e>0?Math.floor(e):Math.ceil(e),i=e-n,r=0;for(t=0;n>t;t++)r+=H[t].getHeight()+ee;return r+=i*(H[t].getHeight()+ee),Math.round(r*K)+a()}function p(e,t){var n=d(e);t&&(n+=ee/2),te.scrollTop(n),g(),i("scroll")}function f(){return o(u()+l()/2)}function h(){var e=Math.floor(f());Z!=e&&(Z=e,i("page-changed",e+1)),i("scroll")}function g(){J.stopPreloading(),J.loadVisible()}function m(){J.preloadPages(Math.floor(f()))}function v(){te[0].style.display="block"}function w(){v(),H.forEach(function(e){var t=e.getElem();e.isVisible()?t.addClass("open"):t.removeClass("open")})}function y(){b(),te.on("scroll.update",_.throttle(h,100)),te.on("scroll.render",_.debounce(w,100)),te.on("scroll.loader",_.debounce(g,200)),te.on("scroll.loader",_.debounce(m,1e3))}function b(){te.off("scroll.update"),te.off("scroll.render"),te.off("scroll.loader")}function k(e){return E(e/H[0].getWidth())}function x(e,t){e?(clearInterval(Q),Q=setInterval(t,500),t()):t()}function C(){clearInterval(Q),Q=null}function E(e){var t=u();0>=e&&(e=1),K=e,H.forEach(function(t){t.scale(e)}),p(t),v(),i("scale")}function F(e,t){t=parseInt(t)||Z,H[t].rotateBy(e),v(),i("rotate")}function A(e){E(K*e)}function T(e){x(e,function(){E(s()/H[Z].getWidth())})}function X(){var e=s()/H[Z].getWidth();K>e&&T()}function j(e){x(e,function(){var e=s()/H[Z].getWidth(),t=c()/(H[Z].getHeight()+ee);E(Math.min(e,t))})}function Y(e){W?e():$(V).one("initialized",e)}function S(e){return e.text&&e.text.length?new Promise(function(t,n){$.ajax({url:e.text[0],dataType:"text",success:t,error:function(e){(trackJs||window).console.log(sprintf("first page failed, status: %s, statusText: %s, readyState: %s",e.status,e.statusText,e.readyState)),n({error:"load_html_fail"})}})}):Promise.reject({error:"load_html_fail"})}function I(e){return e.stylesheet?new Promise(function(t,n){L.loadCss(e.stylesheet,t,function(){
n({error:"load_html_fail"})})}):Promise.reject({error:"load_html_fail"})}function N(){"fit-width"==G?T():"fit-page"==G?j():k(Math.min(G,s())),te.scrollTop(0)}function P(){for(;H.length;)H.pop().destroy()}function O(e,t,n,i){var r=t.size||t.sizes[n],o={container:te,dimensions:{zoom:t.zoom,height:r[1],width:r[0],margin:ee},urls:{thumb:e.thumb[n],text:e.text[n],bg:e.background[n]}};return i&&(o.text=i),new z(o)}function R(e){return Promise.all([S(e),I(e)]).then(function(t){var n=t[0],o=$(n).data("pages"),s=o.length;r(),P(),H.push(O(e,o,0,n));for(var a=1;s>a;a++)H.push(O(e,o,a));N(),y(),m(),w(),W=!0,i("initialized")})}function D(e){Y(function(){H.forEach(function(t,n){t.updateUrls({thumb:e.thumb[n],text:e.text[n],bg:e.background[n]})})})}function M(e){return M.called?void D(e):(M.called=!0,void Y(function(){H.forEach(function(t,n){t.setUrls({thumb:e.thumb[n],text:e.text[n],bg:e.background[n]})}),r(),y(),m(),w()}))}function U(e){te=e,q=te.find("#journal-banner"),advert=te.find("#advert-leaderboard"),r(),H=[new z({container:te,text:"<div></div>",dimensions:{width:G,height:1200,margin:12,zoom:1}})],N()}var L=e("../utils/util"),z=e("./page"),B=e("./loader"),V={},H=[],J=null,q=null,W=!1,Q=null,G=900,K=1,Z=0,ee=8,te=null;V.init=U,V.onInit=Y,V.setPreviewData=R,V.setFullData=M,V.fitPage=function(e){return W?j(e):void 0},V.shrinkToWidth=function(){return W?X():void 0},V.fitWidth=function(e){return W?T(e):void 0},V.getElem=function(){return W?te:void 0},V.getPage=function(){return W?Z+1:0},V.getPageObj=function(e){return W?H[e-1]:void 0},V.eachPage=function(e){if(W)for(var t=0;t<H.length;t++)if(!1===e(t+1,H[t]))return},V.eachVisiblePage=function(e){if(W)for(var t=0;t<H.length;t++)if(H[t].isVisible()&&!1===e(t+1,H[t]))return},V.gotoPage=function(e){return W&&(e=parseFloat(e),!isNaN(e))?p(o(e-1),!0):void 0},V.loadAll=function(e,t){W&&J.loadAll(e,t)},V.numPages=function(){return W?H.length:0},V.numVisiblePages=function(){return W?l():0},V.scaleBy=function(e){return W?(C(),A(e)):void 0},V.scaleTo=function(e){return W?(C(),E(e)):void 0},V.rotatePageBy=function(e,t){return W?F(e,t):void 0},window.viewer=V,t.exports=V},{"../utils/util":96,"./loader":98,"./page":101}],103:[function(e,t,n){function i(t,n,i,r,o){return{restrict:"A",link:function(s,a,c){function l(){a.find("iframe").length&&(a.data("iframe-width")||a.data("iframe-width",a.find("iframe").width()),a.toggleClass("hidden",a.width()<a.data("iframe-width")))}t.parent&&r.onInit(function(r){if("wiley"==r.publisher){var s=parseUri(t.parent).host;n.production()&&"qae.onlinelibrary.wiley.com"!=s||(googletag=e("../core/includes/gpt"),$(i.all).on("ad_data",function(e,t){var n=t.data,i=["",n.network_id,n.subject_id,n.journal_id].join("/");googletag.cmd.push(function(){var e=googletag.sizeMapping().addSize([768,100],[728,90]).addSize([340,100],[300,50]).build();googletag.defineSlot(i,[[728,90],[300,50]],"advert-leaderboard").defineSizeMapping(e).setCollapseEmptyDiv(!0).addService(googletag.pubads()),_.each(n.targeting,function(e,t){googletag.pubads().setTargeting(t,e)}),googletag.pubads().enableSingleRequest(),googletag.enableServices(),googletag.display("advert-leaderboard"),$(o).on("scale",l),$(window).on("resize",_.debounce(l,100)),l()})}),window.parent.postMessage({type:"get_ad_data"},"*"))}})}}}i.$inject=["endpoint","environment","receiver","article","viewer"],angular.module("reader").directive("advertLeaderboard",i)},{"../core/includes/gpt":61}],104:[function(e,t,n){function i(e,t,n,i,r,o,s,a){function c(e){return _.max(e,function(e){return e[1]})[1]}function l(e){var t=e.page_start+1,n=r.getPageObj(t);if(n){var i=n.getHeight(),o=(i-c(e.rects))/i;return t+o}return 0}function u(e){return new Date(e.created)}function d(e){return new Date(e.modified||e.created)}function p(){if(!i.get().doi)return"notes";var e=o.getKey(i.get().meta);return"supplement"==i.getType()&&(e+=sprintf("-supplement(%s)",i.get().index+1)),e+"-notes"}var f=["webkitTransitionEnd","otransitionend","oTransitionEnd","msTransitionEnd","transitionend"].join(" ");return n.toggleAnnots=function(){$("body").toggleClass("annotations-open"),n.isAnnotsOpen()&&s.sidepanel("notes")},n.isAnnotsOpen=function(){return $("body").hasClass("annotations-open")},{restrict:"E",link:function(n,i){r.onInit(function(){n.annots=a.listArr(),n.predicates={position:function(e){return-l(e)},modified:d,created:u},n.directions={descending:!0,ascending:!1},n.sortPredicate="position",n.sortDirection="descending",n.annotationCreated=u,n.annotationModified=d,n.downloadAnnots=function(){var e={type:"text/csv;charset=UTF-8"},i=_.map(n.annots,function(e){return{Text:t("breaksToSpaces")(e.text),Note:t("breaksToSpaces")(e.note),Created:u(e).toLocaleString(),Modified:d(e).toLocaleString()}}),r=new Blob([Papa.unparse(i)],e);saveAs(r,p()+".csv"),s.exportNotes()},n.scrollTo=function(e){var t=l(e),n=r.numVisiblePages();r.gotoPage(t-.2*n),r.shrinkToWidth()},$(a).on("changed",function(){e(function(){n.annots=a.listArr()})}),i.on(f,function(){n.isAnnotsOpen()&&r.shrinkToWidth()})})}}}i.$inject=["$timeout","$filter","$rootScope","article","viewer","exporter","tracker","annotationsModel"],angular.module("reader").directive("annotations",i)},{}],105:[function(e,t,n){function i(e,t,n,i,r,o){return{restrict:"E",link:function(s,a){function c(){e(function(){s.loaded=!0})}var l=a.find("iframe"),u=sprintf("%s/?t=%s/#/navigation?embed=1",n.app,Date.now());s.onLogOut=function(){o.clear(),location.href=n.web+"/session/log_out"},s.loaded=!1,$(l).on("load",c),$(i.readcube).on("app:new",c).on("app:linkout",function(){r.linkout("library")}),t.$on("appnav-open",function(){$(document.body).addClass("appnav-open"),l.attr("src")||l.attr("src",u)}),t.$on("appnav-close",function(){$(document.body).removeClass("appnav-open")})}}}i.$inject=["$timeout","$rootScope","endpoint","receiver","tracker","trackId"],angular.module("reader").directive("appnav",i)},{}],106:[function(e,t,n){function i(){return{restrict:"E",controller:"ArticleCtrl",templateUrl:"article.html"}}angular.module("reader").directive("article",i)},{}],107:[function(e,t,n){function i(e,t,n,i,r,o,s,a){return{restrict:"A",link:function(c){function l(e){var t=-1,n=e.commonAncestorContainer;return i.eachPage(function(e,i){return $.contains(i.getElem()[0],n)?(t=e,!1):void 0}),t}function u(e){return-1!=l(e)}n.onInit(function(){n.get().sync_item_sponsored||i.onInit(function(){var e=r(i.getElem(),u);$(new o(e)).on("highlight",function(t,n){var i=e.getRangeAndClear();a.addHighlight(i,l(i),n)}).on("add-note",function(){var t=e.getRangeAndClear();a.addNote(t,l(t),"")})})}),$(s).on("merge-shared-prompt",function(t,n){e.show(e.alert({clickOutsideToClose:!0,templateUrl:"dialogs/import_annotations.html",controller:["$scope",function(t){t.close=function(t){e.hide(),t&&n()}}]}))}),$(s).on("not-synced",function(e,n){"item_not_synced"==n.status&&t.notifyAnnotsNotSynced()})}}}i.$inject=["$mdDialog","toast","article","viewer","Selection","SelectionToolbar","annotationsModel","annotationsController"],angular.module("reader").directive("articleAnnotations",i)},{}],108:[function(e,t,n){function i(e,t){var n=t.left+t.right>>1,i=t.top+t.bottom>>1,r=t.right-t.left>>1,o=t.bottom-t.top>>1,s=Math.max(Math.abs(e.x-n)-r,0),a=Math.max(Math.abs(e.y-i)-o,0);return s*s+a*a}function r(e,t,n,r,o,s,a,c,l,u){return{restrict:"A",link:function(u){function d(e){return angular.merge(n.$new(!0),e)}function p(n){var i=n.getData();switch(n.getType()){case"author":return i.affiliations&&(i.affiliations=_.uniq(i.affiliations)),e(t.get("citations/author.html"))(d(i));case"figure":return i.figures[0]?e('<div figure="figure" index="index"></div>')(d({figure:i.figures[0],index:i.ids[0]-1})):null;default:return e('<div references="references" tracking-source="inline_reference"></div>')(d(i))}}function f(e){return e.css({"max-height":.5*o.getElem().height()+"px"})}function h(e){function t(){return Math.min(i(m,r.getBoundingRect(v)),i(m,r.getBoundingRect(y)))}function n(){return{placement:"up",content:f(y),anchor:w}}function o(){l.open(n()),a.inline(e.getType())}var s=null,c=null,u=500,d=1e3,h=400,v=e.getElems(),w=v.first(),y=p(e);y&&$(e).on("click",function(){clearTimeout(c),o()}).on("mouseenter",function(){g||(s=setTimeout(function(){l.isOpen(w)||(clearTimeout(c),o(),c=setTimeout(function e(){l.isOpen(w)&&(t()>h?l.close(w):(clearTimeout(c),c=setTimeout(e,d)))},d),y.one("click",function(){clearTimeout(c)}))},u))}).on("mouseleave",function(){clearTimeout(s)})}s.onData(function(e){c.init(e),c.forEach(h),$(c).on("add",function(e,t){h(t)})});var g=!1,m={x:0,y:0};$(document).on("mousedown",function(){g=!0,$(document).one("mouseup",function(){g=!1})}),$(document).on("mousemove",function(e){m={x:e.pageX,y:e.pageY}})}}}r.$inject=["$compile","$templateCache","$rootScope","util","viewer","article","tracker","citations","popover","figureViewer"],angular.module("reader").directive("articleCitations",r)},{}],109:[function(e,t,n){function i(e){return{restrict:"E",controller:"ArticleToolsCtrl",templateUrl:"article_tools.html",link:function(t){t.isOpen=!1,t.tooltipVisible=!1;var n=null;t.setOpen=function(i,r){e.cancel(n),n=e(function(){t.isOpen=i},r||0)};var i=null,r=t.$watch("isOpen",function(n){e.cancel(i),n?i=e(function(){t.tooltipVisible=t.isOpen},400):t.tooltipVisible&&(t.tooltipVisible=!1,r())});t.$on("$destroy",function(){e.cancel(i)})}}}i.$inject=["$timeout"],angular.module("reader").directive("articleTools",i)},{}],110:[function(e,t,n){function i(){return{restrict:"A",link:function(e,t,n){n.bgImage&&t.css("background-image","url("+n.bgImage+")")}}}angular.module("reader").directive("bgImage",i)},{}],111:[function(e,t,n){function i(){return{restrict:"A",link:function(e,t,n){n&&n.cancelEvent&&t.on(n.cancelEvent,!1)}}}angular.module("reader").directive("cancelEvent",i)},{}],112:[function(e,t,n){function i(e,t,n,i,r,o,s,a,c){function l(){var e=n.merge({doi:r.get().doi,embed:1,html5:1,hide_formats:1,parent_url:location.href,tracking_origin:"web_reader",tracking_publisher:r.get().publisher},n.pickDefined(t,["tracking_action","purchase_referrer","purchase_site_license"]));return n.referrerHost()&&(e.checkout_referrer=n.referrerHost()),n.addParams(i.web+"/checkout/new",e)}var u=["webkitTransitionEnd","otransitionend","oTransitionEnd","msTransitionEnd","transitionend"].join(" ");return{restrict:"E",link:function(t,i){function d(){e(function(){t.loaded=!0})}var p=i.find("iframe");i.one(u,function(){a.shrinkToWidth()}),t.loaded=!1,$(p).on("load",d),$(s.readcube).on("checkout:new",d).on("checkout:success",function(e,t){c.purchase(t),o.checkAccess()}),$(s.readcube).on("checkout:redirect",function(e,t){n.redirectOrPost(t.url)}),o.onExternalCheck(function(){r.hasAccess()||r.onData(function(){var e=l();e!=p.attr("src")&&p.attr("src",e),$(document.body).addClass("checkout-open"),c.checkout()})}),r.onAccessCheck(function(e){r.hasAccess()&&$(document.body).removeClass("checkout-open")})}}}i.$inject=["$timeout","$stateParams","util","endpoint","article","access","receiver","viewer","tracker"],angular.module("reader").directive("checkout",i)},{}],113:[function(e,t,n){function i(e,t,n){return{restrict:"E",link:function(i){function r(){n.getMetrics().then(function(t){e(function(){i.metrics=t,t.results&&t.results.length?i.scrollMetrics():i.metrics.finished=!0})},_.noop)}i.metrics=void 0,i.scrollMetrics=function(){var t=i.metrics;t.busy||t.finished||(t.busy=!0,n.getMetrics({scroll_id:i.metrics.scroll_id}).then(function(n){e(function(){n.results&&n.results.length?(t.results=t.results.concat(n.results),t.scroll_id=n.scroll_id):t.finished=!0})})["finally"](function(){e(function(){t.busy=!1})}))},t.$on("cited-by-open",_.once(r))}}}i.$inject=["$timeout","$rootScope","article"],angular.module("reader").directive("citedBy",i)},{}],114:[function(e,t,n){function i(e){return{restrict:"A",replace:!0,scope:{figure:"=",index:"="},templateUrl:"citations/figure.html",link:function(t,n,i){i.inlist||(n=n.find(".view-figure")),n.click(function(){e(t.index)})}}}i.$inject=["figureViewer"],angular.module("reader").directive("figure",i)},{}],115:[function(e,t,n){function i(){return{restrict:"A",scope:{loadMore:"&",tresholdPercent:"="},link:function(e,t,n){var i=parseInt(n.tresholdPercent,10)||0;t.on("scroll",function(){var t=(this.scrollTop+this.offsetHeight)/this.scrollHeight*100;(t>i||t>=100)&&e.loadMore()})}}}angular.module("reader").directive("infiniteScroll",i)},{}],116:[function(e,t,n){function i(e,t){return{restrict:"E",link:function(n,i){function r(){e(function(){n.loaded=!0})}var o=i.find("iframe");n.loaded=!1,$(o).on("load",r),$(t.readcube).on("auth:new",r)}}}i.$inject=["$timeout","receiver"],angular.module("reader").directive("login",i)},{}],117:[function(e,t,n){function i(e,t,n,i,r,o,s){return{restrict:"A",link:function(s,a){function c(e){return angular.merge(i.$new(!0),e,{canonical:e.doi&&location.protocol+sprintf("%s/articles/%s",r.web,e.doi),image:e.thumb&&e.thumb[0]&&location.protocol+e.thumb[0]})}o.onData(function(i){"article"==o.getType()&&i.meta&&n(function(){a.append(e(t.get("metadata.html"))(c(i)))})}),o.onInit(function(e){if("supplement"==o.getType()){var t=e.caption?["Supp:",e.caption].join(" "):["Supplement",parseInt(e.index)+1].join(" ");a.append(sprintf("<title>%s</title>",t))}})}}}i.$inject=["$compile","$templateCache","$timeout","$rootScope","endpoint","article","supplement"],angular.module("reader").directive("metadata",i)},{}],118:[function(e,t,n){function i(e){return{restrict:"A",replace:!0,scope:{metrics:"="},templateUrl:"citations/metrics.html",link:function(t,n,i){t.trackLinkout=function(t){e.linkout("cited_by"),t.doi&&i.trackingSource&&e.referral(t.doi,i.trackingSource)}}}}i.$inject=["tracker"],angular.module("reader").directive("metrics",i)},{}],119:[function(e,t,n){function i(e,t,n,i,r,o){return{restrict:"E",link:function(e,s){r.init(s),i.onInit(function(e){r.setPreviewData(e)["catch"](function(e){if(!e||"load_html_fail"!=e.error)throw e;$.get(n.ip_api,function(t){(trackJs||window).console.log("load html fail location:",t),o(e,{country:t.country})}).always(function(){setTimeout(function(){i.onData(function(e){t.redirectOrPost(e.meta.pdf_url)})},300)})})}),i.onAccess(function(e){r.setFullData(e)})}}}i.$inject=["$state","util","endpoint","article","mobileViewer","trackError"],angular.module("reader").directive("mobileArticle",i)},{}],120:[function(e,t,n){function i(){return{restrict:"E",replace:!0,controller:"MobileToolbarCtrl",templateUrl:"toolbars/mobile_toolbar.html"}}angular.module("reader").directive("mobileToolbar",i)},{}],121:[function(e,t,n){function i(e){return{restrict:"A",link:function(t,n,i){var r=e(i.onLoad);n.on("load",function(e){t.$apply(function(){r(t,{$event:e})})})}}}i.$inject=["$parse"],angular.module("reader").directive("onLoad",i)},{}],122:[function(e,t,n){function i(e,t,n,i){return{restrict:"E",replace:!0,templateUrl:"toolbars/page_info.html",link:function(r){r.pageIdx=1,r.numPages=1,n.onInit(function(){e(function(){r.numPages=n.numPages()})}),$(i).on("auth-begin",function(){e(function(){r.authorizing=!0})}),$(i).on("auth-end",function(){e(function(){r.authorizing=!1})}),$(n).on("page-changed",function(t,n){e(function(){r.pageIdx=n})}),$(n).on("scroll",_.throttle(function(){e(function(){r.scrolling=!0})},200)),$(n).on("scroll",_.debounce(function(){e(function(){r.scrolling=!1})},1e3));var o=t(function(){var e=!0,t=!1;n.eachVisiblePage(function(n,i){return t=!0,i.fullyLoaded()?void 0:e=!1}),r.loading=!t||!e},1e3);r.$on("$destroy",function(){t.cancel(o)})}}}i.$inject=["$timeout","$interval","viewer","access"],angular.module("reader").directive("pageInfo",i)},{}],123:[function(e,t,n){function i(e,t,n,i){return{restrict:"A",link:function(r){function o(t){e.info("POST MESSAGE:",t),window.parent.postMessage(t,"*")}function s(e){var n=-1,i=e.commonAncestorContainer;return t.eachPage(function(e,t){return $.contains(t.getElem()[0],i)?(n=e,!1):void 0}),n}function a(e){return-1!=s(e)}t.onInit(function(){var e=n(t.getElem(),a);$(new i(e)).on("marked",function(e,t){o({type:"marked",data:t})})})}}}i.$inject=["$log","viewer","Selection","ResolveToolbar"],angular.module("reader").directive("postSelection",i)},{}],124:[function(e,t,n){function i(e,t){return{restrict:"A",link:function(n,i,r){function o(){function e(e){return p.length?p.is(e.target)||$.contains(p[0],e.target):!1}function o(e){return f.length?f.is(e.target)||$.contains(f[0],e.target):!1}function s(e){return d.length?d.is(e.target)||$.contains(d[0],e.target):!1}function a(e){if(!h.length)return!1;var t=h.width()-e.pageX<180,n=h.height()-e.pageY<240;return t&&n}function c(e){return e.pageY<60}function l(){$("body").on("mousemove",function(e){(c(e)||a(e))&&i.removeClass(r.readMode)}).on("mousemove",_.debounce(function(t){o(t)||e(t)||i.addClass(r.readMode)},2e3))}function u(){var e=new Hammer(document),t=setTimeout(function(){i.addClass(r.readMode)},3e3);e.on("tap",function(e){o(e)?i.removeClass(r.readMode):s(e)&&i.toggleClass(r.readMode),clearTimeout(t),t=setTimeout(function(){i.addClass(r.readMode)},3e3)})}var d=i.find(".viewer"),p=i.find(".article-tools"),f=i.find(".article-menu, .mobile-toolbar"),h=i.find(".article-container");n.$on("start-read-mode",function(){t?u():l()})}r.readMode&&e(o)}}}i.$inject=["$timeout","MOBILE"],angular.module("reader").directive("readMode",i)},{}],125:[function(e,t,n){function i(e,t,n){return{restrict:"A",replace:!0,scope:{references:"="},templateUrl:"citations/references.html",link:function(i,r,o){i.hideLabels=!1,i.trackLinkout=function(e){n.linkout("related"),e.doi&&o.trackingSource&&n.referral(e.doi,o.trackingSource)},t.onData(function(t){e(function(){i.hideLabels=t.meta.hide_reference_labels})})}}}i.$inject=["$timeout","article","tracker"],angular.module("reader").directive("references",i)},{}],126:[function(e,t,n){function i(e){return{restrict:"A",link:function(t,n){function i(){e(function(){t.contracted=o()})}function r(){return parseInt(t.responsive)||880}function o(){return n.width()<r()}t.contracted=o(),$(window).on("resize",_.debounce(i,50)),t.$watch("responsive",i)}}}i.$inject=["$timeout"],angular.module("reader").directive("responsive",i)},{}],127:[function(e,t,n){function i(e){return{restrict:"A",link:function(t,n,i){var r=e(i.targetClick);"function"==typeof r&&n.click(function(e){n.is(e.target)&&t.$apply(function(){r(t,{$event:e})})})}}}i.$inject=["$parse"],angular.module("reader").directive("targetClick",i)},{}],128:[function(e,t,n){function i(e,t,n){return{restrict:"E",link:function(i,r,o){function s(){$(document).on("contextmenu",".viewer",function(e){e.preventDefault()})}function a(){$(document).on("keydown",".viewer",function(e){(e.metaKey||e.ctrlKey)&&67==e.keyCode&&e.preventDefault()})}t.init(r),n.init(r.find("#journal-banner")),e.onAccess(function(){e.isShared()&&(s(),a())})}}}i.$inject=["article","viewer","banner"],angular.module("reader").directive("viewer",i)},{}],129:[function(e,t,n){function i(){return{restrict:"E",replace:!0,templateUrl:"toolbars/viewer_toolbar.html",controller:"ViewerToolbarCtrl",link:function(e,t){UserVoice.push(["addTrigger","#user-voice",{}]);var n=t.closest(".article-container"),i=null;t.addClass("show"),n.on("mousemove",function(e){var r=2*e.pageX>n.width(),o=n.height()-e.pageY<150,s=!$.contains(t[0],e.target);r&&o&&(clearTimeout(i),i=null,t.addClass("show")),!i&&s&&(i=setTimeout(function(){t.removeClass("show")},2e3))})}}}angular.module("reader").directive("viewerToolbar",i)},{}],130:[function(e,t,n){function i(e,t,n,i){var r;e.properties={width:400,height:300,fps:48,color:"#FFFFFF",manifest:[]},(e.panelred=function(){this.initialize(),this.shape=new n.Shape,this.shape.graphics.f("#FF3E3C").s().p("AgJFMQgdgEgSgSIlollQgSgTADgVQADgWAXgNIFtjJQAYgNAaAFQAdAEASASIFoFlQASATgDAVQgEAXgWAMIlsDJQgSAJgUAAIgNgBg"),this.shape.setTransform(43.3,33.4),this.addChild(this.shape)}).prototype=r=new n.Container,r.nominalBounds=new n.Rectangle(0,0,86.6,66.8),(e.panelpurple=function(){this.initialize(),this.shape=new n.Shape,this.shape.graphics.f("#9823C6").s().p("AlWFXQgHgIANgXIDJlpQAMgXAZgaQAZgYAXgOIFrjIQAXgMAHAGQAHAHgMAXIjJFrQgMAXgaAaQgXAYgYAOIlsDIQgOAHgIAAQgFAAgDgCg"),this.shape.setTransform(34.6,34.6),this.addChild(this.shape)}).prototype=r=new n.Container,r.nominalBounds=new n.Rectangle(0,.1,69.2,69.1),(e.panelorange=function(){this.initialize(),this.shape=new n.Shape,this.shape.graphics.f("#FFC34E").s().p("AAwGhIllloQgSgSgEgdQgFgaANgYIDJltQAMgWAXgEQAVgDATASIFlFoQASASAEAdQAFAbgNAYIjJFsQgMAWgXAEIgGAAQgSAAgQgPg"),this.shape.setTransform(33.4,43.3),this.addChild(this.shape)}).prototype=r=new n.Container,r.nominalBounds=new n.Rectangle(0,0,66.8,86.6),(e.panelmagenta=function(){this.initialize(),this.shape=new n.Shape,this.shape.graphics.f("#FE0FA6").s().p("AlWFWQgGgHAMgXIDIlrQANgXAYgZQAagZAXgNIFrjIQAXgMAHAHQAHAHgMAXIjKFrQgNAXgYAYQgaAagWAMIlrDJQgOAIgIAAQgFAAgDgDg"),this.shape.setTransform(34.6,34.6),this.addChild(this.shape)}).prototype=r=new n.Container,r.nominalBounds=new n.Rectangle(0,.1,69.2,69.2),(e.panelgreen=function(){this.initialize(),this.shape=new n.Shape,this.shape.graphics.f("#98D843").s().p("AAwGhIllloQgSgSgEgdQgFgaANgYIDJltQANgXAWgDQAVgDATASIFlFoQASASAEAdQAFAcgNAXIjJFsQgMAXgXADIgGAAQgRAAgRgPg"),this.shape.setTransform(33.4,43.3),this.addChild(this.shape)}).prototype=r=new n.Container,r.nominalBounds=new n.Rectangle(0,0,66.8,86.6),(e.panelblue=function(){this.initialize(),this.shape=new n.Shape,this.shape.graphics.f("#26C4FF").s().p("AgIFNQgdgFgTgSIlnlmQgSgRACgXQADgWAXgNIFtjIQAXgNAcAFQAdAEARASIFoFlQATATgEAVQgDAXgXAMIlsDJQgSAJgWAAIgKAAg"),this.shape.setTransform(43.3,33.4),this.addChild(this.shape)}).prototype=r=new n.Container,r.nominalBounds=new n.Rectangle(0,.1,86.6,66.8),(e.CollapsedLogoErrorAnimation=function(t,i,r){null==r&&(r=!1),this.initialize(t,i,r,{}),this.frame_0=function(){if(window.devicePixelRatio>1){var e=canvas.width,t=canvas.height;canvas.width=e*window.devicePixelRatio,canvas.height=t*window.devicePixelRatio,canvas.style.width=e+"px",canvas.style.height=t+"px",stage.scaleX=stage.scaleY=window.devicePixelRatio}},this.frame_69=function(){try{stop()}catch(e){}},this.timeline.addTween(n.Tween.get(this).call(this.frame_0).wait(69).call(this.frame_69).wait(17)),this.FlashAICB_colour__Path__5=new e.panelpurple,this.FlashAICB_colour__Path__5.setTransform(142.6,86.4,1.5,1.5,0,0,0,34.6,34.6),this.FlashAICB_colour__Path__5.alpha=.898,this.FlashAICB_colour__Path__5.shadow=new n.Shadow("rgba(0,0,0,1)",0,0,0),this.timeline.addTween(n.Tween.get(this.FlashAICB_colour__Path__5).wait(18).to({scaleX:1.48,scaleY:1.48,skewX:2,skewY:1.3,x:142.3,y:91.6},0).wait(1).to({scaleX:1.45,scaleY:1.45,skewX:4,skewY:2.6,x:142.1,y:96.7},0).wait(1).to({scaleX:1.43,scaleY:1.43,skewX:5.9,skewY:3.8,x:141.9,y:101.5},0).wait(1).to({scaleX:1.41,scaleY:1.41,skewX:7.7,skewY:4.9,x:141.6,y:106.2},0).wait(1).to({scaleX:1.38,scaleY:1.38,skewX:9.4,skewY:6.1,x:141.5,y:110.8},0).wait(1).to({scaleX:1.36,scaleY:1.36,skewX:11.1,skewY:7.1,x:141.2,y:115.1},0).wait(1).to({scaleX:1.34,scaleY:1.34,skewX:12.7,skewY:8.2,x:141.1,y:119.3},0).wait(1).to({scaleX:1.32,scaleY:1.32,skewX:14.3,skewY:9.2,x:140.9,y:123.3},0).wait(1).to({scaleX:1.3,scaleY:1.3,skewX:15.8,skewY:10.2,x:140.7,y:127.2},0).wait(1).to({scaleX:1.29,scaleY:1.29,skewX:17.2,skewY:11.1,x:140.5,y:131},0).wait(1).to({scaleX:1.27,scaleY:1.27,skewX:18.6,skewY:12,x:140.3,y:134.6},0).wait(1).to({scaleX:1.25,scaleY:1.25,skewX:19.9,skewY:12.9,x:140.2,y:138.1},0).wait(1).to({scaleX:1.24,scaleY:1.24,skewX:21.2,skewY:13.7,x:140,y:141.4},0).wait(1).to({scaleX:1.22,scaleY:1.22,skewX:22.5,skewY:14.5,x:139.9,y:144.6},0).wait(1).to({scaleX:1.21,scaleY:1.21,skewX:23.7,skewY:15.3,x:139.7,y:147.8},0).wait(1).to({scaleX:1.19,scaleY:1.19,skewX:24.8,skewY:16,x:139.6,y:150.8},0).wait(1).to({scaleX:1.18,scaleY:1.18,skewX:26,skewY:16.7,x:139.4,y:153.7},0).wait(1).to({scaleX:1.16,scaleY:1.16,skewX:27,skewY:17.4,x:139.3,y:156.5},0).wait(1).to({scaleX:1.15,scaleY:1.15,skewX:28.1,skewY:18.1,x:139.2,y:159.3},0).wait(1).to({scaleX:1.14,scaleY:1.14,skewX:29.1,skewY:18.8,x:139.1,y:161.8},0).wait(1).to({scaleX:1.13,scaleY:1.13,skewX:30.1,skewY:19.4,x:138.9,y:164.4},0).wait(1).to({scaleX:1.11,scaleY:1.11,skewX:31,skewY:20,y:166.9},0).wait(1).to({scaleX:1.1,scaleY:1.1,skewX:32,skewY:20.6,x:138.7,y:169.3},0).wait(1).to({scaleX:1.09,scaleY:1.09,skewX:32.9,skewY:21.2,x:138.6,y:171.6},0).wait(1).to({scaleX:1.08,scaleY:1.08,skewX:33.7,skewY:21.7,x:138.5,y:173.9},0).wait(1).to({scaleX:1.07,scaleY:1.07,skewX:34.6,skewY:22.3,x:138.4,y:176.1},0).wait(1).to({scaleX:1.06,scaleY:1.06,skewX:35.4,skewY:22.8,x:138.3,y:178.3},0).wait(1).to({scaleX:1.05,scaleY:1.05,skewX:36.2,skewY:23.4,x:138.2,y:180.4},0).wait(1).to({scaleX:1.04,scaleY:1.04,skewX:37,skewY:23.9,x:138.1,y:182.5},0).wait(1).to({scaleX:1.03,scaleY:1.03,skewX:37.8,skewY:24.4,x:138,y:184.5},0).wait(1).to({scaleX:1.02,scaleY:1.02,skewX:38.6,skewY:24.9,x:137.9,y:186.5},0).wait(1).to({scaleX:1.01,scaleY:1.01,skewX:39.4,skewY:25.4,x:137.8,y:188.5},0).wait(1).to({scaleX:1,scaleY:1,skewX:40.2,skewY:25.9,x:137.7,y:190.5},0).wait(1).to({scaleX:.99,scaleY:.99,skewX:40.9,skewY:26.4,x:137.6,y:192.5},0).wait(1).to({scaleX:.98,scaleY:.98,skewX:41.7,skewY:26.9,x:137.5,y:194.5},0).wait(1).to({scaleX:.97,scaleY:.97,skewX:42.4,skewY:27.3,x:137.4,y:196.4},0).wait(1).to({scaleX:.96,scaleY:.96,skewX:43.2,skewY:27.8,x:137.3,y:198.4},0).wait(1).to({scaleX:.95,scaleY:.95,skewX:43.9,skewY:28.3,x:137.2,y:200.3},0).wait(1).to({scaleX:.94,scaleY:.94,skewX:44.7,skewY:28.8,y:202.3},0).wait(1).to({scaleX:.94,scaleY:.94,skewX:45.5,skewY:29.3,x:137.1,y:204.3},0).wait(1).to({scaleX:.93,scaleY:.93,skewX:46.2,skewY:29.8,x:137,y:206.3},0).wait(1).to({scaleX:.92,scaleY:.92,skewX:47,skewY:30.3,x:136.9,y:208.4},0).wait(1).to({scaleX:.91,scaleY:.91,skewX:47.8,skewY:30.8,x:136.8,y:210.5},0).wait(1).to({scaleX:.9,scaleY:.9,skewX:48.6,skewY:31.4,x:136.7,y:212.5},0).wait(1).to({scaleX:.89,scaleY:.89,skewX:49.5,skewY:31.9,x:136.6,y:214.7},0).wait(1).to({scaleX:.87,scaleY:.87,skewX:50.3,skewY:32.4,x:136.5,y:216.9},0).wait(1).to({scaleX:.86,scaleY:.86,skewX:51.2,skewY:33,x:136.3,y:219.2},0).wait(1).to({scaleX:.85,scaleY:.85,skewX:52.1,skewY:33.6,y:221.5},0).wait(1).to({scaleX:.84,scaleY:.84,skewX:53,skewY:34.2,x:136.2,y:223.9},0).wait(1).to({scaleX:.83,scaleY:.83,skewX:54,skewY:34.8,x:136,y:226.3},0).wait(1).to({scaleX:.82,scaleY:.82,skewX:54.9,skewY:35.4,x:135.9,y:228.9},0).wait(1).to({regX:35,regY:34.9,scaleX:.81,scaleY:.81,skewX:55.9,skewY:36.1,x:135.8,y:231.6},0).to({regY:35,scaleY:.8,skewY:33,x:135.7,y:229.7},3).to({regY:34.9,scaleY:.81,skewY:36.1,x:135.8,y:231.6},6).wait(8)),this.FlashAICB_colour__Path_=new e.panelgreen,this.FlashAICB_colour__Path_.setTransform(163.3,162.2,1.5,1.5,0,0,0,33.4,43.2),this.FlashAICB_colour__Path_.alpha=.898,this.FlashAICB_colour__Path_.shadow=new n.Shadow("rgba(0,0,0,1)",0,0,0),this.timeline.addTween(n.Tween.get(this.FlashAICB_colour__Path_).wait(24).to({regY:43.3,scaleX:1.51,scaleY:1.51,skewX:5,skewY:.7,x:161.8,y:168.1},0).wait(1).to({scaleX:1.52,scaleY:1.53,skewX:9.6,skewY:1.3,x:160.4,y:173.4},0).wait(1).to({scaleX:1.54,scaleY:1.54,skewX:13.8,skewY:1.9,x:159.1,y:178.4},0).wait(1).to({scaleX:1.55,scaleY:1.55,skewX:17.7,skewY:2.4,x:157.9,y:183},0).wait(1).to({scaleX:1.55,scaleY:1.56,skewX:21.4,skewY:2.9,x:156.9,y:187.3},0).wait(1).to({scaleX:1.56,scaleY:1.57,skewX:24.8,skewY:3.4,x:155.8,y:191.2},0).wait(1).to({scaleX:1.57,scaleY:1.57,skewX:27.9,skewY:3.8,x:154.9,y:194.8},0).wait(1).to({scaleX:1.58,scaleY:1.58,skewX:30.8,skewY:4.2,x:154,y:198.3},0).wait(1).to({scaleX:1.59,scaleY:1.59,skewX:33.6,skewY:4.6,x:153.2,y:201.5},0).wait(1).to({scaleX:1.59,scaleY:1.6,skewX:36.2,skewY:4.9,x:152.4,y:204.5},0).wait(1).to({scaleX:1.6,scaleY:1.6,skewX:38.6,skewY:5.2,x:151.7,y:207.4},0).wait(1).to({scaleX:1.6,scaleY:1.61,skewX:40.9,skewY:5.5,x:150.9,y:210},0).wait(1).to({scaleX:1.61,scaleY:1.61,skewX:43,skewY:5.8,x:150.4,y:212.5},0).wait(1).to({scaleX:1.62,scaleY:1.62,skewX:45.1,skewY:6.1,x:149.7,y:214.9},0).wait(1).to({scaleX:1.62,scaleY:1.62,skewX:47,skewY:6.4,x:149.1,y:217.1},0).wait(1).to({scaleX:1.62,scaleY:1.63,skewX:48.8,skewY:6.6,x:148.6,y:219.3},0).wait(1).to({scaleX:1.63,scaleY:1.63,skewX:50.6,skewY:6.9,x:148,y:221.3},0).wait(1).to({scaleX:1.63,scaleY:1.64,skewX:52.3,skewY:7.1,x:147.6,y:223.3},0).wait(1).to({scaleX:1.64,scaleY:1.64,skewX:54,skewY:7.3,x:147,y:225.3},0).wait(1).to({scaleX:1.64,scaleY:1.65,skewX:55.6,skewY:7.5,x:146.5,y:227.1},0).wait(1).to({scaleX:1.65,scaleY:1.65,skewX:57.1,skewY:7.8,x:146.1,y:228.9},0).wait(1).to({scaleX:1.65,scaleY:1.65,skewX:58.7,skewY:8,x:145.6,y:230.8},0).wait(1).to({scaleX:1.65,scaleY:1.66,skewX:60.2,skewY:8.2,x:145.2,y:232.5},0).wait(1).to({scaleX:1.66,scaleY:1.66,skewX:61.7,skewY:8.4,x:144.7,y:234.3},0).wait(1).to({scaleX:1.66,scaleY:1.67,skewX:63.3,skewY:8.6,x:144.2,y:236.1},0).wait(1).to({scaleX:1.67,scaleY:1.67,skewX:64.8,skewY:8.8,x:143.8,y:237.9},0).wait(1).to({scaleX:1.67,scaleY:1.68,skewX:66.4,skewY:9,x:143.3,y:239.7},0).wait(1).to({scaleX:1.67,scaleY:1.68,skewX:68,skewY:9.2,x:142.8,y:241.6},0).wait(1).to({scaleX:1.68,scaleY:1.68,skewX:69.6,skewY:9.5,x:142.3,y:243.5},0).wait(1).to({scaleX:1.68,scaleY:1.69,skewX:71.3,skewY:9.7,x:141.8,y:245.5},0).wait(1).to({scaleX:1.69,scaleY:1.69,skewX:73.1,skewY:9.9,x:141.3,y:247.6},0).wait(1).to({scaleX:1.69,scaleY:1.7,skewX:74.9,skewY:10.2,x:140.7,y:249.7},0).wait(1).to({scaleX:1.7,scaleY:1.7,skewX:76.8,skewY:10.4,x:140.2,y:251.9},0).wait(1).to({scaleX:1.7,scaleY:1.71,skewX:78.9,skewY:10.7,x:139.5,y:254.3},0).wait(1).to({regX:33.3,regY:43.1,scaleX:1.71,scaleY:1.71,skewX:81,skewY:11,x:138.9,y:256.8},0).to({regX:33.2,scaleX:1.71,skewX:83,x:138.7,y:254.3},7).to({regX:33.3,scaleX:1.71,skewX:81,x:138.9,y:256.8},9).wait(12)),this.FlashAICB_colour__Path__1=new e.panelmagenta,this.FlashAICB_colour__Path__1.setTransform(255.2,199.1,1.5,1.5,0,0,0,34.6,34.6),this.FlashAICB_colour__Path__1.alpha=.898,this.FlashAICB_colour__Path__1.shadow=new n.Shadow("rgba(0,0,0,1)",0,0,0),this.timeline.addTween(n.Tween.get(this.FlashAICB_colour__Path__1).wait(18).to({scaleX:1.5,scaleY:1.5,skewX:2.6,skewY:1.5,x:257.2,y:202.3},0).wait(1).to({scaleX:1.5,skewX:5,skewY:2.9,x:259.1,y:205.3},0).wait(1).to({scaleX:1.5,scaleY:1.5,skewX:7.2,skewY:4.3,x:260.9,y:208.1},0).wait(1).to({scaleX:1.5,scaleY:1.5,skewX:9.3,skewY:5.5,x:262.6,y:210.9},0).wait(1).to({skewX:11.3,skewY:6.7,x:264.2,y:213.4},0).wait(1).to({scaleX:1.51,scaleY:1.5,skewX:13.2,skewY:7.8,x:265.7,y:215.7},0).wait(1).to({scaleX:1.51,skewX:15,skewY:8.9,x:267.2,y:218},0).wait(1).to({scaleX:1.51,skewX:16.7,skewY:9.9,x:268.5,y:220.1},0).wait(1).to({scaleY:1.5,skewX:18.3,skewY:10.8,x:269.8,y:222.1},0).wait(1).to({scaleX:1.51,skewX:19.8,skewY:11.7,x:271,y:224.1},0).wait(1).to({scaleX:1.51,scaleY:1.49,skewX:21.3,skewY:12.6,x:272.1,y:225.9},0).wait(1).to({skewX:22.7,skewY:13.4,x:273.2,y:227.7},0).wait(1).to({scaleX:1.51,skewX:24,skewY:14.2,x:274.3,y:229.3},0).wait(1).to({scaleY:1.49,skewX:25.3,skewY:14.9,x:275.3,y:230.9},0).wait(1).to({scaleX:1.51,skewX:26.5,skewY:15.6,x:276.3,y:232.5},0).wait(1).to({skewX:27.7,skewY:16.3,x:277.2,y:233.9},0).wait(1).to({scaleX:1.51,skewX:28.8,skewY:17,x:278.1,y:235.4},0).wait(1).to({scaleY:1.49,skewX:29.9,skewY:17.6,x:278.9,y:236.7},0).wait(1).to({skewX:30.9,skewY:18.3,x:279.8,y:238.1},0).wait(1).to({scaleX:1.51,skewX:32,skewY:18.9,x:280.7,y:239.3},0).wait(1).to({scaleY:1.49,skewX:32.9,skewY:19.4,x:281.4,y:240.5},0).wait(1).to({scaleX:1.51,skewX:33.9,skewY:20,x:282.1,y:241.7},0).wait(1).to({skewX:34.8,skewY:20.6,x:282.9,y:243},0).wait(1).to({skewX:35.8,skewY:21.1,x:283.6,y:244.1},0).wait(1).to({scaleX:1.52,skewX:36.7,skewY:21.6,x:284.3,y:245.2},0).wait(1).to({scaleY:1.49,skewX:37.5,skewY:22.1,x:285.1,y:246.3},0).wait(1).to({skewX:38.4,skewY:22.7,x:285.7,y:247.4},0).wait(1).to({scaleX:1.52,skewX:39.3,skewY:23.2,x:286.4,y:248.5},0).wait(1).to({skewX:40.1,skewY:23.7,x:287.1,y:249.5},0).wait(1).to({scaleX:1.52,scaleY:1.49,skewX:41,skewY:24.2,x:287.8,y:250.6},0).wait(1).to({skewX:41.8,skewY:24.7,x:288.4,y:251.7},0).wait(1).to({skewX:42.6,skewY:25.2,x:289.1,y:252.7},0).wait(1).to({
scaleX:1.52,skewX:43.5,skewY:25.7,x:289.8,y:253.8},0).wait(1).to({skewX:44.3,skewY:26.2,x:290.5,y:254.9},0).wait(1).to({scaleY:1.49,skewX:45.2,skewY:26.7,x:291.1,y:256},0).wait(1).to({scaleX:1.52,skewX:46.1,skewY:27.2,x:291.8,y:257.1},0).wait(1).to({skewX:46.9,skewY:27.7,x:292.6,y:258.1},0).wait(1).to({skewX:47.8,skewY:28.2,x:293.2,y:259.3},0).wait(1).to({scaleX:1.52,scaleY:1.49,skewX:48.8,skewY:28.8,x:294,y:260.5},0).wait(1).to({skewX:49.7,skewY:29.3,x:294.7,y:261.6},0).wait(1).to({skewX:50.7,skewY:29.9,x:295.5,y:262.8},0).wait(1).to({scaleX:1.52,skewX:51.6,skewY:30.5,x:296.3,y:264.1},0).wait(1).to({scaleY:1.49,skewX:52.7,skewY:31.1,x:297.1,y:265.4},0).wait(1).to({scaleX:1.52,skewX:53.7,skewY:31.7,x:297.9,y:266.7},0).wait(1).to({skewX:54.8,skewY:32.3,x:298.8,y:268.1},0).wait(1).to({regY:34.9,scaleX:1.52,skewX:55.9,skewY:33,x:299.7,y:269.6},0).to({scaleY:1.48,skewY:34,x:299.6,y:267.7},3).to({scaleY:1.49,skewY:33,x:299.7,y:269.6},7).wait(13)),this.FlashAICB_colour__Path__2=new e.panelblue,this.FlashAICB_colour__Path__2.setTransform(241,84.5,1.5,1.5,0,0,0,43.2,33.5),this.FlashAICB_colour__Path__2.alpha=.898,this.FlashAICB_colour__Path__2.shadow=new n.Shadow("rgba(0,0,0,1)",0,0,0),this.timeline.addTween(n.Tween.get(this.FlashAICB_colour__Path__2).wait(21).to({regX:43.3,regY:33.4,scaleX:1.51,scaleY:1.51,skewX:3.2,skewY:.3,x:241.4,y:91},0).wait(1).to({scaleX:1.52,scaleY:1.52,skewX:6.3,skewY:.6,x:241.6,y:97.3},0).wait(1).to({scaleX:1.53,scaleY:1.53,skewX:9.2,skewY:.8,x:241.9,y:103.4},0).wait(1).to({scaleX:1.54,scaleY:1.54,skewX:12,skewY:1.1,x:242,y:109.1},0).wait(1).to({scaleX:1.55,scaleY:1.55,skewX:14.6,skewY:1.3,x:242.2,y:114.6},0).wait(1).to({scaleX:1.55,scaleY:1.55,skewX:17.2,skewY:1.5,x:242.4,y:119.8},0).wait(1).to({scaleX:1.56,scaleY:1.56,skewX:19.6,skewY:1.7,x:242.6,y:124.8},0).wait(1).to({scaleX:1.57,scaleY:1.57,skewX:21.9,skewY:1.9,x:242.8,y:129.6},0).wait(1).to({scaleX:1.58,scaleY:1.58,skewX:24.1,skewY:2.1,x:243,y:134.1},0).wait(1).to({scaleX:1.58,scaleY:1.58,skewX:26.2,skewY:2.3,x:243.1,y:138.5},0).wait(1).to({scaleX:1.59,scaleY:1.59,skewX:28.2,skewY:2.5,x:243.2,y:142.7},0).wait(1).to({scaleX:1.6,scaleY:1.59,skewX:30.2,skewY:2.7,x:243.4,y:146.7},0).wait(1).to({scaleX:1.6,scaleY:1.6,skewX:32,skewY:2.8,x:243.5,y:150.5},0).wait(1).to({scaleX:1.61,scaleY:1.61,skewX:33.8,skewY:3,x:243.7,y:154.2},0).wait(1).to({scaleX:1.61,scaleY:1.61,skewX:35.5,skewY:3.1,x:243.8,y:157.7},0).wait(1).to({scaleX:1.62,scaleY:1.62,skewX:37.2,skewY:3.3,x:244,y:161.1},0).wait(1).to({scaleX:1.62,scaleY:1.62,skewX:38.8,skewY:3.4,x:244.1,y:164.4},0).wait(1).to({scaleX:1.63,scaleY:1.63,skewX:40.3,skewY:3.6,x:244.2,y:167.6},0).wait(1).to({scaleX:1.63,scaleY:1.63,skewX:41.8,skewY:3.7,x:244.3,y:170.6},0).wait(1).to({scaleX:1.64,scaleY:1.64,skewX:43.2,skewY:3.8,x:244.4,y:173.6},0).wait(1).to({scaleX:1.64,scaleY:1.64,skewX:44.6,skewY:4,x:244.5,y:176.4},0).wait(1).to({scaleX:1.64,scaleY:1.64,skewX:45.9,skewY:4.1,x:244.6,y:179.2},0).wait(1).to({scaleX:1.65,scaleY:1.65,skewX:47.2,skewY:4.2,x:244.7,y:181.9},0).wait(1).to({scaleX:1.65,scaleY:1.65,skewX:48.5,skewY:4.3,x:244.8,y:184.5},0).wait(1).to({scaleX:1.66,scaleY:1.66,skewX:49.7,skewY:4.4,x:244.9,y:187.1},0).wait(1).to({scaleX:1.66,scaleY:1.66,skewX:51,skewY:4.5,x:245,y:189.6},0).wait(1).to({scaleX:1.66,scaleY:1.66,skewX:52.2,skewY:4.6,x:245.1,y:192.1},0).wait(1).to({scaleX:1.67,scaleY:1.67,skewX:53.3,skewY:4.7,y:194.5},0).wait(1).to({scaleX:1.67,scaleY:1.67,skewX:54.5,skewY:4.8,x:245.2,y:196.9},0).wait(1).to({scaleX:1.68,scaleY:1.67,skewX:55.6,skewY:4.9,x:245.3,y:199.2},0).wait(1).to({scaleX:1.68,scaleY:1.68,skewX:56.8,skewY:5,x:245.4,y:201.5},0).wait(1).to({scaleX:1.68,scaleY:1.68,skewX:57.9,skewY:5.1,x:245.5,y:203.9},0).wait(1).to({scaleX:1.69,scaleY:1.68,skewX:59,skewY:5.2,x:245.6,y:206.2},0).wait(1).to({scaleX:1.69,scaleY:1.69,skewX:60.1,skewY:5.3,x:245.7,y:208.5},0).wait(1).to({scaleX:1.69,scaleY:1.69,skewX:61.2,skewY:5.4,y:210.9},0).wait(1).to({scaleX:1.7,scaleY:1.69,skewX:62.4,skewY:5.5,x:245.8,y:213.1},0).wait(1).to({scaleX:1.7,scaleY:1.7,skewX:63.5,skewY:5.6,x:245.9,y:215.5},0).wait(1).to({scaleX:1.7,scaleY:1.7,skewX:64.6,skewY:5.7,x:246,y:217.9},0).wait(1).to({scaleX:1.71,scaleY:1.71,skewX:65.8,skewY:5.8,x:246.1,y:220.3},0).wait(1).to({scaleX:1.71,scaleY:1.71,skewX:67,skewY:5.9,y:222.7},0).wait(1).to({scaleX:1.71,scaleY:1.71,skewX:68.2,skewY:6,x:246.2,y:225.2},0).wait(1).to({scaleX:1.72,scaleY:1.72,skewX:69.4,skewY:6.1,x:246.4,y:227.7},0).wait(1).to({scaleX:1.72,scaleY:1.72,skewX:70.7,skewY:6.3,y:230.4},0).wait(1).to({scaleX:1.73,scaleY:1.72,skewX:71.9,skewY:6.4,x:246.6,y:233},0).wait(1).to({scaleX:1.73,scaleY:1.73,skewX:73.3,skewY:6.5,y:235.7},0).wait(1).to({scaleX:1.74,scaleY:1.73,skewX:74.6,skewY:6.6,x:246.7,y:238.6},0).wait(1).to({scaleX:1.74,scaleY:1.74,skewX:76,skewY:6.7,x:246.9,y:241.5},0).wait(1).to({scaleX:1.74,scaleY:1.74,skewX:77.5,skewY:6.9,y:244.5},0).wait(1).to({regX:43.4,scaleX:1.75,scaleY:1.75,skewX:79,skewY:7,x:246.8,y:247.7},0).to({scaleY:1.75,skewX:79.2,skewY:9,y:245.8},3).to({scaleY:1.75,skewX:79,skewY:7,y:247.7},4).wait(10)),this.FlashAICB_colour__Path__3=new e.panelred,this.FlashAICB_colour__Path__3.setTransform(156.8,201.2,1.5,1.5,0,0,0,43.4,33.4),this.FlashAICB_colour__Path__3.alpha=.898,this.FlashAICB_colour__Path__3.shadow=new n.Shadow("rgba(0,0,0,1)",0,0,0),this.timeline.addTween(n.Tween.get(this.FlashAICB_colour__Path__3).wait(18).to({regX:43.3,scaleX:1.49,scaleY:1.49,skewX:-3.9,skewY:-1,x:152.3,y:204.7},0).wait(1).to({scaleX:1.48,scaleY:1.48,skewX:-7.5,skewY:-2,x:148.2,y:208.2},0).wait(1).to({scaleX:1.47,scaleY:1.47,skewX:-10.9,skewY:-3,x:144.3,y:211.4},0).wait(1).to({scaleX:1.46,scaleY:1.46,skewX:-14.2,skewY:-3.8,x:140.6,y:214.4},0).wait(1).to({scaleX:1.45,scaleY:1.45,skewX:-17.2,skewY:-4.7,x:137.3,y:217.3},0).wait(1).to({scaleX:1.44,scaleY:1.44,skewX:-20.1,skewY:-5.4,x:134,y:220},0).wait(1).to({scaleX:1.44,scaleY:1.44,skewX:-22.8,skewY:-6.2,x:130.9,y:222.5},0).wait(1).to({scaleX:1.43,scaleY:1.43,skewX:-25.3,skewY:-6.9,x:128.1,y:224.9},0).wait(1).to({scaleX:1.42,scaleY:1.42,skewX:-27.7,skewY:-7.5,x:125.3,y:227.1},0).wait(1).to({scaleX:1.42,scaleY:1.42,skewX:-30,skewY:-8.1,x:122.8,y:229.3},0).wait(1).to({scaleX:1.41,scaleY:1.41,skewX:-32.1,skewY:-8.7,x:120.4,y:231.2},0).wait(1).to({scaleX:1.4,scaleY:1.4,skewX:-34.1,skewY:-9.3,x:118.1,y:233.1},0).wait(1).to({scaleX:1.4,scaleY:1.4,skewX:-36,skewY:-9.8,x:115.9,y:234.9},0).wait(1).to({scaleX:1.39,scaleY:1.39,skewX:-37.8,skewY:-10.3,x:113.9,y:236.6},0).wait(1).to({scaleX:1.39,scaleY:1.39,skewX:-39.6,skewY:-10.7,x:112,y:238.2},0).wait(1).to({scaleX:1.38,scaleY:1.38,skewX:-41.2,skewY:-11.2,x:110.1,y:239.8},0).wait(1).to({scaleX:1.38,scaleY:1.38,skewX:-42.8,skewY:-11.6,x:108.4,y:241.2},0).wait(1).to({scaleX:1.38,scaleY:1.38,skewX:-44.3,skewY:-12,x:106.6,y:242.6},0).wait(1).to({scaleX:1.37,scaleY:1.37,skewX:-45.7,skewY:-12.4,x:105,y:244},0).wait(1).to({scaleX:1.37,scaleY:1.37,skewX:-47.1,skewY:-12.8,x:103.4,y:245.3},0).wait(1).to({scaleX:1.36,scaleY:1.36,skewX:-48.5,skewY:-13.2,x:101.9,y:246.6},0).wait(1).to({scaleX:1.36,scaleY:1.36,skewX:-49.8,skewY:-13.5,x:100.4,y:247.8},0).wait(1).to({scaleX:1.36,scaleY:1.36,skewX:-51.1,skewY:-13.9,x:99,y:249},0).wait(1).to({scaleX:1.35,scaleY:1.35,skewX:-52.4,skewY:-14.2,x:97.5,y:250.2},0).wait(1).to({scaleX:1.35,scaleY:1.35,skewX:-53.7,skewY:-14.6,x:96,y:251.4},0).wait(1).to({scaleX:1.34,scaleY:1.34,skewX:-55,skewY:-14.9,x:94.6,y:252.7},0).wait(1).to({scaleX:1.34,scaleY:1.34,skewX:-56.3,skewY:-15.3,x:93.1,y:253.9},0).wait(1).to({scaleX:1.34,scaleY:1.34,skewX:-57.6,skewY:-15.6,x:91.6,y:255.1},0).wait(1).to({scaleX:1.33,scaleY:1.33,skewX:-59,skewY:-16,x:90.1,y:256.4},0).wait(1).to({scaleX:1.33,scaleY:1.33,skewX:-60.4,skewY:-16.4,x:88.5,y:257.7},0).wait(1).to({scaleX:1.33,scaleY:1.33,skewX:-61.8,skewY:-16.8,x:86.9,y:259.1},0).wait(1).to({scaleX:1.32,scaleY:1.32,skewX:-63.3,skewY:-17.2,x:85.2,y:260.4},0).wait(1).to({scaleX:1.32,scaleY:1.32,skewX:-64.9,skewY:-17.6,x:83.5,y:261.9},0).wait(1).to({scaleX:1.31,scaleY:1.31,skewX:-66.5,skewY:-18,x:81.6,y:263.5},0).wait(1).to({scaleX:1.31,scaleY:1.31,skewX:-68.2,skewY:-18.5,x:79.7,y:265.1},0).wait(1).to({regX:42.9,regY:33.5,scaleX:1.3,scaleY:1.3,skewX:-70,skewY:-19,x:77.7,y:266.7},0).to({scaleX:1.3,scaleY:1.3,skewY:-14,y:260.5},3).to({scaleX:1.3,scaleY:1.3,skewY:-19,y:266.7},11).wait(19)),this.FlashAICB_colour__Path__4=new e.panelorange,this.FlashAICB_colour__Path__4.setTransform(234.5,123.2,1.5,1.5,0,0,0,33.4,43.3),this.FlashAICB_colour__Path__4.alpha=.898,this.FlashAICB_colour__Path__4.shadow=new n.Shadow("rgba(0,0,0,1)",0,0,0),this.timeline.addTween(n.Tween.get(this.FlashAICB_colour__Path__4).wait(23).to({scaleX:1.52,scaleY:1.52,skewX:5,skewY:.3,x:234.7,y:131.6},0).wait(1).to({scaleX:1.54,scaleY:1.54,skewX:9.6,skewY:.7,x:235,y:139.4},0).wait(1).to({scaleX:1.56,scaleY:1.56,skewX:13.9,skewY:1,x:235.2,y:146.8},0).wait(1).to({scaleX:1.58,scaleY:1.58,skewX:17.9,skewY:1.3,x:235.4,y:153.6},0).wait(1).to({scaleX:1.59,scaleY:1.59,skewX:21.7,skewY:1.5,x:235.6,y:160},0).wait(1).to({scaleX:1.61,scaleY:1.61,skewX:25.2,skewY:1.8,x:235.8,y:165.9},0).wait(1).to({scaleX:1.62,scaleY:1.62,skewX:28.5,skewY:2,x:235.9,y:171.6},0).wait(1).to({scaleX:1.63,scaleY:1.63,skewX:31.6,skewY:2.2,x:236,y:176.7},0).wait(1).to({scaleX:1.65,scaleY:1.65,skewX:34.5,skewY:2.4,x:236.2,y:181.7},0).wait(1).to({scaleX:1.66,scaleY:1.66,skewX:37.2,skewY:2.6,x:236.3,y:186.3},0).wait(1).to({scaleX:1.67,scaleY:1.67,skewX:39.8,skewY:2.8,x:236.5,y:190.7},0).wait(1).to({scaleX:1.68,scaleY:1.68,skewX:42.2,skewY:3,x:236.6,y:194.8},0).wait(1).to({scaleX:1.69,scaleY:1.69,skewX:44.5,skewY:3.1,x:236.7,y:198.7},0).wait(1).to({scaleX:1.7,scaleY:1.7,skewX:46.7,skewY:3.3,x:236.8,y:202.4},0).wait(1).to({scaleX:1.71,scaleY:1.71,skewX:48.7,skewY:3.4,x:236.9,y:205.9},0).wait(1).to({scaleX:1.72,scaleY:1.72,skewX:50.7,skewY:3.6,x:237,y:209.3},0).wait(1).to({scaleX:1.72,scaleY:1.72,skewX:52.6,skewY:3.7,x:237.1,y:212.6},0).wait(1).to({scaleX:1.73,scaleY:1.73,skewX:54.5,skewY:3.8,x:237.2,y:215.6},0).wait(1).to({scaleX:1.74,scaleY:1.74,skewX:56.2,skewY:4,x:237.3,y:218.7},0).wait(1).to({scaleX:1.75,scaleY:1.75,skewX:58,skewY:4.1,x:237.4,y:221.6},0).wait(1).to({scaleX:1.75,scaleY:1.75,skewX:59.6,skewY:4.2,x:237.5,y:224.4},0).wait(1).to({scaleX:1.76,scaleY:1.76,skewX:61.3,skewY:4.3,y:227.3},0).wait(1).to({scaleX:1.77,scaleY:1.77,skewX:62.9,skewY:4.4,x:237.6,y:230},0).wait(1).to({scaleX:1.77,scaleY:1.77,skewX:64.6,skewY:4.6,x:237.7,y:232.8},0).wait(1).to({scaleX:1.78,scaleY:1.78,skewX:66.2,skewY:4.7,x:237.8,y:235.6},0).wait(1).to({scaleX:1.79,scaleY:1.79,skewX:67.8,skewY:4.8,x:237.9,y:238.4},0).wait(1).to({scaleX:1.79,scaleY:1.79,skewX:69.5,skewY:4.9,y:241.3},0).wait(1).to({scaleX:1.8,scaleY:1.8,skewX:71.2,skewY:5,x:238.1,y:244.1},0).wait(1).to({scaleX:1.81,scaleY:1.81,skewX:73,skewY:5.2,x:238.2,y:247.1},0).wait(1).to({scaleX:1.82,scaleY:1.82,skewX:74.8,skewY:5.3,y:250.2},0).wait(1).to({scaleX:1.83,scaleY:1.83,skewX:76.6,skewY:5.4,x:238.3,y:253.3},0).wait(1).to({scaleX:1.83,scaleY:1.83,skewX:78.6,skewY:5.5,x:238.4,y:256.6},0).wait(1).to({scaleX:1.84,scaleY:1.84,skewX:80.6,skewY:5.7,x:238.5,y:260.1},0).wait(1).to({scaleX:1.85,scaleY:1.85,skewX:82.8,skewY:5.8,x:238.6,y:263.7},0).wait(1).to({regX:32.9,regY:42.6,scaleX:1.86,scaleY:1.86,skewX:85,skewY:6,x:238.8,y:267.5},0).to({scaleX:1.86,skewX:81,skewY:5.8,x:238.9,y:265.7},4).to({scaleX:1.86,skewX:85,skewY:6,x:238.8,y:267.5},6).wait(19))}).prototype=r=new n.MovieClip,r.nominalBounds=new n.Rectangle(289.7,183.3,222.6,223)}function r(e){i(e=e||{},{},createjs,{}),canvas=document.getElementById("canvas"),exportRoot=new e.CollapsedLogoErrorAnimation,stage=new createjs.Stage(canvas),stage.addChild(exportRoot),stage.update(),createjs.Ticker.setFPS(e.properties.fps),createjs.Ticker.addEventListener("tick",stage)}t.exports={start:r}},{}],131:[function(e,t,n){function i(){return function(e){return e.journal.toLowerCase().split(" ").concat(e.doi).join(", ")}}angular.module("reader").filter("articleKeywords",i)},{}],132:[function(e,t,n){function i(){return function(e){return _.map(e,function(e){return e.short_name||e.name})}}angular.module("reader").filter("authorShortName",i)},{}],133:[function(e,t,n){function i(){return function(e){return(e||"").replace(/(?:\r?\n|\r)+/g," ")}}angular.module("reader").filter("breaksToSpaces",i)},{}],134:[function(e,t,n){function i(e){return e=e.replace(/^([\s\:\.])+/g,""),e=e.replace(/([\s\:])+$/g,"")}function r(e){return function(t){var n=t.indexOf(":");return-1==n?e.trustAsHtml(t):e.trustAsHtml(sprintf("<b>%s | </b>%s",i(t.substr(0,n)),i(t.substr(n+1))))}}function o(e){return function(t){var n=t.indexOf(":");return-1==n?e.trustAsHtml(t):e.trustAsHtml(i(t.substr(0,n)))}}function s(e){return function(t){var n=t.indexOf(":"),r=t.search(/(?:\S)\.(?=\s)/i);return-1==n?"":(-1==r&&(r=t.length),e.trustAsHtml(i(t.substring(n+1,r+2))))}}function a(e){return function(t){var n=t.indexOf(":"),r=t.search(/(?:\S)\.(?=\s)/i);return-1==n||-1==r?"":e.trustAsHtml(i(t.substr(r+2)))}}r.$inject=["$sce"],o.$inject=["$sce"],s.$inject=["$sce"],a.$inject=["$sce"],angular.module("reader").filter("figureCaption",r),angular.module("reader").filter("figureCaptionLabel",o),angular.module("reader").filter("figureCaptionTitle",s),angular.module("reader").filter("figureCaptionText",a)},{}],135:[function(e,t,n){function i(){return function(e,t){return moment(e).format(t)}}function r(){return function(e){return moment(e).calendar()}}angular.module("reader").filter("formatDate",i),angular.module("reader").filter("calendarDate",r)},{}],136:[function(e,t,n){function i(){return function(e,t){return(e||[]).join(t||"")}}angular.module("reader").filter("join",i)},{}],137:[function(e,t,n){function i(){return function(e){return isNaN(e=parseInt(e,10))?void 0:1e3>e?e:(e/1e3|0)+"k"}}angular.module("reader").filter("kilo",i)},{}],138:[function(e,t,n){function i(e){return function(t){return t=t.replace(/<(http[^>]+)>/g,function(e,t){return t}),t=t.replace(/(http|ftp|https):\/\/[\w-]+(\.[\w-]+)+([\w.,@?^=%&amp;:\/~+#-]*[\w@?^=%&amp;\/~+#-])?/g,function(e){return'<a href="'+e+'" target="_blank"> '+e+" </a>"}),e.trustAsHtml(t)}}i.$inject=["$sce"],angular.module("reader").filter("linkify",i)},{}],139:[function(e,t,n){function i(){return function(e){return e.journal&&e.year?e.journal+", "+e.year:e.journal||e.year}}angular.module("reader").filter("refPublishInfo",i)},{}],140:[function(e,t,n){function i(e,t){if(e=(0|e).toString(),e.length<t)for(var n=e.length;t>n;n++)e="0"+e;return e}function r(){return function(e){var t=moment.duration(e);return sprintf("%s:%s:%s",i(t.asHours(),2),i(t.minutes(),2),i(t.seconds(),2))}}angular.module("reader").filter("rentalDuration",r)},{}],141:[function(e,t,n){function i(e){return function(t){return e.trustAsResourceUrl(t)}}i.$inject=["$sce"],angular.module("reader").filter("trustUrl",i)},{}],142:[function(e,t,n){function i(e,t,n,i,r,o,s){function a(t,n){var r={targetEvent:t,clickOutsideToClose:!0,locals:{action:n}};i.isShared()?e.show(e.alert(angular.merge(r,{templateUrl:"dialogs/complimentary_access.html",controller:"ComplimentaryCtrl"}))):e.show(e.alert(angular.merge(r,{templateUrl:"dialogs/action_unavailable.html",controller:"UnavailableCtrl"})))}function c(t){e.show(e.alert({targetEvent:t,clickOutsideToClose:!0,templateUrl:"dialogs/print_options.html",controller:"PrintCtrl"}))}function l(e,t){i.onceAccessChecked(function(){i.isPersonal()||i.get()[e+"_url"]?t():r.onExternalCheck(t)})}function u(e){return t.post(n.services+"/reader/pdf",e)}function d(){var e=i.get().location,t=i.get().pdf_url,n=s.listArr();return n.length||/^china$/i.test(e.country||"")?u({url:t,annotations:n}).then(function(e){location.href=e.data.redirect},function(){location.href=t}):(location.href=t,Promise.resolve())}function p(e){return new Promise(function(t,n){l("pdf",function(){i.get().pdf_url?(o.download(!0),d().then(t,n)):i.hasAccess()?(o.download(!1),a(e,"download"),n("rental")):(o.download(!1),n("preview"))})})}function f(e){return new Promise(function(t,n){l("print",function(){i.get().print_url?(c(e),t()):i.hasAccess()?(a(e,"print"),n("rental")):n("preview")})})}var h={};return h.download=p,h.print=f,h}i.$inject=["$mdDialog","$http","endpoint","article","access","tracker","annotationsModel"],angular.module("reader").factory("articleExport",i)},{}],143:[function(e,t,n){function i(e,t,n,i,r,o,s,a,c,l,u){function d(){return r.local.get("readcube-print-annotations")}function p(t){return e.post(i.services+"/reader/pdf",t)}function f(){var e={print:!0,url:o.get().pdf_url},t=l.listArr();return t.length&&d()&&(e.annotations=t),e}function h(){return new Promise(function(e){y?e():$.getScript(i.scripts.cpgadget,function(){y=new cloudprint.Gadget,e()})})}function g(){return c.saveCloud(),a.item.add()["catch"](_.noop)}function m(){c.print("hd");var e=o.get().location,t=o.get().print_url;return d()||/^china$/i.test(e.country||"")?p(f()).then(function(e){window.open(e.data.redirect,"_blank")},function(){window.open(t,"_blank")}):(window.open(t,"_blank"),Promise.resolve())}function v(){return c.print("cloud"),h().then(function(){y.setPrintDocument("url","",o.get().print_url),y.openPrintDialog()})}function w(){return c.print("mobile"),s.signedIn()?g():new Promise(function(e){u.showRegister({params:{tracking_action:"print_send_to_mobile",tracking_origin:c.trackingOrigin()},onAuth:function(){g().then(e)}})})}var y=null;return{pdf:m,cloud:v,mobile:w}}i.$inject=["$http","util","browser","endpoint","storage","article","user","sync","tracker","annotationsModel","userModal"],angular.module("reader").factory("articlePrint",i)},{}],144:[function(e,t,n){angular.module("reader").factory("access",function(){return e("../core/access")}).factory("annotationsController",function(){return e("../core/annotations/annotations_controller")}).factory("annotationsModel",function(){return e("../core/annotations/annotations_model")}).factory("article",function(){return e("../core/article")}).factory("banner",function(){return e("../core/banner")}).factory("browser",function(){return e("../core/utils/browser")}).factory("citations",function(){return e("../core/citations/citations_model")}).factory("command",function(){return e("../core/command")}).factory("endpoint",function(){return e("../core/endpoint")}).factory("environment",function(){return e("../core/environment")}).factory("exporter",function(){return e("../core/export/exporter")}).factory("popover",function(){return e("../core/elements/popover")}).factory("receiver",function(){return e("../core/receiver")}).factory("Selection",function(){return e("../core/annotations/selection")}).factory("SelectionToolbar",function(){return e("../core/annotations/selection_toolbar")}).factory("storage",function(){return e("../core/utils/storage")}).factory("sync",function(){return e("../core/sync/sync")}).factory("supplement",function(){return e("../core/supplement")}).factory("update",function(){return e("../core/update")}).factory("user",function(){return e("../core/user")}).factory("userStorage",function(){return e("../core/user_storage")}).factory("util",function(){return e("../core/utils/util")}).factory("renderingFixes",function(){return e("../core/rendering_fixes")}).factory("ResolveToolbar",function(){return e("../core/annotations/resolve_toolbar")}).factory("trackId",function(){return e("../core/tracking/track_id")}).factory("tracker",function(){return e("../core/tracking/tracker")}).factory("trackError",function(){return e("../core/tracking/track_error")}).factory("visibility",function(){return e("../core/utils/visibility")}).factory("viewer",function(){return e("../core/viewer/viewer")}).factory("mobileViewer",function(){return e("../core/viewer/mobile_viewer")})},{"../core/access":36,"../core/annotations/annotations_controller":39,"../core/annotations/annotations_model":40,"../core/annotations/resolve_toolbar":42,"../core/annotations/selection":43,"../core/annotations/selection_toolbar":44,"../core/article":45,"../core/banner":46,"../core/citations/citations_model":49,"../core/command":50,"../core/elements/popover":52,"../core/endpoint":53,"../core/environment":54,"../core/export/exporter":56,"../core/receiver":68,"../core/rendering_fixes":69,"../core/supplement":71,"../core/sync/sync":74,"../core/tracking/track_error":77,"../core/tracking/track_id":78,"../core/tracking/tracker":79,"../core/update":80,"../core/user":81,"../core/user_storage":82,"../core/utils/browser":84,"../core/utils/storage":92,"../core/utils/util":96,"../core/utils/visibility":97,"../core/viewer/mobile_viewer":100,"../core/viewer/viewer":102}],145:[function(e,t,n){function i(e,t,n){function i(i){function r(){o&&o.$destroy(),s&&s.remove(),$(document.body).removeClass("figure-open")}var o=angular.merge(n.$new(!0),{index:i,close:r}),s=e(t.get("figure_viewer.html"))(o);s.on("mousedown mouseup click",function(e){e.stopPropagation()}),$(document.body).addClass("figure-open").append(s)}return i}i.$inject=["$compile","$templateCache","$rootScope"],angular.module("reader").factory("figureViewer",i)},{}],146:[function(e,t,n){function i(e,e,t,n){function i(i){return i?n.writeShared().then(function(n){return e.generateSharedAccess({shared_annotations:n,url:s}).then(function(e){return t.shareToken(e.share_token),e})}):new Promise(function(n,i){o?n(o):e.generateSharedAccess({url:s}).then(function(e){t.shareToken(e.share_token),n(o=e)},i)})}var r={},o=null,s=[location.protocol,"//",location.host,location.pathname].join("");return r.generate=i,r}i.$inject=["article","article","tracker","annotationsModel"],angular.module("reader").factory("share",i)},{}],147:[function(e,t,n){function i(e,t,n,i){function r(n){e.includes("error")||t.show(angular.merge({locals:{toastId:++s},position:i?"bottom":"top right",hideDelay:!1},n))}var o={},s=0;return o.hide=function(e){e&&e!=s||t.hide()},o.notifyMessage=function(e){r({templateUrl:"toast/info_message.html",controller:["$scope",function(n){n.message=e,n.close=function(){t.hide()}}]})},o.notifyUpdateAvailable=function(){r({templateUrl:"toast/update_available.html",controller:"UpdateAvailableCtrl"})},o.notifyRentalExpiry=function(){r({templateUrl:"toast/rental_expiry.html",controller:"RentalExpiryCtrl"})},o.notifyReadPersonal=function(){r({templateUrl:"toast/read_personal.html",controller:"ReadPersonalCtrl"})},o.notifyAuthFailed=function(){r({templateUrl:"toast/auth_failed.html",controller:"AuthFailCtrl"})},o.notifySharedAccess=function(){r({templateUrl:"toast/shared_access.html",controller:"SharedAccessCtrl"})},o.notifyAnnotsNotSynced=function(){o.notifyAnnotsNotSynced.shown||(o.notifyAnnotsNotSynced.shown=!0,r({templateUrl:"toast/annots_not_synced.html",controller:"AnnotsNotSyncedCtrl"}))},o.showSyncedAd=function(){n.get("synced-ad-shown")||(n.set("synced-ad-shown",!0),r({templateUrl:"toast/synced_ad.html",controller:"SyncedAdCtrl"}))},o.promptRegister=function(e){r({templateUrl:"toast/prompt_register.html",controller:"PromptRegisterCtrl",locals:{onAuth:e}})},o}i.$inject=["$state","$mdToast","userStorage","MOBILE"],angular.module("reader").factory("toast",i)},{}],148:[function(e,t,n){function i(e,t,n,i){function r(n,i){var r="register"==n?"/user/new":"/session/new";return e.addParams(t.web+r,e.merge(p,i))}function o(e,t){i.show(i.alert({templateUrl:"dialogs/user.html",clickOutsideToClose:!0,targetEvent:t.targetEvent,controller:["$scope","endpoint",function(n,i){n.endpoint=i,n.src=r(e,t.params),t.loginAd&&(n.loginAd=t.loginAd,n.closeAd=function(){n.loginAd=null})}]}))}function s(e){$(n).off("auth.single"),$(n).one("auth.single",function(t,n){e&&e(n)})}function a(e){s(e.onAuth),o("login",e)}function c(e){s(e.onAuth),o("register",e)}function l(){return i.hide()}function u(){$(n).on("auth",l)}var d={},p={parent_url:location.toString(),embed:1,html5:1};return u(),d.showLogin=a,d.showRegister=c,d.hide=l,d}i.$inject=["util","endpoint","user","$mdDialog"],angular.module("reader").factory("userModal",i)},{}],149:[function(e,t,n){function i(e,t,n,i,r,o,s,a){function c(e,t){var n=i.$new(!0);return n.endpoint=s,n.src=l(e,t.params),n.close=h,t.loginAd&&(n.loginAd=t.loginAd,n.closeAd=function(){n.loginAd=null}),n}function l(e,t){var n="register"==e?"/user/new":"/session/new";return o.addParams(s.web+n,o.merge(v,t))}function u(e,i){$("#user-sidenav").remove();var o=n.get("sidenav/mobile_user.html");t(o)(c(e,i)).appendTo(document.body),r("user").open()}function d(e){$(a).off("auth.single"),$(a).one("auth.single",function(t,n){e&&e(n)})}function p(e){d(e.onAuth),u("login",e)}function f(e){d(e.onAuth),u("register",e)}function h(){return r("user").close()}function g(){$(a).on("auth",h)}var m={},v={parent_url:location.toString(),mobile:1,embed:1,html5:1};return g(),m.showLogin=p,m.showRegister=f,m.hide=h,m}i.$inject=["$sce","$compile","$templateCache","$rootScope","$mdSidenav","util","endpoint","user"],angular.module("reader").factory("userSidenav",i)},{}],150:[function(e,t,n){function i(e,t,n,i,r){function o(e){return new Promise(function(e){window.videojs?e():(r.loadCss("//vjs.zencdn.net/5.8.0/video-js.min.css"),$.getScript("//vjs.zencdn.net/5.8.0/video.min.js",e))})}function s(r){o().then(function(){function o(){s&&s.dispose(),c&&c.$destroy(),l&&l.remove(),$(document.body).removeClass("video-open")}var s=null,a="video-"+r.index,c=angular.merge(e.$new(!0),{videoId:a,video:r,close:o}),l=t(n.get("video_player.html"))(c);l.on("mousedown mouseup click",function(e){e.stopPropagation()}),$(document.body).addClass("video-open").append(l),i(function(){s=videojs(a,{width:640,height:480,autoplay:!0})})})}return s}i.$inject=["$rootScope","$compile","$templateCache","$timeout","util"],angular.module("reader").factory("videoPlayer",i)},{}],151:[function(e,t,n){"use strict";t.exports=angular.module("reader").run(["$templateCache",function(e){e.put("article.html",'<viewer class="viewer hw-accel"\n  article-citations\n  article-annotations>\n  <div id="advert-leaderboard" advert-leaderboard></div>\n  <div id="journal-banner"></div>\n</viewer>\n\n<page-info></page-info>\n<viewer-toolbar></viewer-toolbar>\n\n<ng-include src="\'popover/annotations.html\'"></ng-include>\n'),e.put("article_tools.html",'<div class="article-tools" ng-hide="!toolsEnabled()">\n  <md-fab-speed-dial\n    class="md-scale"\n    md-open="isOpen"\n    md-direction="up"\n    ng-mouseenter="setOpen(true)"\n    ng-mouseleave="setOpen(false, 800)">\n    <md-fab-trigger cancel-event="mousedown mouseup click">\n      <md-button\n        ng-click="defaultAction && defaultAction.handler()"\n        class="md-fab hw-accel" ng-class="{\'default-action\': defaultAction}">\n        <md-tooltip ng-if="defaultAction.tooltip" md-direction="left" md-delay="50" md-autohide="false">\n          {{defaultAction.tooltip}}\n        </md-tooltip>\n        <i class="material-icons more">more_vert</i>\n        <i class="material-icons action">{{defaultAction.icon}}</i>\n      </md-button>\n    </md-fab-trigger>\n    <md-fab-actions>\n      <md-button\n        ng-if="::article.get().doi && metadata"\n        ng-click="export($event)"\n        class="md-fab md-raised md-mini export">\n        <md-tooltip md-direction="left" md-visible="tooltipVisible" md-delay="50" md-autohide="false">\n          Export Citation\n        </md-tooltip>\n        <i class="material-icons">file_upload</i>\n      </md-button>\n      <md-button\n        ng-if="::altmetric.score"\n        ng-click="openAltmetric()"\n        class="md-fab md-raised md-mini altmetric">\n        <md-tooltip md-direction="left" md-visible="tooltipVisible" md-delay="50" md-autohide="false">\n          Altmetric ({{::altmetric.score}})\n        </md-tooltip>\n        <div class="altmetric-embed">\n          <img ng-src="{{::altmetric.images.medium}}" width="100px" height="100px">\n        </div>\n      </md-button>\n      <md-button\n        ng-if="::article.get().doi && article.get().meta.url"\n        ng-click="gotoPublisher()"\n        class="md-fab md-raised md-mini goto-publisher">\n        <md-tooltip md-direction="left" md-visible="tooltipVisible" md-delay="50" md-autohide="false">\n          {{::publisherPageLabel || \'Go to article page\'}}\n        </md-tooltip>\n        <i class="material-icons">web</i>\n      </md-button>\n      <md-button\n        ng-if="::article.get().doi && defaultAction.handler != openRelated"\n        ng-click="openRelated()"\n        class="md-fab md-raised md-mini related">\n        <md-tooltip md-direction="left" md-visible="tooltipVisible" md-delay="50" md-autohide="false">\n          Related articles\n        </md-tooltip>\n        <i class="material-icons">layers</i>\n      </md-button>\n      <md-button\n        ng-if="::figures.length"\n        ng-click="openFigures()"\n        class="md-fab md-raised md-mini figures">\n        <md-tooltip md-direction="left" md-visible="tooltipVisible" md-delay="50" md-autohide="false">\n          Figures ({{::figures.length}})\n        </md-tooltip>\n        <i class="material-icons">photo_library</i>\n      </md-button>\n      <md-button\n        ng-if="notesEnabled()"\n        ng-click="toggleAnnots()"\n        class="md-fab md-raised md-mini annotations">\n        <md-tooltip md-direction="left" md-visible="tooltipVisible" md-delay="50" md-autohide="false">\n          Notes <span ng-if="notes.length">({{notes.length}})</span>\n        </md-tooltip>\n        <i class="material-icons">chat</i>\n      </md-button>\n      <md-button\n        ng-if="::article.get().access_share_enabled"\n        ng-click="share($event)"\n        class="md-fab md-raised md-mini share">\n        <md-tooltip md-direction="left" md-visible="tooltipVisible" md-delay="50" md-autohide="false">\n          Share\n        </md-tooltip>\n        <i class="material-icons">share</i>\n      </md-button>\n    </md-fab-actions>\n  </md-fab-speed-dial>\n</div>\n'),e.put("discover.html",'<div class="reader discover-reader article-container">\n  <viewer class="viewer hw-accel"></viewer>\n\n  <div class="bottom unselectable">\n    <a class="publisher-site-link" ng-href="{{::articleUrl}}">\n      View the entire article on\n      <div class="logo"></div>\n      <div class="arrow"></div>\n    </a>\n  </div>\n</div>'),e.put("figure_viewer.html",'<div class="modal-backdrop"></div>\n<div\n  ng-controller="FigureViewerCtrl"\n  ng-class="{\'details-open\': detailsOpen}"\n  class="figure-overlay">\n  <div\n    class="md-whiteframe-z2 figure-details">\n    <h3>{{figure().caption | figureCaptionLabel}}</h3>\n    <md-button class="md-icon-button close" ng-click="toggleDetails()">\n      <i class="material-icons">close</i>\n    </md-button>\n    <div class="blue-divider"></div>\n    <h5>{{figure().caption | figureCaptionTitle}}</h5>\n    <span>{{figure().caption | figureCaptionText}}</span>\n  </div>\n  <div class="figure-content">\n    <div class="header md-whiteframe-1dp">\n      <div class="left">\n        <i\n          class="material-icons header-btn icon-btn"\n          ng-click="close()"\n          md-ink-ripple="#FFF">\n          arrow_back\n        </i>\n      </div>\n      <div class="center">\n        <a\n          class="header-btn download"\n          ng-href="{{figure().download_url}}"\n          md-ink-ripple="#FFF">\n          <i class="material-icons">file_download</i>\n          <span>Download</span>\n        </a>\n      </div>\n      <div class="right">\n        <i\n          class="material-icons show-details header-btn icon-btn"\n          ng-click="toggleDetails()"\n          md-ink-ripple="#FFF">\n          chrome_reader_mode\n        </i>\n      </div>\n    </div>\n    <div class="wrap">\n      <div class="full" ng-class="{busy: busy}" target-click="close()">\n        <div class="nav-arrow prev" ng-if="showNav" ng-click="prev()" md-ink-ripple="#FFF">\n          <div class="icon-container">\n            <i class="material-icons">navigate_before</i>\n          </div>\n        </div>\n        <img ng-src="{{figure().url}}" on-load="busy = false"/>\n        <spinner></spinner>\n        <div class="nav-arrow next" ng-if="showNav" ng-click="next()" md-ink-ripple="#FFF">\n          <div class="icon-container">\n            <i class="material-icons">navigate_next</i>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n</div>'),e.put("library.html",'<div class="reader personal" read-mode="distraction-free">\n\n  <div class="content article-container">\n    <article></article>\n    <article-tools></article-tools>\n    <div\n      class="prev-article"\n      ng-if="::goPrev"\n      ng-click="goPrev()">\n      <i class="material-icons">arrow_back</i>\n    </div>\n    <div\n      class="next-article"\n      ng-if="::goNext"\n      ng-click="goNext()">\n      <i class="material-icons">arrow_forward</i>\n    </div>\n  </div>\n\n  <ng-include src="\'menu_bar.html\'"></ng-include>\n\n  <ng-include src="\'sidenav/supplements.html\'"></ng-include>\n  <ng-include src="\'sidenav/references.html\'"></ng-include>\n  <ng-include src="\'sidenav/annotations.html\'"></ng-include>\n  <ng-include src="\'sidenav/cited_by.html\'"></ng-include>\n  <ng-include src="\'sidenav/figures.html\'"></ng-include>\n  <ng-include src="\'sidenav/related.html\'"></ng-include>\n  <ng-include src="\'sidenav/appnav.html\'"></ng-include>\n</div>\n\n<ng-include class="print-notice" src="\'print_notice.html\'"></ng-include>\n'),e.put("menu_bar.html",'<div\n  ng-controller="MenuBarCtrl"\n  class="menu-bar article-menu md-whiteframe-1dp"\n  ng-class="{\'signed-in\': user.signedIn(), \'contracted\': contracted}" responsive>\n  <div class="left">\n    <div\n      class="rc-menu"\n      ng-click="onAppMenuClick($event)"\n      md-ink-ripple="#FFF">\n      <i class="material-icons app-menu">menu</i>\n      <div class="rc-logo"></div>\n      <span class="rc-text">\n        {{user.signedIn() ? \'My Library\' : \'Sign In\'}}\n      </span>\n    </div>\n  </div>\n  <div class="center">\n    <div\n      class="menu-btn download sticky"\n      ng-class="{busy: downloading}"\n      ng-click="downloadPdf($event)">\n      <div class="inner" md-ink-ripple="#FFF">\n        <div class="icon-container">\n          <div class="spinner-container">\n            <spinner></spinner>\n          </div>\n          <i class="material-icons">file_download</i>\n        </div>\n        <span>Download PDF</span>\n      </div>\n      <md-tooltip ng-if="contracted" md-direction="bottom" md-autohide="true">\n        Download PDF\n      </md-tooltip>\n    </div>\n    <div\n      ng-if="::article.get().sync_enabled"\n      class="menu-btn add-to-library sticky"\n      ng-class="{busy: syncing, added: inLibrary}"\n      ng-click="toggleInLibrary($event)"\n      md-ink-ripple="#FFF">\n      <div class="icon-container">\n        <div class="spinner-container">\n          <spinner></spinner>\n        </div>\n        <i class="material-icons upload">cloud_upload</i>\n        <i class="material-icons in-cloud">cloud</i>\n        <i class="material-icons remove">cloud_off</i>\n      </div>\n      <span class="upload">Add To Library</span>\n      <span class="in-cloud">In Library</span>\n      <span class="remove">Remove</span>\n      <md-tooltip ng-if="contracted" md-direction="bottom" md-autohide="true">\n        {{inLibrary ? \'Remove From Library\' : \'Add To Library\'}}\n      </md-tooltip>\n    </div>\n    <div\n      ng-if="::supplements.length"\n      class="menu-btn md-badge"\n      md-ink-ripple="#FFF"\n      data-badge="{{::supplements.length}}"\n      ng-click="openSupplements()">\n      Supplements\n    </div>\n    <div\n      ng-if="::references.length"\n      class="menu-btn md-badge"\n      md-ink-ripple="#FFF"\n      data-badge="{{::references.length}}"\n      ng-click="openReferences()">\n      References\n    </div>\n    <div\n      ng-if="::article.get().doi && metadata.citations_count"\n      class="menu-btn md-badge"\n      md-ink-ripple="#FFF"\n      ng-attr-data-badge="{{::metadata.citations_count | kilo}}"\n      ng-click="openMetrics()">\n      Cited By\n    </div>\n    <md-menu\n      class="menu-btn more sticky"\n      ng-if="::supplements.length || references.length || article.get().doi"\n      md-position-mode="target-right target">\n      <i\n        class="material-icons"\n        ng-click="openMoreMenu($mdOpenMenu, $event)"\n        md-ink-ripple="#FFF">\n        more_vert\n      </i>\n      <md-menu-content width="2">\n        <md-menu-item ng-if="::supplements.length">\n          <md-button ng-click="openSupplements()">\n            <div class="md-badge" data-badge="{{::supplements.length}}">Supplements</div>\n          </md-button>\n        </md-menu-item>\n        <md-menu-item ng-if="::references.length">\n          <md-button ng-click="openReferences()">\n            <div class="md-badge" data-badge="{{::references.length}}">References</div>\n          </md-button>\n        </md-menu-item>\n        <md-menu-item ng-if="::article.get().doi && metadata.citations_count">\n          <md-button ng-click="openMetrics()">\n            <div class="md-badge" ng-attr-data-badge="{{::metadata.citations_count | kilo}}">Cited By</div>\n          </md-button>\n        </md-menu-item>\n      </md-menu-content>\n    </md-menu>\n  </div>\n  <div\n    class="right publisher-logo"\n    ng-class="{link: !!publisherLinkout}"\n    ng-click="publisherLinkout()">\n    <i class="material-icons">navigate_next</i>\n  </div>\n</div>\n'),e.put("metadata.html",'<title ng-bind="::meta.title"></title>\n\n<link rel="canonical" href="{{::canonical}}" ng-if="::canonical">\n\n<meta name="description" content="{{::meta.abstract}}" ng-if="::meta.abstract">\n<meta name="keywords" content="{{::meta | articleKeywords}}" ng-if="::meta.journal && meta.doi">\n\n<link rel="schema.DC" href="http://purl.org/dc/elements/1.1">\n\n<meta name="DC.title" content="{{::meta.title}}" ng-if="::meta.title">\n<meta name="DC.identifier" content="doi:{{::meta.doi}}" ng-if="::meta.doi">\n\n<meta name="citation_doi" content="{{::meta.doi}}" ng-if="::meta.doi">\n<meta name="citation_title" content="{{::meta.title}}" ng-if="::meta.title">\n<meta name="citation_journal_title" content="{{::meta.journal}}" ng-if="::meta.journal">\n<meta name="citation_volume" content="{{::meta.volume}}" ng-if="::meta.volume">\n<meta name="citation_date" content="{{::meta.year}}" ng-if="::meta.year">\n\n<meta name="citation_author" content="{{::author.name}}" ng-repeat="author in meta.authors">\n<meta name="DC.creator" content="{{::author.name}}" ng-repeat="author in meta.authors">\n\n<meta property="og:type" content="article">\n<meta property="og:url" content="{{::canonical}}" ng-if="::canonical">\n<meta property="og:title" content="{{::meta.title}}" ng-if="::meta.title">\n<meta property="og:description" content="{{::meta.abstract}}" ng-if="::meta.abstract">\n<meta property="og:image" content="{{::image}}" ng-if="::image">\n'),e.put("mobile_reader.html",'<div class="reader" read-mode="distraction-free">\n  <div class="content article-container">\n    <mobile-article class="viewer mobile-viewer"></mobile-article>\n  </div>\n  <mobile-toolbar></mobile-toolbar>\n  <ng-include src="\'sidenav/mobile_menu.html\'"></ng-include>\n</div>\n'),e.put("print_notice.html",'<div class="centered-logo"></div>\n<span>To print this article, please use the print button in the bottom toolbar of the web reader.</span>\n'),e.put("reader.html",'<div class="reader" read-mode="distraction-free">\n\n  <div class="content article-container">\n    <article></article>\n    <article-tools></article-tools>\n  </div>\n\n  <ng-include src="\'menu_bar.html\'"></ng-include>\n\n  <ng-include src="\'sidenav/checkout.html\'"></ng-include>\n  <ng-include src="\'sidenav/supplements.html\'"></ng-include>\n  <ng-include src="\'sidenav/references.html\'"></ng-include>\n  <ng-include src="\'sidenav/annotations.html\'"></ng-include>\n  <ng-include src="\'sidenav/cited_by.html\'"></ng-include>\n  <ng-include src="\'sidenav/figures.html\'"></ng-include>\n  <ng-include src="\'sidenav/related.html\'"></ng-include>\n  <ng-include src="\'sidenav/appnav.html\'"></ng-include>\n</div>\n\n<ng-include class="print-notice" src="\'print_notice.html\'"></ng-include>\n'),e.put("resolve.html",'<div class="reader resolve-reader article-container">\n  <viewer class="viewer hw-accel" post-selection></viewer>\n\n  <page-info></page-info>\n  <viewer-toolbar></viewer-toolbar>\n\n  <ng-include src="\'popover/resolve_selection.html\'"></ng-include>\n</div>'),e.put("supplement.html",'<div\n  class="reader supplement-reader"\n  ng-class="::{\'links-ready\': toolbarLinks}"\n  read-mode="distraction-free">\n\n  <div class="content article-container">\n    <viewer class="viewer hw-accel" article-annotations></viewer>\n    <page-info></page-info>\n    <viewer-toolbar></viewer-toolbar>\n    <ng-include src="\'popover/annotations.html\'"></ng-include>\n  </div>\n\n  <div class="header article-menu md-whiteframe-1dp"\n    ng-class="{contracted: contracted}" responsive>\n    <div class="left">\n      <div class="title">\n        <span class="caption">\n          {{::caption}}\n        </span>\n        <span class="type" ng-if="::article.get().type">\n          ({{::type}})\n        </span>\n      </div>\n    </div>\n    <div class="center">\n      <a\n        class="header-btn download"\n        ng-attr-target="{{::toolbarLinks.save.target}}"\n        ng-href="{{::toolbarLinks.save.href}}"\n        md-ink-ripple="#FFF">\n        <i class="material-icons">file_download</i>\n        <span>Download</span>\n        <md-tooltip ng-if="contracted" md-direction="bottom" md-autohide="true">\n          Download\n        </md-tooltip>\n      </a>\n      <div\n        class="header-btn md-badge notes"\n        md-ink-ripple="#FFF"\n        ng-attr-data-badge="{{notes.length || undefined}}"\n        ng-click="toggleAnnots()">\n        <i class="material-icons">chat</i>\n        <span>Notes</span>\n        <md-tooltip ng-if="contracted" md-direction="bottom" md-autohide="true">\n          Notes <span ng-if="notes.length">({{notes.length}})</span>\n        </md-tooltip>\n      </div>\n    </div>\n    <div class="right publisher-logo"></div>\n  </div>\n\n  <ng-include src="\'sidenav/annotations.html\'"></ng-include>\n</div>\n\n'),e.put("video_player.html",'<div class="modal-backdrop"></div>\n<div class="video-overlay">\n  <div class="video-content" target-click="close()">\n    <video id="{{::videoId}}" class="video-js vjs-default-skin" controls>\n      <source ng-src="{{::video.url | trustUrl}}" type="video/mp4">\n    </video>\n  </div>\n  <div class="header md-whiteframe-1dp">\n    <div class="left">\n      <i\n        class="material-icons header-btn icon-btn"\n        ng-click="close()"\n        md-ink-ripple="#FFF">\n        arrow_back\n      </i>\n    </div>\n    <div class="center">\n      <a\n        class="header-btn download"\n        ng-href="{{::video.download_url}}"\n        md-ink-ripple="#FFF">\n        <i class="material-icons">file_download</i>\n        <span>Download</span>\n      </a>\n    </div>\n  </div>\n</div>\n'),e.put("ads/add_to_library.html",'<div class="add-to-library-ad">\n  <h2 class="md-title">\n    Add this Article to your ReadCube Cloud Library\n  </h2>\n  <ul class="features">\n    <li class="flex-row">\n      <i class="material-icons">cloud</i>\n      <div>\n        Access this article instantly from ReadCubes free\n        <a target="_blank" ng-href="{{::endpoint.app}}">Web Library</a>,\n        <a target="_blank" ng-href="{{::endpoint.web + \'/download\'}}">Desktop</a> and\n        <a target="_blank" ng-href="{{::endpoint.web + \'/download\'}}">Mobile</a> apps.\n      </div>\n    </li>\n    <li class="flex-row">\n      <i class="material-icons">important_devices</i>\n      <div>\n        Save annotations and notes. Plus enjoy Enhanced PDF features offline, including clickable inline citations and automatic supplements.\n      </div>\n    </li>\n    <li class="flex-row">\n      <i class="material-icons">insert_chart</i>\n      <div>Unlock article citation metrics.</div>\n    </li>\n  </ul>\n  <div class="actions">\n    <md-button\n      class="md-primary md-raised"\n      ng-click="closeAd()">\n      Add to Library\n    </md-button>\n  </div>\n</div>'),e.put("ads/sent_to_mobile.html",'<div class="sent-to-mobile">\n  <div class="cloud-sync-image"></div>\n  <h2>Synced in the cloud!</h2>\n  <div class="instructions">This article is now synced to your ReadCube library. Open the ReadCube Mobile app (iPhone, iPad, Android) to read this article.</div>\n  <div class="buttons">\n    <a target="_blank" class="appstore-button" ng-href="{{::endpoint.mobile_apps.ios}}"></a>\n    <a target="_blank" class="googleplay-button" ng-href="{{::endpoint.mobile_apps.android}}"></a>\n  </div>\n</div>'),e.put("citations/author.html",'<div class="author">\n  <h4 class="name">{{::text}}</h4>\n\n  <div class="affiliations" ng-if="::affiliations">\n    <div ng-repeat="af in ::affiliations">{{::af}}</div>\n  </div>\n\n  <div class="contact" ng-if="::email">\n    <i class="material-icons person">person</i>\n    <a\n      ng-attr-target="{{::email.indexOf(\'mailto:\') == 0 ? undefined : \'_blank\'}}"\n      ng-href="{{::email}}">\n      Contact {{::text}}\n    </a>\n  </div>\n\n  <div class="orcid" ng-if="::orcid_url">\n    <i class="logo"></i>\n    <a\n      target="_blank"\n      ng-href="{{::orcid_url}}">\n      View author on ORCID\n    </a>\n  </div>\n\n  <div class="search">\n    Search for author in:\n    <div class="links">\n      <span\n        ng-repeat="lnk in ::search"\n        ng-hide="::lnk.disabled">\n        <a ng-href="{{::lnk.url}}" target="_blank">{{::lnk.provider}}</a>\n        <span ng-if="!$last">  </span>\n      </span>\n    </div>\n  </div>\n</div>'),e.put("citations/figure.html",'<div class="figure">\n  <div class="view-figure">\n    <img class="thumb" ng-src="{{::figure.thumb}}"/>\n    <div class="launch">\n      <i class="material-icons">launch</i>\n      <span>View</span>\n    </div>\n  </div>\n  <span\n    class="caption"\n    ng-bind-html="::figure.caption | figureCaption">\n  </span>\n</div>\n'),e.put("citations/metrics.html",'<div class="articles">\n  <div\n    class="article reference"\n    ng-repeat="ref in metrics">\n    <h4 class="title" ng-if="::ref.title" ng-bind-html="::ref.title | linkify"></h4>\n    <div class="authors">{{::ref.authors.slice(0, 10) | authorShortName | join:\', \'}}</div>\n    <div class="links">\n      <a\n        target="_blank"\n        ng-if="::ref.url"\n        ng-click="trackLinkout(ref)"\n        ng-href="{{::ref.url}}">\n        Article\n      </a>\n    </div>\n    <div class="published">{{::ref | refPublishInfo}}</div>\n  </div>\n</div>\n'),e.put("citations/references.html",'<div class="articles">\n  <div\n    class="article"\n    ng-class="{\'reference\': ref.ordinal || ref.label, \'hide-labels\': hideLabels}"\n    ng-repeat="ref in ::references">\n    <div\n      ng-if="::ref.ordinal || ref.label"\n      title="{{::ref.ordinal || ref.label}}"\n      class="number">\n      {{::ref.ordinal || ref.label}}\n    </div>\n    <h4 class="title" ng-if="::ref.title" ng-bind-html="::ref.title | linkify"></h4>\n    <div class="authors">{{::ref.authors.slice(0, 10) | join:\', \'}}</div>\n    <div class="links">\n      <a\n        target="_blank"\n        ng-if="::ref.find_article_url"\n        ng-click="trackLinkout(ref)"\n        ng-href="{{::ref.find_article_url}}">\n        Find Article\n      </a>\n      <span ng-if="::ref.find_article_url && ref.article_url"> | </span>\n      <a\n        target="_blank"\n        ng-if="::ref.article_url"\n        ng-click="trackLinkout(ref)"\n        ng-href="{{::ref.article_url}}">\n        Article\n      </a>\n    </div>\n    <div class="published">{{::ref | refPublishInfo}}</div>\n  </div>\n</div>\n'),e.put("dialogs/action_unavailable.html",'<md-dialog aria-label="Action Unavailable">\n  <md-dialog-content class="md-dialog-content action-unavailable">\n    <h2 class="md-title">{{::titleAction}} Unavailable</h2>\n    <p class="md-body-1">\n      {{::msgAction}} the PDF outside of ReadCube requires the full PDF purchase option. Rental and Cloud articles can be viewed online and offline in the ReadCube Web, Desktop and Mobile apps but cannot be printed or saved outside of ReadCube.\n    </p>\n    <p class="md-caption" ng-if="::purchaseDate">\n      This article was purchased as a <b>{{::purchaseType}}</b> on <b>{{::purchaseDate | formatDate:\'YYYY/MM/DD\'}}</b>.\n    </p>\n  </md-dialog-content>\n  <md-dialog-actions class="md-actions">\n    <md-button ng-click="close()" class="md-primary md-raised">\n      GOT IT!\n    </md-button>\n  </md-dialog-actions>\n</md-dialog>\n'),e.put("dialogs/complimentary_access.html",'<md-dialog aria-label="Action Unavailable">\n  <md-dialog-content class="md-dialog-content action-unavailable">\n    <h2 class="md-title">{{::titleAction}} Unavailable</h2>\n    <p class="md-body-1">\n      You are viewing a complimentary shared article, since we have detected that you would not normally have full PDF access.\n    </p>\n    <p class="md-body-1">\n      Complimentary shares do not allow {{::msgAction}}. Click <a target="_blank" ng-href="{{::articleUrl}}">here</a> for additional access options.\n    </p>\n  </md-dialog-content>\n  <md-dialog-actions class="md-actions">\n    <md-button ng-click="close()" class="md-primary md-raised">\n      GOT IT!\n    </md-button>\n  </md-dialog-actions>\n</md-dialog>\n'),e.put("dialogs/export.html",'<md-dialog class="export-dialog" aria-label="Export Citation">\n  <md-dialog-content class="md-dialog-content">\n    <h2 class="md-title">Export Citation</h2>\n    <p class="md-body-1">\n      To save this citation to your reference manager software, please select one of the formats below.\n    </p>\n    <md-radio-group ng-model="format">\n      <md-radio-button value="ris" class="md-primary">RIS</md-radio-button>\n      <md-radio-button value="endnote" class="md-primary">Endnote</md-radio-button>\n      <md-radio-button value="mendeley" class="md-primary">Mendeley</md-radio-button>\n      <md-radio-button value="papers" class="md-primary">Papers</md-radio-button>\n      <md-radio-button value="bibtex" class="md-primary">BibTeX</md-radio-button>\n    </md-radio-group>\n  </md-dialog-content>\n  <md-dialog-actions class="md-actions">\n    <md-button ng-click="export(format)" class="md-primary">Export</md-button>\n  </md-dialog-actions>\n</md-dialog>\n'),e.put("dialogs/import_annotations.html",'<md-dialog class="import-annotations-dialog" aria-label="Import Annotations">\n  <md-dialog-content class="md-dialog-content">\n    <h2 class="md-title">Shared Annotations</h2>\n    <p>This article was shared with annotations. Would you like to import the shared annotations to your existing annotations?</p>\n  </md-dialog-content>\n  <md-dialog-actions class="md-actions">\n    <md-button ng-click="close()">View my annotations</md-button>\n    <md-button ng-click="close(true)" class="md-primary md-raised">Import</md-button>\n  </md-dialog-actions>\n</md-dialog>\n'),e.put("dialogs/print_options.html",'<md-dialog class="print-options" aria-label="Print Options">\n  <md-dialog-content class="md-dialog-content">\n    <div class="options" ng-show="!synced">\n      <h2 class="md-headline">article print options</h2>\n      <div\n        ng-click="printPdf()"\n        class="row print-pdf"\n        md-ink-ripple=\'#FFF\'>\n        <i class="material-icons option-icon">print</i>\n        <div class="text">Print High Resolution PDF</div>\n      </div>\n      <div\n        ng-click="sendToMobile()"\n        class="row send-to-tablet"\n        md-ink-ripple=\'#FFF\'>\n        <i class="material-icons option-icon">tablet_mac</i>\n        <div class="text">\n          <span>Send to ReadCube Mobile</span>\n          <div class="fineprint">Read the Enhanced PDF on a mobile device (iPhone, iPad, Android)</div>\n        </div>\n      </div>\n      <div\n        ng-click="cloudPrint()"\n        class="row google-cloud-print"\n        md-ink-ripple=\'#FFF\'>\n        <div class="g-logo option-icon"></div>\n        <div class="text">Google Cloud Print</div>\n      </div>\n    </div>\n    <ng-include src="\'ads/sent_to_mobile.html\'" ng-show="synced"></ng-include>\n  </md-dialog-content>\n</md-dialog>\n'),e.put("dialogs/share.html",'<md-dialog class="share-dialog" aria-label="Share">\n  <md-dialog-content class="md-dialog-content">\n    <i class="material-icons share">share</i>\n    <div class="md-subhead">SHAREABLE URL</div>\n    <h2 class="md-title">Anyone with this URL can read the full text of this article</h2>\n    <div class="link-container" ng-class="{busy: busy}">\n      <div class="link">\n        <i class="material-icons">link</i>\n      </div>\n      <input\n        type="text"\n        readonly="readonly"\n        ng-model="shareLink"\n        ng-mousedown="select($event)">\n    </div>\n    <div>\n      <md-switch class="md-block" ng-model="includeAnnotations">\n        Include Annotations\n      </md-switch>\n    </div>\n  </md-dialog-content>\n</md-dialog>\n'),e.put("dialogs/user.html",'<md-dialog\n  class="user-dialog"\n  ng-class="{\'login-ad\': loginAd}"\n  aria-label="Login or Register">\n  <md-dialog-content class="md-dialog-content">\n    <pre-login\n      ng-if="loginAd"\n      ng-include="loginAd">\n    </pre-login>\n    <login ng-class="{loaded: loaded}">\n      <iframe\n        class="modal login"\n        ng-src="{{::src | trustUrl}}"\n        onmousewheel=""\n        allowtransparency="true"\n        seamless="seamless">\n      </iframe>\n      <spinner></spinner>\n    </login>\n  </md-dialog-content>\n</md-dialog>\n'),e.put("error/404.html",'<h1>404</h1>\n<h4>Yikes! The page you requested could not be found.</h4>\n<p>\n  If you think this is an error, contact <a ng-href="{{::supportHref}}">support@readcube.com</a> for assistance.\n</p>\n'),e.put("error/500.html",'<h1>500</h1>\n<h4>Yikes! Something went wrong.</h4>\n<p>\n  Please try again later. If the problem persists,<br>\n  contact <a ng-href="{{::supportHref}}">support@readcube.com</a> for assistance.\n</p>\n<p class="edge-msg">\n  You may also find this support <a ng-href="{{::edgeSupportHref}}">article</a> helpful.\n</p>\n'),e.put("error/error.html",'<div class="error">\n  <canvas id="canvas" width="400" height="300"></canvas>\n  <div\n    class="error-content"\n    ng-class="{\'show-code\': showCode, \'show-message\': showMessage}">\n    <ui-view></ui-view>\n  </div>\n</div>\n'),e.put("error/processing.html",'<div class="processing">\n  <div class="processing-content">\n    <div class="logo pulse"></div>\n    <h2>Article processing...</h2>\n    <p>\n      We\'re still processing this PDF for the Enhanced Web Reader - it shouldn\'t take long so please keep this window open.\n    </p>\n    <p>This page will automatically reload in <em>{{refresh}}</em> seconds...</p>\n  </div>\n</div>\n'),e.put("popover/annotations.html",'<div style="display:none;">\n  <div id="annotations-base-toolbar" class="base-toolbar">\n    <div class="row annot-colors unselectable">\n      <div class="sample color-1" data-colorid="1"></div>\n      <div class="sample color-2" data-colorid="2"></div>\n      <div class="sample color-3" data-colorid="3"></div>\n      <div class="sample color-4" data-colorid="4"></div>\n    </div>\n    <div class="row add-note unselectable">\n      <i class="material-icons">comment</i>\n      <span>Add Note</span>\n    </div>\n    <div class="row edit-note">\n    <textarea placeholder="Type note text here."></textarea>\n    </div>\n    <div class="row delete unselectable">\n      <i class="material-icons">delete</i>\n      <span>Delete</span>\n    </div>\n  </div>\n</div>\n'),e.put("popover/resolve_selection.html",'<div style="display:none;">\n  <div id="resolve-toolbar" class="base-toolbar">\n    <div class="row unselectable" ng-repeat="t in ::types" ng-attr-type="{{::t}}">{{::t}}</div>\n  </div>\n</div>\n'),e.put("sidenav/annotations.html",'<annotations class="md-whiteframe-z2">\n  <h3>Notes</h3>\n\n  <div ng-if="!annots.length">\n    <h4>You have no notes.</h4>\n    <div class="tip">\n      Tip: To annotate, select any text in the article to get the annotation menu. You can add highlights and comments, which will be listed here in this panel.\n    </div>\n  </div>\n\n  <div ng-if="annots.length">\n    <div class="sort-options layout-row">\n      <md-input-container class="sort-order">\n        <label>Order by:</label>\n        <md-select ng-model="sortPredicate">\n          <md-option ng-value="key" ng-repeat="(key, val) in predicates">{{key}}</md-option>\n        </md-select>\n      </md-input-container>\n      <md-input-container class="sort-direction">\n        <label>Direction:</label>\n        <md-select ng-model="sortDirection">\n          <md-option ng-value="key" ng-repeat="(key, val) in directions">{{key}}</md-option>\n        </md-select>\n      </md-input-container>\n    </div>\n    <div\n      class="note-item"\n      ng-click="scrollTo(annot)"\n      ng-repeat="annot in annots | orderBy:predicates[sortPredicate]:directions[sortDirection]">\n      <div ng-if="sortPredicate == \'created\'" class="note-time-date">\n        {{annotationCreated(annot) | calendarDate}}\n      </div>\n      <div ng-if="sortPredicate != \'created\'" class="note-time-date">\n        {{annotationModified(annot) | calendarDate}}\n      </div>\n      <div class="note-highlight" ng-class="\'color-\' + annot.color_id">{{annot.text | breaksToSpaces}}</div>\n      <div class="note-text" ng-if="annot.note">{{annot.note}}</div>\n    </div>\n  </div>\n\n  <md-button ng-if="annots.length" class="md-icon-button download" ng-click="downloadAnnots()">\n    <i class="material-icons">file_download</i>\n    <md-tooltip md-direction="bottom" md-autohide="true">\n      Download as CSV\n    </md-tooltip>\n  </md-button>\n  <md-button class="md-icon-button close" ng-click="toggleAnnots()">\n    <i class="material-icons">close</i>\n  </md-button>\n</annotations>\n'),e.put("sidenav/appnav.html",'<md-sidenav\n  class="md-sidenav-left"\n  md-component-id="appnav">\n  <appnav ng-class="{loaded: loaded}">\n    <div class="rc-menu">\n      <div class="rc-logo"></div>\n      <span class="rc-text">readcube</span>\n    </div>\n    <iframe\n      class="appnav-frame"\n      allowTransparency="true"\n      seamless="seamless">\n    </iframe>\n    <spinner></spinner>\n    <logout class="md-whiteframe-2dp">\n      <div\n        class="button"\n        ng-click="onLogOut()"\n        md-ink-ripple="#FFF">\n        <i class="material-icons">exit_to_app</i>\n        <span>Log out</span>\n      </div>\n    </logout>\n  </appnav>\n</md-sidenav>\n'),e.put("sidenav/checkout.html",'<checkout\n  class="md-whiteframe-z2"\n  ng-class="{loaded: loaded}">\n  <iframe\n    class="checkout-frame"\n    onmousewheel=""\n    allowTransparency="true"\n    seamless="seamless">\n  </iframe>\n  <spinner></spinner>\n</checkout>\n'),e.put("sidenav/cited_by.html",'<md-sidenav\n  class="md-sidenav-right md-whiteframe-z2 references metrics"\n  md-component-id="cited-by">\n  <div class="sidenav-title md-whiteframe-2dp">\n    Cited By\n  </div>\n  <cited-by\n    class="sidenav-content"\n    ng-class="{busy: !metrics.results}"\n    infinite-scroll\n    load-more="scrollMetrics()"\n    treshold-percent="80">\n    <div ng-if="metrics.results.length" metrics="metrics.results", tracking-source="citing_article"></div>\n    <div ng-if="!metrics.finished && metrics.results.length" class="loading-more">\n      <div class="loader-inner ball-pulse">\n        <div></div>\n        <div></div>\n        <div></div>\n      </div>\n    </div>\n    <div ng-if="!metrics.results.length" class="no-results">\n      No citing articles found.\n    </div>\n    <spinner></spinner>\n  </cited-by>\n</md-sidenav>\n'),e.put("sidenav/figures.html",'<md-sidenav\n  class="md-sidenav-right md-whiteframe-z2 figures"\n  md-component-id="figures">\n  <div class="sidenav-title md-whiteframe-2dp">\n    Figures\n  </div>\n  <div class="sidenav-content">\n    <div\n      ng-repeat="figure in ::figures"\n      figure="figure"\n      index="$index"\n      inlist="true">\n    </div>\n  </div>\n</md-sidenav>\n'),e.put("sidenav/mobile_menu.html",'<md-sidenav\n  class="md-sidenav-left"\n  md-component-id="mobile_menu">\n  <div class="publisher-logo"></div>\n  <md-menu-content width="4">\n    <md-menu-divider></md-menu-divider>\n    <md-menu-item>\n      <md-button ng-click="gotoPublisher()">\n        <md-icon class="material-icons">web</md-icon>\n        Go to article page\n      </md-button>\n    </md-menu-item>\n    <md-menu-item ng-if="::references.length">\n      <md-button ng-click="">\n        <md-icon class="material-icons">list</md-icon>\n        References\n      </md-button>\n    </md-menu-item>\n    <md-menu-item ng-if="::figures.length">\n      <md-button ng-click="">\n        <md-icon class="material-icons">photo_library</md-icon>\n        Figures\n      </md-button>\n    </md-menu-item>\n    <md-menu-item ng-if="::metadata">\n      <md-button ng-click="">\n        <md-icon class="material-icons">layers</md-icon>\n        Related articles\n      </md-button>\n    </md-menu-item>\n    <md-menu-item ng-if="::article.get().doi && metadata.citations_count">\n      <md-button ng-click="">\n        <md-icon class="material-icons">link</md-icon>\n        Cited by\n      </md-button>\n    </md-menu-item>\n    <md-menu-item ng-if="::supplements.length">\n      <md-button ng-click="">\n        <md-icon class="material-icons">library_add</md-icon>\n        Supplements\n      </md-button>\n    </md-menu-item>\n    <md-menu-item ng-if="!inLibrary">\n      <md-button ng-click="toggleInLibrary($event)">\n        <md-icon class="material-icons">cloud_upload</md-icon>\n        Add to library\n      </md-button>\n    </md-menu-item>\n    <md-menu-item ng-if="inLibrary">\n      <md-button ng-click="toggleInLibrary($event)">\n        <md-icon class="material-icons">cloud_off</md-icon>\n        Remove from library\n      </md-button>\n    </md-menu-item>\n    <md-menu-item ng-if="!user.signedIn()">\n      <md-button ng-click="signIn($event)">\n        <div class="rc-logo"></div>\n        Sign In\n      </md-button>\n    </md-menu-item>\n        <md-menu-item ng-if="user.signedIn()">\n      <md-button ng-click="signOut()">\n        <div class="rc-logo"></div>\n        Sign Out\n      </md-button>\n    </md-menu-item>\n    <md-menu-divider></md-menu-divider>\n  </md-menu-content>\n</md-sidenav>\n'),e.put("sidenav/mobile_user.html",'<md-sidenav\n  id="user-sidenav"\n  md-component-id="user"\n  class="md-sidenav-left user-sidenav"\n  ng-class="{\'login-ad\': loginAd}">\n  <div class="sidenav-back"\n    ng-click="close()"\n    md-ink-ripple="#FFF">\n    <i class="material-icons">arrow_back</i>\n    Back\n  </div>\n  <div class="sidenav-content">\n    <pre-login\n      ng-if="loginAd"\n      ng-include="loginAd">\n    </pre-login>\n    <login ng-class="{loaded: loaded}">\n      <div class="frame-container">\n        <iframe\n          class="modal login"\n          ng-src="{{::src | trustUrl}}"\n          allowtransparency="true"\n          seamless="seamless">\n        </iframe>\n      </div>\n      <spinner></spinner>\n    </login>\n  </div>\n</md-sidenav>\n'),e.put("sidenav/references.html",'<md-sidenav\n  class="md-sidenav-right md-whiteframe-z2 references"\n  md-component-id="references">\n  <div class="sidenav-title md-whiteframe-2dp">\n    References\n  </div>\n  <div class="sidenav-content">\n    <div references="references" tracking-source="reference"></div>\n  </div>\n</md-sidenav>\n'),e.put("sidenav/related.html",'<md-sidenav\n  class="md-sidenav-right md-whiteframe-z2 related"\n  md-component-id="related">\n  <div class="sidenav-title md-whiteframe-2dp">\n    Related Articles\n  </div>\n  <div class="sidenav-content" ng-class="{busy: !related}">\n    <div ng-if="related.length" references="related" tracking-source="related_article"></div>\n    <div ng-if="!related.length" class="no-results">\n      No related articles found.\n    </div>\n    <spinner></spinner>\n  </div>\n</md-sidenav>\n'),e.put("sidenav/supplements.html",'<md-sidenav\n  class="md-sidenav-right md-whiteframe-z2 supplements"\n  md-component-id="supplements">\n  <div ng-controller="SupplementsCtrl">\n    <div class="sidenav-title md-whiteframe-2dp">\n      Supporting Information\n    </div>\n    <div class="sidenav-content">\n      <a\n        ng-repeat="sup in ::supplements"\n        target="_blank"\n        class="supplement md-whiteframe-2dp"\n        ng-href="{{::sup.url}}"\n        ng-click="viewSupplement($event, sup)">\n        <div class="thumb" bg-image="{{::sup.thumb[0]}}">\n          <i ng-if="::sup.type == \'video\'" class="material-icons play-icon">play_circle_outline</i>\n        </div>\n        <div class="title">{{::sup.caption}}</div>\n        <div ng-if="::sup.type != \'video\'" class="type">({{::sup.type.toUpperCase()}})</div>\n      </a>\n    </div>\n  </div>\n</md-sidenav>\n'),e.put("toast/annots_not_synced.html",'<md-toast class="annots-not-synced">\n  <div class="flex-row">\n    <i class="material-icons">cloud_off</i>\n    <span class="message">\n      Annotations not saved. To save annotations, please add this article to your Library.\n    </span>\n    <md-button class="add-to-library" ng-click="addToLibrary($event)">\n      Add to Library\n    </md-button>\n  </div>\n  <div class="close" ng-click="close()">\n    <i class="material-icons">close</i>\n  </div>\n</md-toast>'),e.put("toast/auth_failed.html",'<md-toast class="auth-failed">\n  <div class="flex-row">\n    <i class="material-icons">lock</i>\n    <span class="message">\n      We are unable to authorize full PDF access to this article at this time. Click <a target="_blank" ng-href="{{::articleUrl}}">here</a> to access it on the publishers site.\n    </span>\n  </div>\n  <div class="close" ng-click="close()">\n    <i class="material-icons">close</i>\n  </div>\n</md-toast>\n'),e.put("toast/info_message.html",'<md-toast>\n  <div class="flex-row">\n    <i class="material-icons">info</i>\n    <span class="message">\n      {{message}}\n    </span>\n  </div>\n  <div class="close" ng-click="close()">\n    <i class="material-icons">close</i>\n  </div>\n</md-toast>'),e.put("toast/prompt_register.html",'<md-toast class="register-prompt">\n  <div class="flex-row">\n    <i class="material-icons">person</i>\n    <span class="message">\n      Please <a class="login" ng-click="login()">sign in</a> or create a free ReadCube account to view citation data.\n    </span>\n    <md-button class="register" ng-click="register()">\n      Register\n    </md-button>\n  </div>\n  <div class="close" ng-click="close()">\n    <i class="material-icons">close</i>\n  </div>\n</md-toast>\n'),e.put("toast/read_personal.html",'<md-toast class="read-personal">\n  <div class="flex-row">\n    <i class="material-icons">cloud</i>\n    <span class="message">\n      You have this article in your ReadCube library. Open that version to get full-text access.\n    </span>\n    <md-button class="open" ng-click="openPersonal()">\n      Open\n    </md-button>\n  </div>\n  <div class="close" ng-click="close()">\n    <i class="material-icons">close</i>\n  </div>\n</md-toast>'),e.put("toast/rental_expiry.html",'<md-toast class="rental-expiry">\n  <div class="flex-row">\n    <i class="material-icons">timelapse</i>\n    <span class="message expires-in" ng-if="expiresIn">\n      Rental expires in<br>\n      <span class="duration">{{expiresIn | rentalDuration}}</span>\n    </span>\n    <span class="message expired-on" ng-if="::expiredOn">\n      Rental expired on <span class="time">{{::expiredOn | formatDate:\'dddd, MMMM Do YYYY, h:mm a\'}}</span>\n    </span>\n  </div>\n  <div class="close" ng-click="close()">\n    <i class="material-icons">close</i>\n  </div>\n</md-toast>\n'),e.put("toast/shared_access.html",'<md-toast class="shared-access">\n  <div class="publisher-logo"></div>\n  <div class="flex-row">\n    <i class="material-icons share">share</i>\n    <span class="message">\n      {{::message}}<br>\n      <a class="back-to-publisher" ng-if="gotoPublisher" ng-click="gotoPublisher()">\n        Back to {{::publisherName}}\n      </a>\n      <a class="whats-this" target="_blank" ng-href="{{::whatsThisLink}}">\n        What\'s this?\n      </a>\n    </span>\n  </div>\n  <div class="close" ng-click="close()">\n    <i class="material-icons">close</i>\n  </div>\n</md-toast>'),e.put("toast/synced_ad.html",'<md-toast class="synced-ad">\n  <div class="title">This article has been added to your library.</div>\n  <p>Try ReadCube\'s free apps to access the Enhanced PDF anytime:</p>\n  <a target="_blank" class="md-button dektop-app" ng-href="{{::endpoint.web + \'/download\'}}">\n    <i class="material-icons">desktop_mac</i>\n    <span class="message">\n      ReadCube Desktop (Win/Mac)\n    </span>\n  </a>\n  <a target="_blank" class="md-button ios-app" ng-href="{{::endpoint.mobile_apps.ios}}">\n    <i class="material-icons">tablet_mac</i>\n    <span class="message">\n      ReadCube iOS (iPhone/iPad)\n    </span>\n  </a>\n  <a target="_blank" class="md-button android-app" ng-href="{{::endpoint.mobile_apps.android}}">\n    <i class="material-icons">android</i>\n    <span class="message">\n      ReadCube Android\n    </span>\n  </a>\n  <a target="_blank" class="md-button web-app" ng-href="{{::endpoint.app}}">\n    <i class="material-icons">web</i>\n    <span class="message">\n      ReadCube Web Library\n    </span>\n  </a>\n  <div class="close" ng-click="close()">\n    <i class="material-icons">close</i>\n  </div>\n</md-toast>'),e.put("toast/update_available.html",'<md-toast>\n  <div class="flex-row">\n    <i class="material-icons">update</i>\n    <span class="message">\n      A new version of this application is available.\n    </span>\n    <md-button class="open" ng-click="reload()">\n      Update\n    </md-button>\n  </div>\n  <div class="close" ng-click="close()">\n    <i class="material-icons">close</i>\n  </div>\n</md-toast>'),e.put("toolbars/mobile_toolbar.html",'<div class="mobile-toolbar" ng-class="{downloading: downloading}">\n  <i\n    class="material-icons menu"\n    ng-click="menu()"\n    md-ink-ripple="#FFF">\n    menu\n  </i>\n  <i\n    class="material-icons next-page"\n    ng-click="prevPage()"\n    md-ink-ripple="#FFF">\n    navigate_before\n  </i>\n  <span>{{pageIdx}} / {{numPages}}</span>\n  <i\n    class="material-icons prev-page"\n    ng-click="nextPage()"\n    md-ink-ripple="#FFF">\n    navigate_next\n  </i>\n  <i\n    class="material-icons download"\n    ng-click="download()"\n    md-ink-ripple="#FFF">\n    file_download\n  </i>\n  <div class="download-spinner">\n    <spinner></spinner>\n  </div>\n</div>'),e.put("toolbars/page_info.html",'<div\n  class="page-info"\n  ng-class="{scrolling: scrolling, authorizing: authorizing, loading: loading}"\n  ng-show="scrolling || authorizing || loading">\n  <div class="progress-container">\n    <spinner></spinner>\n    <i class="material-icons access-icon">lock</i>\n  </div>\n  <div class="pagination">Page {{pageIdx}} of {{numPages}}</div>\n</div>\n'),e.put("toolbars/viewer_toolbar.html",'<div\n  class="viewer-toolbar"\n  ng-class="{downloading: downloading, printing: printing}">\n  <a\n    ng-repeat="(action, handler) in ::toolbar"\n    ng-hide="disabled[action]"\n    ng-attr-target="{{::toolbarLinks[action].target}}"\n    ng-href="{{::toolbarLinks[action].href}}"\n    ng-class="action"\n    ng-click="handler($event)"\n    md-ink-ripple=\'#FFF\'\n    class="toolbar-btn">\n    <i class="material-icons">{{::action}}</i>\n    <spinner></spinner>\n  </a>\n  <a class="toolbar-btn" id=\'user-voice\'>\n    <i class="material-icons">help</i>\n  </a>\n</div>\n')}])},{}]},{},[1]);